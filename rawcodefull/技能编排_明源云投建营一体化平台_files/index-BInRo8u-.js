const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/markdownEditor.js","assets/vendor-7uiE44Sw.js","assets/vendor-DW4uNTQq.css"])))=>i.map(i=>d[i]);
import{o as openBlock,c as createElementBlock,a as createBaseVNode,d as defineStore,M as MarkerType,b as axios,u as useVueFlow,r as ref,e as Message,f as diff,g as defineComponent,h as computed,n as normalizeStyle,i as normalizeClass,j as createVNode,t as toDisplayString,w as watch,k as getBezierPath,m as mergeProps,l as unref,S as SmoothStepEdge$1,p as withCtx,q as withDirectives,v as vShow,F as Fragment,s as renderList,x as createCommentVNode,_ as _sfc_main$3$1,P as Popover,y as createBlock,z as Position,A as _sfc_main$f$1,B as createTextVNode,C as Button,D as Modal,E as onMounted,G as PanOnScrollMode,H as normalizeProps,I as guardReactiveProps,J as _sfc_main$W,K as renderSlot,L as _sfc_main$1$1,T as Tooltip,N as Input,O as FormItem,Q as Textarea,R as onUnmounted,U as InputSearch,V as TabPane,W as Tabs,X as CascaderPanel,Y as useTemplateRef,Z as shallowRef,$ as nextTick,a0 as InputTag,a1 as reactive,a2 as useSortable,a3 as Form,a4 as Checkbox,a5 as Option,a6 as Select,a7 as TreeSelect,a8 as resolveComponent,a9 as Radio,aa as RadioGroup,ab as Slider,ac as Table,ad as createSlots,ae as InputNumber,af as Switch,ag as Alert,ah as CheckboxGroup,ai as withModifiers,aj as Transition,ak as Tag,al as Tree,am as resolveDynamicComponent,an as DatePicker,ao as sleep,ap as purify,aq as MarkdownIt,ar as container_plugin,as as MarkdownItHighlight,at as HighlightJS,au as bash,av as shell,aw as powershell,ax as csharp,ay as c,az as cpp,aA as less,aB as css,aC as json,aD as yaml,aE as xml,aF as java,aG as python,aH as sql,aI as javascript,aJ as typescript,aK as ButtonGroup,aL as Progress,aM as NewDocServiceV2,aN as IconQuestionCircle,aO as useModel,aP as Doption,aQ as Dropdown,aR as debounce,aS as createPinia,aT as createApp,aU as ArcoVue}from"./vendor-7uiE44Sw.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();if(typeof window<"u"){let e=function(){var t=document.body,a=document.getElementById("__svg__icons__dom__gpt__designer");a||(a=document.createElementNS("http://www.w3.org/2000/svg","svg"),a.style.position="absolute",a.style.width="0",a.style.height="0",a.id="__svg__icons__dom__gpt__designer",a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),a.innerHTML='<symbol fill="none"  viewBox="0 0 20 20" id="svg-add-bg"><rect width="20" height="20" rx="10" fill="#EBF2FF" /><path fill-rule="evenodd" clip-rule="evenodd" d="M9.2 14.55a.8.8 0 1 0 1.6 0V10.8h3.75a.8.8 0 0 0 0-1.6H10.8V5.45a.8.8 0 0 0-1.6 0V9.2H5.45a.8.8 0 0 0 0 1.6H9.2v3.75Z" fill="#266EFF" /></symbol><symbol fill="none"  viewBox="0 0 12 12" id="svg-add-card"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 1a5 5 0 1 1 0 10A5 5 0 0 1 6 1Zm-.5 7.5a.5.5 0 0 0 1 0v-2h2a.5.5 0 0 0 0-1h-2v-2a.5.5 0 0 0-1 0v2h-2a.5.5 0 0 0 0 1h2v2Z" fill="currentColor" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-add-sublevel"><rect x=".8" y="2" width="8" height="3" rx=".6" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" /><path d="M3 5v5a2 2 0 0 0 2 2h1M9 12h6M12 15V9" stroke="#999" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" /></symbol><symbol  viewBox="0 0 16 16" id="svg-add"><path d="M8 .8a7.2 7.2 0 1 1 0 14.4A7.2 7.2 0 0 1 8 .8ZM8 2a6 6 0 1 0 0 12A6 6 0 0 0 8 2Zm0 2.4a.6.6 0 0 1 .6.6v2.4H11a.6.6 0 1 1 0 1.2H8.6V11a.6.6 0 1 1-1.2 0V8.6H5a.6.6 0 0 1 0-1.2h2.4V5a.6.6 0 0 1 .6-.6Z" fill="#266EFF" fill-rule="evenodd" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-auxiliary"><path fill-rule="evenodd" clip-rule="evenodd" d="M19 2.929c0-.568-.504-1.03-1.125-1.03H2.125C1.504 1.9 1 2.362 1 2.93v3.02h18V2.93Zm-16.63.68a.675.675 0 1 1 .955.955.675.675 0 0 1-.954-.954Zm2.221 0a.675.675 0 1 1 .955.955.675.675 0 0 1-.955-.954Zm2.222 0a.675.675 0 1 1 .955.955.675.675 0 0 1-.955-.954ZM19 16.75v-9.9H1v9.9a1.35 1.35 0 0 0 1.35 1.35h15.3A1.35 1.35 0 0 0 19 16.75Zm-14.625-2.7h11.25a.675.675 0 1 1 0 1.35H4.375a.675.675 0 1 1 0-1.35Zm0-4.5h5.85a.675.675 0 0 1 0 1.35h-5.85a.675.675 0 0 1 0-1.35Z" fill="#30C4F6" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-back"><path d="M18.75 10c0 4.813-3.938 8.75-8.75 8.75-4.813 0-8.75-3.938-8.75-8.75 0-4.813 3.938-8.75 8.75-8.75 4.813 0 8.75 3.938 8.75 8.75ZM2.453 10c0 4.156 3.39 7.547 7.547 7.547 4.156 0 7.547-3.39 7.547-7.547 0-4.156-3.39-7.547-7.547-7.547-4.156 0-7.547 3.39-7.547 7.547Zm9.844-3.39L8.907 10l3.39 3.39c.219.22.219.547 0 .876-.219.218-.547.218-.875 0l-3.719-3.829c-.11-.109-.219-.328-.219-.437 0-.11.11-.328.22-.438l3.718-3.718c.328-.219.656-.219.875 0a.529.529 0 0 1 0 .765Z" fill="#999" /></symbol><symbol fill="none"  viewBox="0 0 48 20" id="svg-beta"><path d="M0 10C0 4.477 4.477 0 10 0h27.028c5.523 0 10 4.477 10 10s-4.477 10-10 10H0V10Z" fill="#FF9902" /><path d="M11.136 10.204h-1.128V9.4h3.108v.804h-1.128v3.252c.528-.12 1.056-.252 1.56-.396v.804c-1.044.3-2.172.552-3.372.756l-.216-.816c.396-.048.792-.108 1.176-.18v-3.42Zm4.548 5.136c-.408 0-.78-.312-1.092-.936-.36-.72-.624-1.692-.792-2.94-.132-1.056-.216-2.376-.264-3.948H9.732v-.84h3.78c-.024-.696-.024-1.428-.024-2.196h.84c0 .78 0 1.512.024 2.196h2.388v.84h-2.376c.06 2.064.192 3.648.384 4.776.264 1.368.576 2.064.936 2.112.24-.048.492-.78.732-2.208l.684.552c-.396 1.728-.864 2.592-1.416 2.592ZM15.36 4.468c.516.576.912 1.08 1.2 1.512l-.6.42c-.3-.468-.708-.984-1.212-1.56l.612-.372Zm-7.92.168a13.652 13.652 0 0 1 1.932 1.848l-.588.6c-.48-.588-1.128-1.212-1.944-1.86l.6-.588ZM6 8.188h2.52v5.232a26.1 26.1 0 0 0 1.104-1.152l.228.912c-.66.72-1.356 1.356-2.1 1.908l-.336-.768c.168-.144.264-.312.264-.492V9.016H6v-.828ZM20.052 8.704v2.1H23.1v-2.1h-3.048Zm-.048 2.892c-.132 1.536-.576 2.808-1.344 3.816l-.66-.588c.768-1.068 1.164-2.424 1.188-4.068v-5.76h8.94v8.988c0 .84-.42 1.26-1.26 1.26h-1.38l-.228-.852c.48.024.924.048 1.332.048.432 0 .66-.252.66-.756v-2.088h-3.264v3.516H23.1v-3.516h-3.096Zm7.248-.792v-2.1h-3.264v2.1h3.264Zm0-2.904V5.836h-3.264V7.9h3.264ZM23.1 5.836h-3.048V7.9H23.1V5.836ZM32.976 4.648h.84v3.18h.708v.852h-2.832v.612c0 .372-.012.732-.024 1.08h2.304v5.1h-.852V11.2h-1.5c-.144 1.8-.468 3.168-.984 4.128l-.648-.576c.552-1.14.84-2.964.852-5.46V4.888h.852v2.94h1.284v-3.18ZM36 8.812v1.32c-.048 2.232-.444 4.008-1.164 5.328l-.6-.636c.6-1.128.924-2.7.972-4.692V5.368c1.884-.024 3.588-.276 5.1-.756l.432.78c-1.416.408-3 .648-4.74.72v1.884h4.44v.732c-.276 1.668-.804 3.072-1.572 4.212a6.065 6.065 0 0 0 2.16 1.824l-.432.756a6.613 6.613 0 0 1-2.256-1.884 8.277 8.277 0 0 1-2.364 1.896l-.42-.768a7.873 7.873 0 0 0 2.28-1.86c-.684-1.116-1.164-2.484-1.44-4.092H36Zm1.176 0c.264 1.308.66 2.424 1.188 3.36.6-.96 1.02-2.088 1.236-3.36h-2.424Z" fill="#fff" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-data-knowledge"><path d="M17 2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h14ZM5.5 10a.5.5 0 0 0-.5.5v4a.5.5 0 0 0 .5.5H6a.5.5 0 0 0 .5-.5v-4A.5.5 0 0 0 6 10h-.5Zm4.25-2a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h.5a.5.5 0 0 0 .5-.5v-6a.5.5 0 0 0-.5-.5h-.5ZM14 5a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h.5a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5H14Z" fill="#30C4F6" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-document"><path d="M16.25 18.5H3.75c-.69 0-1.25-.546-1.25-1.214V2.714c0-.67.56-1.214 1.25-1.214H7.5v1.214H6.25V3.93H7.5v1.214H6.25v1.214H7.5v1.214H6.25v1.215H7.5V10H6.25v1.214H7.5v.003H10v-.003H8.75V10H10V8.786H8.75V7.57H10V6.357H8.75V5.143H10V3.929H8.75V1.5h2.5v6.071h6.25v9.715c0 .668-.559 1.214-1.25 1.214Zm-10-2.429H10v-3.643H6.25v3.643Zm1.25-2.428h1.25v1.214H7.5v-1.214Zm5-12.143 5 4.857h-5V1.5Z" fill="#FF9A57" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-down-line"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.024 5.576a.6.6 0 0 1 0 .848l-4.799 4.8a.6.6 0 0 1-.848 0L2.576 6.425a.6.6 0 0 1 .848-.848l4.377 4.375 4.375-4.376a.6.6 0 0 1 .848 0Z" fill="#8992A2" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-down"><path d="M8.312 11.61a.4.4 0 0 1-.624 0L3.187 5.983a.4.4 0 0 1 .312-.65H12.5a.4.4 0 0 1 .312.65l-4.5 5.627Z" fill="#999" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-drop"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.4 3.2a1.2 1.2 0 1 0 2.4 0 1.2 1.2 0 0 0-2.4 0Zm4.8 0a1.2 1.2 0 1 0 2.4 0 1.2 1.2 0 0 0-2.4 0Zm-3.6 6a1.2 1.2 0 1 1 0-2.4 1.2 1.2 0 0 1 0 2.4ZM9.2 8a1.2 1.2 0 1 0 2.4 0 1.2 1.2 0 0 0-2.4 0Zm-3.6 6a1.2 1.2 0 1 1 0-2.4 1.2 1.2 0 0 1 0 2.4Zm3.6-1.2a1.2 1.2 0 1 0 2.4 0 1.2 1.2 0 0 0-2.4 0Z" fill="#999" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-edit"><path d="M13.454 13.4c.316 0 .546.268.546.6 0 .32-.214.58-.546.6H2.545C2.23 14.6 2 14.33 2 14c0-.32.214-.58.545-.6h10.91Z" fill="currentColor" /><path fill-rule="evenodd" clip-rule="evenodd" d="m11.416 1.176 2.263 2.262a.6.6 0 0 1 0 .849l-7.636 7.637a.6.6 0 0 1-.331.168l-2.687.424a.6.6 0 0 1-.686-.686l.424-2.687a.6.6 0 0 1 .168-.33l7.637-7.637a.6.6 0 0 1 .848 0Zm-6.084 9.76 7.074-7.074-1.414-1.414-7.074 7.074-.266 1.68 1.68-.265Z" fill="currentColor" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-folder-fill"><path d="M2.2 1.4A1.2 1.2 0 0 0 1 2.6v3.6h14V4.6a1.2 1.2 0 0 0-1.2-1.2H8.19L6.8 1.695a.8.8 0 0 0-.62-.295H2.2ZM15 7.4H1v6a1.2 1.2 0 0 0 1.2 1.2h11.6a1.2 1.2 0 0 0 1.2-1.2v-6Z" fill="#C5C5C5" /></symbol><symbol  viewBox="0 0 16 16" id="svg-full"><path d="M5.5 2a.5.5 0 1 1 0 1H3.716l2.47 2.444a.5.5 0 0 1-.704.711L3 3.7V5.5a.5.5 0 0 1-.41.492L2.5 6a.5.5 0 0 1-.5-.5v-3l.003-.051.014-.076.014-.045.035-.076.033-.051.046-.053.04-.036.063-.044.062-.03.06-.02.057-.013L2.5 2h3Zm.652 7.811a.5.5 0 0 1 .003.707L3.698 13H5.5a.5.5 0 0 1 .492.41L6 13.5a.5.5 0 0 1-.5.5h-3l-.051-.003-.076-.013-.064-.022-.057-.028-.072-.05-.032-.029-.036-.04-.055-.084-.031-.073-.018-.07L2 13.5v-3a.5.5 0 1 1 1 0v1.783l2.445-2.468a.5.5 0 0 1 .707-.004Zm4.367.034L13 12.3V10.5a.5.5 0 0 1 .41-.492L13.5 10a.5.5 0 0 1 .5.5v3a.502.502 0 0 1-.01.101l-.028.09-.04.078-.021.03-.045.053-.04.036-.064.044-.061.03-.06.02-.06.013-.07.005h-3a.5.5 0 0 1 0-1h1.783l-2.469-2.444a.5.5 0 0 1 .704-.711ZM10.5 2h3c.032 0 .062.003.092.008l.085.024.05.022.06.037.046.036.017.015.041.046-.054-.058c.03.028.057.059.079.092l.034.058.022.054.022.084.005.048L14 5.5a.5.5 0 1 1-1 0V3.792l-2.13 2.344a.5.5 0 0 1-.74-.673L12.37 3H10.5a.5.5 0 0 1-.492-.41L10 2.5a.5.5 0 0 1 .5-.5Z" fill="#999" fill-rule="nonzero" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-fx"><rect x="1" y="1" width="14" height="14" rx="7" fill="#266EFF" /><path fill-rule="evenodd" clip-rule="evenodd" d="M6.778 7.204v-.852H5.602v-.49c0-.241.055-.426.164-.554.11-.128.296-.192.554-.192.11 0 .206.011.284.032.078.02.142.036.191.05l.249-.86a2.475 2.475 0 0 0-.337-.092 2.429 2.429 0 0 0-.547-.053c-.289 0-.557.057-.803.17-.246.112-.444.281-.593.508-.149.225-.224.508-.224.85v.631h-.845v.852h.845v4.603h1.062V7.204h1.176Zm3.137 1.272L8.711 6.352H7.547L9.223 9.08l-1.698 2.727H8.69l1.225-2.039 1.229 2.039h1.161L10.59 9.08l1.701-2.728H11.13L9.915 8.476Z" fill="#fff" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-help"><circle cx="8" cy="8" r="6.5" stroke="currentColor" /><path d="M6.4 6.733C6.4 5.776 7.133 5 8.036 5c.904 0 1.637.776 1.637 1.733 0 .262-.055.465-.154.622-.48.766-1.483 1.241-1.483 2.145v0" stroke="#fff" stroke-linecap="round" /><circle cx=".5" cy=".5" r=".5" transform="matrix(-1 0 0 1 8.5 11)" fill="#fff" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-image"><path d="M10.015 2.001c2.206 0 4.41-.003 6.617.001 1.603.004 2.366.733 2.367 2.259v11.466c-.001 1.524-.769 2.267-2.367 2.269-4.41.005-8.822.005-13.233 0-1.65-.002-2.393-.717-2.396-2.298C1 11.895 1 8.092 1.003 4.289c.003-1.569.755-2.283 2.398-2.287 2.203-.003 4.409 0 6.614 0Zm-3.509 8.61-3.481 4.448H16.98L12.5 9.191l-3.493 4.307c-.857-.988-1.65-1.906-2.5-2.887ZM5.414 7.753c1.04.006 1.832-.748 1.826-1.74-.006-.948-.809-1.736-1.783-1.75-.997-.014-1.855.785-1.865 1.734-.01.986.784 1.75 1.822 1.756Z" fill="#3CD4A1" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-implement"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 13.8A5.8 5.8 0 1 0 8 2.2a5.8 5.8 0 0 0 0 11.6ZM8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" fill="#266EFF" /><path d="M10.25 7.567a.5.5 0 0 1 0 .866l-3 1.732a.5.5 0 0 1-.75-.433V6.268a.5.5 0 0 1 .75-.433l3 1.732Z" fill="#266EFF" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-intention"><path d="M10.391 0a7.683 7.683 0 0 0-7.68 7.648v1.274l-1.554 2.964c-.392.752-.023 1.364.825 1.364h.73v2.826a1.593 1.593 0 0 0 1.593 1.594l2.205-.319v2.23a.436.436 0 0 0 .545.405l7.966-1.405a.688.688 0 0 0 .545-.637v-4.672A7.648 7.648 0 0 0 10.391 0ZM8.122 3.795a4.5 4.5 0 0 0-2.23 3.885.822.822 0 1 1-1.641 0 6.163 6.163 0 0 1 3.052-5.31.822.822 0 0 1 .823 1.422l-.004.003Zm2.231-.599a.822.822 0 1 1 .844-.825.82.82 0 0 1-.831.816l-.013.01Z" fill="#A67FDD" /></symbol><symbol  viewBox="0 0 20 20" id="svg-interactive"><path d="m12.4 12.4 7.6 2.85-3.8.95-.95 3.8-2.85-7.6ZM18.1 1v9.5h-1.9V2.9H2.9v13.3h6.65v1.9H1V1h17.1Zm-3.8 3.8v6.365L9.55 9.55l1.596 4.75H4.8V4.8h9.5Z" fill="#3CD4A1" fill-rule="nonzero" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-keyboard"><path clip-rule="evenodd" d="M2.8 2.6a1.2 1.2 0 0 0-1.2 1.2v8.4a1.2 1.2 0 0 0 1.2 1.2h10.4a1.2 1.2 0 0 0 1.2-1.2V3.8a1.2 1.2 0 0 0-1.2-1.2H2.8Z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" /><path d="M4.2 9.6h7.6M9.4 6.4h2.4M4.2 6.4H5M6.8 6.4h.8" stroke="#999" stroke-width="1.2" stroke-linecap="round" /></symbol><symbol  viewBox="0 0 20 20" id="svg-knowledge"><path d="M7.5 1.667a.833.833 0 0 0-.833.833V5c0 .46.373.833.833.833h6.667c.46 0 .833-.373.833-.833V2.5a.833.833 0 0 0-.833-.833H7.5Zm0 6.25a.833.833 0 0 0-.833.833v2.5c0 .46.373.833.833.833h8.334c.46 0 .833-.373.833-.833v-2.5a.833.833 0 0 0-.833-.833H7.5Zm0 6.25a.833.833 0 0 0-.833.833v2.5c0 .46.373.833.833.833h10.834c.46 0 .833-.373.833-.833V15a.833.833 0 0 0-.833-.833H7.5ZM3.334 2.083a1.667 1.667 0 1 0 0 3.334 1.667 1.667 0 0 0 0-3.334Zm0 6.25a1.667 1.667 0 1 0 0 3.334 1.667 1.667 0 0 0 0-3.334Zm0 6.25a1.667 1.667 0 1 0 0 3.334 1.667 1.667 0 0 0 0-3.334Z" fill="#8090D3" fill-rule="evenodd" /></symbol><symbol  viewBox="0 0 16 16" id="svg-location"><path d="M13.5 2a.5.5 0 0 1 .5.5v3a.5.5 0 1 1-1 0V3h-2.5a.5.5 0 0 1-.492-.41L10 2.5a.5.5 0 0 1 .5-.5h3Zm-8 0a.5.5 0 1 1 0 1H3v2.5a.5.5 0 0 1-.41.492L2.5 6a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5h3Zm-3 8a.5.5 0 0 1 .5.5V13h2.5a.5.5 0 0 1 .492.41L6 13.5a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-3a.5.5 0 0 1 .5-.5Zm11 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1 0-1H13v-2.5a.5.5 0 0 1 .41-.492L13.5 10Z" fill="#999" fill-rule="nonzero" /></symbol><symbol fill="none"  viewBox="0 0 18 18" id="svg-merge"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.808.31A1.059 1.059 0 0 0 .31 1.808l7.102 7.101v3.797H4.235L8.471 18l4.235-5.294H9.529V8.032L1.808.31ZM17.69 1.808A1.059 1.059 0 1 0 16.192.31l-5.294 5.294a1.059 1.059 0 1 0 1.498 1.498l5.294-5.294Z" fill="#FF9902" /></symbol><symbol  viewBox="0 0 20 20" id="svg-message"><path d="M18.437 4.832c.862 0 1.563.7 1.563 1.563v8.611c0 .863-.7 1.564-1.563 1.564h-1.788v1.217c0 .282-.144.55-.389.69a.783.783 0 0 1-.847-.04l-2.788-1.98h-2.343a1.565 1.565 0 0 1-1.564-1.563V13.86h4.488c.576 0 1.042-.467 1.042-1.043V4.832h4.189ZM11.79 1.417c.862 0 1.563.701 1.563 1.564v8.575c0 .862-.7 1.563-1.563 1.563H6.873l-2.8 2.033a.777.777 0 0 1-.813.063.778.778 0 0 1-.427-.696v-1.397h-1.27A1.565 1.565 0 0 1 0 11.558V2.981c0-.863.701-1.564 1.564-1.564H11.79Z" fill="#58CBD3" fill-rule="evenodd" /></symbol><symbol  viewBox="0 0 16 16" id="svg-minus"><path d="M8 .8a7.2 7.2 0 1 1 0 14.4A7.2 7.2 0 0 1 8 .8ZM8 2a6 6 0 1 0 0 12A6 6 0 0 0 8 2Zm3 5.4a.6.6 0 1 1 0 1.2H5a.6.6 0 0 1 0-1.2h6Z" fill="#999" fill-rule="evenodd" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-more"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.8 8a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0Zm5.4 0a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0Zm4.2 1.2a1.2 1.2 0 1 0 0-2.4 1.2 1.2 0 0 0 0 2.4Z" fill="#999" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-page"><path fill-rule="evenodd" clip-rule="evenodd" d="M19 2.929c0-.568-.504-1.03-1.125-1.03H2.125C1.504 1.9 1 2.362 1 2.93v3.02h18V2.93Zm-16.629.68a.675.675 0 1 1 .955.955.675.675 0 0 1-.955-.954Zm2.22 0a.675.675 0 1 1 .955.955.675.675 0 0 1-.955-.954Zm2.223 0a.675.675 0 1 1 .954.955.675.675 0 0 1-.954-.954ZM19 16.75v-9.9H1v9.9a1.35 1.35 0 0 0 1.35 1.35h15.3A1.35 1.35 0 0 0 19 16.75Zm-14.625-2.7h11.25a.675.675 0 1 1 0 1.35H4.375a.675.675 0 1 1 0-1.35Zm0-4.5h5.85a.675.675 0 0 1 0 1.35h-5.85a.675.675 0 1 1 0-1.35Z" fill="#FFAE78" /></symbol><symbol fill="none"  viewBox="0 0 40 40" id="svg-plug-in"><rect x=".5" y=".5" width="39" height="39" rx="5.5" fill="#fff" /><rect x=".5" y=".5" width="39" height="39" rx="5.5" stroke="currentColor" /><path d="M29.286 18.857h-1.629v-4.343a2.178 2.178 0 0 0-2.171-2.171h-4.343v-1.629a2.714 2.714 0 0 0-5.429 0v1.629h-4.342c-1.195 0-2.16.977-2.16 2.171v4.126h1.617a2.933 2.933 0 0 1 2.931 2.931 2.933 2.933 0 0 1-2.931 2.932H9.2v4.126c0 1.194.977 2.171 2.172 2.171h4.125v-1.629a2.933 2.933 0 0 1 2.932-2.931 2.933 2.933 0 0 1 2.931 2.931V30.8h4.126a2.178 2.178 0 0 0 2.171-2.171v-4.343h1.629a2.714 2.714 0 1 0 0-5.429Z" fill="#FFBF61" /></symbol><symbol  viewBox="0 0 20 20" id="svg-plugin"><path d="M17.738 9.048h-1.357v-3.62c0-.995-.814-1.809-1.81-1.809h-3.618V2.262a2.262 2.262 0 1 0-4.524 0v1.357h-3.62c-.995 0-1.8.814-1.8 1.81v3.438h1.348A2.444 2.444 0 0 1 4.8 11.309a2.444 2.444 0 0 1-2.443 2.443H1v3.438c0 .996.814 1.81 1.81 1.81h3.438v-1.357A2.444 2.444 0 0 1 8.69 15.2a2.444 2.444 0 0 1 2.442 2.443V19h3.439c.995 0 1.81-.814 1.81-1.81v-3.619h1.356a2.262 2.262 0 1 0 0-4.523Z" fill="#FFBF61" fill-rule="nonzero" /></symbol><symbol  viewBox="0 0 16 16" id="svg-preview"><path d="M8 3.545c1.979 0 3.714 1.067 4.906 2.056a13.777 13.777 0 0 1 1.431 1.377l.263.302.27.334.004.485v-.48c.147.198.166.46.055.674l-.067.103-.133.17c-.091.111-.223.268-.392.456l-.28.303a13.66 13.66 0 0 1-1.15 1.074c-1.193.989-2.928 2.056-4.907 2.056s-3.713-1.067-4.906-2.056c-.53-.439-.97-.877-1.298-1.23l-.133-.147c-.101-.112-.19-.214-.263-.302l-.27-.334a.64.64 0 0 1-.059-.679l.067-.103.133-.17c.073-.089.172-.207.295-.347l.097-.11c.337-.374.826-.874 1.43-1.376C4.288 4.612 6.022 3.545 8 3.545Zm0 2.228a2.227 2.227 0 1 0 0 4.454 2.227 2.227 0 0 0 0-4.454Z" fill="#E7E7E7" fill-rule="evenodd" /></symbol><symbol  viewBox="0 0 20 20" id="svg-prompt"><g fill="#6393FF" fill-rule="evenodd"><path d="m13.334 1.488.06.053 3.801 3.628c.02.019.038.038.056.058h-3.71a.213.213 0 0 1-.146-.058.194.194 0 0 1-.061-.14V1.487Z" /><path d="M12.5 1.25v3.778c0 .264.11.517.306.703.195.187.46.291.736.292H17.5v11.733c0 .263-.11.516-.305.702-.195.187-.46.292-.736.292H3.542c-.276 0-.541-.105-.736-.292a.973.973 0 0 1-.306-.702V2.244c0-.263.11-.516.306-.702.195-.187.46-.292.736-.292H12.5Zm2 11.25h-9a.5.5 0 0 0-.5.5v.25a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V13a.5.5 0 0 0-.5-.5ZM12 8.75H5.5a.5.5 0 0 0-.5.5v.25a.5.5 0 0 0 .5.5H12a.5.5 0 0 0 .5-.5v-.25a.5.5 0 0 0-.5-.5Z" /></g></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-right"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.576 2.976a.6.6 0 0 1 .848 0l4.8 4.799a.6.6 0 0 1 0 .848l-4.799 4.801a.6.6 0 1 1-.849-.848l4.375-4.377-4.375-4.375a.6.6 0 0 1 0-.848Z" fill="#8992A2" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-save"><path clip-rule="evenodd" d="M3.8 14.4a1.2 1.2 0 0 1-1.2-1.2V2.8a1.2 1.2 0 0 1 1.2-1.2h5.703a1.2 1.2 0 0 1 .848.351l2.697 2.698a1.2 1.2 0 0 1 .352.848V13.2a1.2 1.2 0 0 1-1.2 1.2H3.8Z" stroke="currentColor" stroke-width="1.2" stroke-linejoin="round" /><path d="M5.6 1.6h4v2a.4.4 0 0 1-.4.4H6a.4.4 0 0 1-.4-.4v-2Z" stroke="#fff" stroke-width="1.2" stroke-linejoin="round" /><circle cx="8" cy="9" r="1.6" stroke="#fff" stroke-width="1.2" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-selector"><path d="M19.025 10.87h-1.701l-2.111-2.114h.429a.976.976 0 0 0 .975-.976V.976A.976.976 0 0 0 15.642 0H4.337a.976.976 0 0 0-.976.976V7.78c0 .539.437.976.976.976h.45l-2.11 2.115H.975a.976.976 0 0 0-.975.976v3.424c0 .538.437.976.975.976h3.42a.976.976 0 0 0 .976-.976v-3.424a.973.973 0 0 0-.254-.658l2.43-2.433h1.466v5.868h-.734a.976.976 0 0 0-.975.976v3.424c0 .539.437.976.975.976h3.42a.976.976 0 0 0 .976-.976V15.6a.976.976 0 0 0-.976-.976h-.735V8.756h1.488l2.43 2.433a.974.974 0 0 0-.253.658v3.424c0 .538.437.976.976.976h3.42A.976.976 0 0 0 20 15.27v-3.424a.975.975 0 0 0-.975-.976ZM5.5 1.954h9V6.5h-9V1.953Z" fill="#40A3FF" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-setting"><circle cx="8" cy="8" r="2.2" stroke="currentColor" stroke-width="1.2" /><path clip-rule="evenodd" d="M7.4 1.346a1.2 1.2 0 0 1 1.2 0l4.862 2.808c.371.214.6.61.6 1.039v5.614a1.2 1.2 0 0 1-.6 1.04L8.6 14.653a1.2 1.2 0 0 1-1.2 0l-4.862-2.808a1.2 1.2 0 0 1-.6-1.039V5.193a1.2 1.2 0 0 1 .6-1.04L7.4 1.347Z" stroke="currentColor" stroke-width="1.2" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-smart-check"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.905 2.616v14.319c.017.058.032.117.047.176.033.13.066.261.124.383.355.77.973 1.169 1.815 1.173 1.643.008 3.286.007 4.93.005l1.97-.001a.064.064 0 0 0 .017-.003c.006-.002.015-.005.028-.007l-.084-.033c-.023-.008-.043-.017-.065-.024-2.01-.74-3.238-2.157-3.677-4.255l-.003-.013c-.036-.175-.036-.176-.223-.176h-.459c-.458 0-.916 0-1.375-.002-.358-.002-.614-.222-.662-.556a.635.635 0 0 1 .536-.711c.075-.01.153-.014.23-.014l.849-.001.849-.001h.057c.134.003.134.003.156-.183.055-.466.167-.915.344-1.35l.03-.084.03-.089H4.998c-.29 0-.522-.1-.655-.372a.635.635 0 0 1 .498-.905c.068-.008.137-.008.204-.008l1.189-.001c.595 0 1.19 0 1.785-.003.067 0 .159-.026.2-.073a5.612 5.612 0 0 1 2.234-1.59.296.296 0 0 0 .028-.015c.013-.008.032-.019.061-.034H4.977c-.366 0-.629-.201-.687-.526a.636.636 0 0 1 .504-.738c.07-.013.144-.019.215-.019h9.7c.394 0 .665.216.713.566a.633.633 0 0 1-.569.711c-.08.005-.159.006-.24.006-.08 0-.161.001-.244.006 1.745.722 2.885 1.98 3.428 3.792V2.85A1.939 1.939 0 0 0 15.908.908h-.005c-.053-.002-.104-.004-.157-.004-3.93 0-7.862 0-11.792-.002-.785 0-1.395.313-1.791.992-.076.13-.12.278-.166.426-.02.065-.04.13-.062.194l-.022.072-.008.03Zm12.757 2.562H5.034a1.06 1.06 0 0 1-.358-.053.624.624 0 0 1-.395-.647.637.637 0 0 1 .533-.571c.07-.012.142-.014.216-.014h1.928c2.571 0 5.141-.001 7.712.004.153 0 .32.036.454.105.244.125.351.42.286.688a.647.647 0 0 1-.559.481c-.063.007-.126.007-.189.007Zm3.28 13.266a12.5 12.5 0 0 1 .13-.151v-.437a4.583 4.583 0 0 1-.069-.094c-.056-.079-.113-.157-.18-.226-.43-.439-.868-.874-1.305-1.307-.122-.122-.248-.243-.373-.362l-.176-.168c1.283-1.997.696-4.394-.898-5.64a4.211 4.211 0 0 0-5.428.185 4.209 4.209 0 0 0-.753 5.337c.545.87 1.303 1.476 2.283 1.785 1.275.402 2.483.217 3.633-.5l.031.042c.02.029.04.056.063.08l1.785 1.787c.299.296.66.303.958.004.105-.106.202-.22.299-.335Zm-5.457-7.602c1.394.02 2.529 1.162 2.507 2.527-.023 1.398-1.166 2.533-2.536 2.523-1.4-.012-2.539-1.167-2.513-2.548.027-1.409 1.16-2.523 2.542-2.502Z" fill="#A67FDD" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-start"><g clip-path="url(#svg-start_a)"><path d="M8 .8a7.2 7.2 0 1 0 0 14.4A7.2 7.2 0 0 0 8 .8Zm3.051 7.61-4.556 2.63a.473.473 0 0 1-.71-.41V5.37c0-.365.394-.592.71-.41l4.556 2.63a.473.473 0 0 1 0 .82Z" fill="#3CD4A1" /></g><defs><clipPath id="svg-start_a"><path fill="#fff" d="M0 0h16v16H0z" /></clipPath></defs></symbol><symbol  viewBox="0 0 16 16" id="svg-success"><g fill="none" fill-rule="evenodd"><path d="M2.815 2.815A7.313 7.313 0 0 1 8 .667c2.025 0 3.86.821 5.186 2.148A7.312 7.312 0 0 1 15.334 8c0 2.025-.822 3.86-2.148 5.186A7.313 7.313 0 0 1 8 15.333a7.313 7.313 0 0 1-5.185-2.147A7.313 7.313 0 0 1 .667 8c0-2.025.822-3.86 2.148-5.185Z" fill="currentColor" /><path d="M11.805 5.529c.26.26.26.682 0 .942l-4 4a.667.667 0 0 1-.943 0l-2-2a.667.667 0 1 1 .943-.942l1.529 1.528 3.528-3.528c.26-.26.683-.26.943 0Z" fill="#FFF" /></g></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-system"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.797 1.823h12.354c.31 0 .562.252.562.561v9.547a.563.563 0 0 1-.562.561H1.797a.563.563 0 0 1-.562-.561V2.384c0-.309.253-.561.562-.561ZM4 4h2l2 2 2-2h2L9 7l3 3h-2L8 8l-2 2H4l3-3-3-3Z" fill="#6393FF" /><path d="M3.762 14h8.424v1.123H3.762V14Z" fill="#6393FF" /></symbol><symbol fill="none"  viewBox="0 0 20 20" id="svg-template"><path d="M16.75 1H3.25A2.257 2.257 0 0 0 1 3.25v13.5A2.257 2.257 0 0 0 3.25 19h13.5A2.257 2.257 0 0 0 19 16.75V3.25A2.257 2.257 0 0 0 16.75 1Zm-1.125 6.75H14.5c0-.675-.45-1.125-1.125-1.125h-2.25v6.863c0 .562.45 1.012 1.012 1.012h.113v1.125h-4.5V14.5h.112c.563 0 1.013-.45 1.013-1.012V6.625h-2.25c-.675 0-1.125.45-1.125 1.125H4.375V5.5h11.25v2.25Z" fill="#40A3FF" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-tips"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 1a7 7 0 1 1 0 14A7 7 0 0 1 8 1Zm0 5.639c.322 0 .583.261.583.583v4.084a.583.583 0 0 1-1.166 0V7.222c0-.322.26-.583.583-.583ZM8 4.11a.778.778 0 1 1 0 1.556.778.778 0 0 1 0-1.556Z" fill="#999" /></symbol><symbol fill="none"  viewBox="0 0 16 16" id="svg-trash"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 3.4a.6.6 0 1 1 0 1.2h-.824l-.353 8.848a1.2 1.2 0 0 1-1.155 1.151l-.044.001H4.375a1.2 1.2 0 0 1-1.196-1.107l-.003-.045L2.823 4.6H2a.6.6 0 0 1 0-1.2h2.3l.22-1.215a1.2 1.2 0 0 1 1.133-.984L5.7 1.2h4.598a1.2 1.2 0 0 1 1.171.938l.01.047.22 1.215H14Zm-2.025 1.2h-7.95l.351 8.8h7.247l.352-8.8ZM5.701 2.4h4.598l.182 1H5.519l.182-1Z" fill="currentColor" /></symbol><symbol fill="none"  viewBox="0 0 14 14" id="svg-variable-icon"><path d="M8.228.962c.417 0 .818.167 1.113.462l2.36 2.36c.296.295.461.696.461 1.114v6.74c0 .869-.705 1.574-1.575 1.574h-7.35c-.87 0-1.575-.705-1.575-1.575v-9.1c0-.87.706-1.575 1.576-1.575h4.99Zm-4.99 1.05a.526.526 0 0 0-.526.525v9.1c0 .29.236.525.526.525h7.35c.29 0 .525-.235.525-.525v-6.3h-1.75c-.87 0-1.576-.705-1.576-1.575v-1.75h-4.55Zm3.5 7.35a.525.525 0 0 1 0 1.05h-2.45a.526.526 0 0 1 0-1.05h2.45Zm2.8-2.624a.525.525 0 1 1 0 1.05h-5.25a.526.526 0 0 1 0-1.05h5.25Zm-.7-2.976c0 .29.235.525.525.525h1.357L8.837 2.405v1.357Z" fill="#266EFF" /></symbol><symbol fill="none"  viewBox="0 0 24 24" id="svg-warning"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 0c6.627 0 12 5.373 12 12s-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0Zm0 16a1.333 1.333 0 1 1 0 2.667A1.333 1.333 0 0 1 12 16Zm0-10.667a1 1 0 0 1 1 1v7a1 1 0 1 1-2 0v-7a1 1 0 0 1 1-1Z" fill="currentColor" /></symbol>',t.insertBefore(a,t.lastChild)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}const _imports_0="/gptbuilder/designer/assets/404-BYW5qis1.png",_export_sfc=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a},_sfc_main$V={},_hoisted_1$B={class:"page-404 w-full h-full flex items-center justify-center flex-col"};function _sfc_render(e,t){return openBlock(),createElementBlock("div",_hoisted_1$B,t[0]||(t[0]=[createBaseVNode("img",{src:_imports_0,class:"w-[270px] h-[270px]"},null,-1),createBaseVNode("p",{class:"-mt-[58px] text-[#333333] text-lg not-italic font-normal leading-[26px]"}," 哎呀，出错了！ ",-1)]))}const ErrorView=_export_sfc(_sfc_main$V,[["render",_sfc_render]]),useConditionStore=defineStore("condition",{state:()=>({activeId:""}),getters:{conditionId:e=>e.activeId.split("_")?.[2]||""},actions:{setActive(e){this.activeId=e}}});function getParams(){var e={},t=window.location.href.split("?");return t.length>1&&(t=t[1].split("&"),t.forEach(a=>{var[o,n]=a.split("=");e[decodeURIComponent(o)]=decodeURIComponent(n||"")})),e}const CHINESE_NUMBERS="零一二三四五六七八九",CHINESE_UNITS=["","十","百","千","万"],numberToChineseCapital=e=>{if(e===0)return CHINESE_NUMBERS[0];let t="",a=!1;for(let o=0;e>0;o++){const n=e%10;e=Math.floor(e/10),n===0?a||(a=!0,t=CHINESE_NUMBERS[0]+t):(a=!1,t=CHINESE_NUMBERS[n]+(CHINESE_UNITS[o]||"")+t,o!==0&&CHINESE_UNITS[o]==="十"&&t.startsWith(CHINESE_NUMBERS[0])&&(t=t.slice(1)))}if(t.startsWith(CHINESE_NUMBERS[1]+CHINESE_UNITS[1])&&(t=t.slice(1)),e%10===0&&t.endsWith(CHINESE_NUMBERS[0])){const o=t.lastIndexOf(CHINESE_NUMBERS[0]);t=t.slice(0,o)}return t},getStepName=e=>e<0?"":`步骤${numberToChineseCapital(e+1)}：`,getSaveTime=()=>{const[,e]=new Date().toLocaleString().split(" ");return e},Guid=()=>{var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=e,a=[],o,n;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",o=0;o<36;o++)a[o]||(n=0|Math.random()*16,a[o]=t[o==19?n&3|8:n]);var r=a.join("");return r};function generateCode(e=10){const t="abcdefghijklmnopqrstuvwxyz0123456789";let a="";const o=t.length;for(let n=0;n<e;n++)a+=t.charAt(Math.floor(Math.random()*o));return a}function validateURL(e){var t=new RegExp("^(https?://)?(([0-9]{1,3}\\.){3}[0-9]{1,3}|([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,})(:[0-9]{1,5})?(/[-a-zA-Z0-9()@:%_+.~#?&//=]*)?(\\?[;&a-zA-Z0-9()@:%_+.~#?&//=]*)?(#[-a-zA-Z0-9_]*)?$","i");return t.test(e)}const CARD_TYPE={START:"Start",INTERACTIVE:"Card_interactive",MESSAGE:"Card_message",PROMPT:"PromptTemplate",KNOWLEDGE:"Knowledge",PLUGIN:"Plugin",SELECTOR:"Selector",FINISH:"End",CONDITION:"Condition",CONDITION_MERGE:"Merge",PAGE:"Page",DOCUMENT_ANALYSIS:"DocumentAnalysis",AUXILIARY_INPUT:"FormBinding",TEXT_TEMPLATE:"TextTemplate",IMAGE_ANALYSIS:"ImageAnalysis",INTENTION_RECOGNITION:"Classification",SMART_CHECK:"Plan",CHAT_BI:"ChatBI"},CARD_ID_NAME={[CARD_TYPE.START]:"start",[CARD_TYPE.INTERACTIVE]:"card",[CARD_TYPE.MESSAGE]:"card",[CARD_TYPE.PROMPT]:"promptTemplate",[CARD_TYPE.KNOWLEDGE]:"knowledge",[CARD_TYPE.PLUGIN]:"plugin",[CARD_TYPE.SELECTOR]:"selector",[CARD_TYPE.CONDITION]:"condition",[CARD_TYPE.CONDITION_MERGE]:"merge",[CARD_TYPE.PAGE]:"page",[CARD_TYPE.DOCUMENT_ANALYSIS]:"documentAnalysis",[CARD_TYPE.AUXILIARY_INPUT]:"formBinding",[CARD_TYPE.TEXT_TEMPLATE]:"textTemplate",[CARD_TYPE.IMAGE_ANALYSIS]:"imageAnalysis",[CARD_TYPE.INTENTION_RECOGNITION]:"classification",[CARD_TYPE.SMART_CHECK]:"plan",[CARD_TYPE.CHAT_BI]:"chatBI"},ACTION_NAME={[CARD_TYPE.START]:"开始",[CARD_TYPE.INTERACTIVE]:"交互卡片",[CARD_TYPE.MESSAGE]:"消息卡片",[CARD_TYPE.PROMPT]:"提示词",[CARD_TYPE.KNOWLEDGE]:"知识库",[CARD_TYPE.PLUGIN]:"调用插件",[CARD_TYPE.SELECTOR]:"选择器",[CARD_TYPE.FINISH]:"结束",[CARD_TYPE.CONDITION]:"卡片规则",[CARD_TYPE.CONDITION_MERGE]:"合流",[CARD_TYPE.PAGE]:"页面",[CARD_TYPE.DOCUMENT_ANALYSIS]:"文档分析",[CARD_TYPE.AUXILIARY_INPUT]:"辅助录入",[CARD_TYPE.TEXT_TEMPLATE]:"文本模板",[CARD_TYPE.IMAGE_ANALYSIS]:"图片分析",[CARD_TYPE.INTENTION_RECOGNITION]:"意图识别",[CARD_TYPE.SMART_CHECK]:"智能检查",[CARD_TYPE.CHAT_BI]:"数据查询与总结"},CARD_DESCRIPTION={[CARD_TYPE.INTERACTIVE]:{label:"交互卡片",type:CARD_TYPE.INTERACTIVE,icon:"interactive",describe:"交互卡片",splitLine:!0},[CARD_TYPE.MESSAGE]:{label:"消息卡片",type:CARD_TYPE.MESSAGE,icon:"message",describe:"消息卡片",splitLine:!1},[CARD_TYPE.PROMPT]:{label:"提示词",type:CARD_TYPE.PROMPT,icon:"prompt",describe:"提示词",splitLine:!1},[CARD_TYPE.KNOWLEDGE]:{label:"知识库",type:CARD_TYPE.KNOWLEDGE,icon:"knowledge",describe:"知识库",splitLine:!1},[CARD_TYPE.CHAT_BI]:{label:"数据查询与总结",type:CARD_TYPE.CHAT_BI,icon:"data-knowledge",describe:"数据查询与总结",splitLine:!0},[CARD_TYPE.PLUGIN]:{label:"插件",type:CARD_TYPE.PLUGIN,icon:"plugin",describe:"插件",splitLine:!1},[CARD_TYPE.SELECTOR]:{label:"选择器",type:CARD_TYPE.SELECTOR,icon:"selector",describe:"选择器",splitLine:!1},[CARD_TYPE.PAGE]:{label:"页面",type:CARD_TYPE.PAGE,icon:"page",describe:"页面",splitLine:!1},[CARD_TYPE.DOCUMENT_ANALYSIS]:{label:"文档分析",type:CARD_TYPE.DOCUMENT_ANALYSIS,icon:"document",describe:"文档分析",splitLine:!1},[CARD_TYPE.AUXILIARY_INPUT]:{label:"辅助录入",type:CARD_TYPE.AUXILIARY_INPUT,icon:"auxiliary",describe:"辅助录入",splitLine:!1},[CARD_TYPE.TEXT_TEMPLATE]:{label:"文本模板",type:CARD_TYPE.TEXT_TEMPLATE,icon:"template",describe:"文本模板",splitLine:!0},[CARD_TYPE.IMAGE_ANALYSIS]:{label:"图片分析",type:CARD_TYPE.IMAGE_ANALYSIS,icon:"image",describe:"图片分析",splitLine:!1},[CARD_TYPE.INTENTION_RECOGNITION]:{label:"意图识别",type:CARD_TYPE.INTENTION_RECOGNITION,icon:"intention",describe:"意图识别",splitLine:!1},[CARD_TYPE.SMART_CHECK]:{label:"智能检查",type:CARD_TYPE.SMART_CHECK,icon:"smart-check",describe:"智能检查",splitLine:!1}},CARD_LIST=[CARD_DESCRIPTION[CARD_TYPE.PROMPT],CARD_DESCRIPTION[CARD_TYPE.KNOWLEDGE],CARD_DESCRIPTION[CARD_TYPE.AUXILIARY_INPUT],CARD_DESCRIPTION[CARD_TYPE.DOCUMENT_ANALYSIS],CARD_DESCRIPTION[CARD_TYPE.IMAGE_ANALYSIS],CARD_DESCRIPTION[CARD_TYPE.SMART_CHECK],CARD_DESCRIPTION[CARD_TYPE.CHAT_BI],CARD_DESCRIPTION[CARD_TYPE.MESSAGE],CARD_DESCRIPTION[CARD_TYPE.INTERACTIVE],CARD_DESCRIPTION[CARD_TYPE.SELECTOR],CARD_DESCRIPTION[CARD_TYPE.INTENTION_RECOGNITION],CARD_DESCRIPTION[CARD_TYPE.TEXT_TEMPLATE],CARD_DESCRIPTION[CARD_TYPE.PLUGIN]],MODE_TYPE={VIEW:"view",DESIGNER:"designer",PROMPT:"prompt-designer",AGENT:"agent-designer"},OUTPUT_TYPE={CONTENT:"content",VARIABLES:"variables"},OUTPUT_DEFAULT_DATA={[OUTPUT_TYPE.CONTENT]:[{code:"output",type:"string",name:"默认输出"}],[OUTPUT_TYPE.VARIABLES]:[{code:"",type:"string",name:"",description:"",required:!0}]},SKILL_DEFAULT_INPUT=[{code:"input",value:{type:"ref",content:"System_Input"},type:"string",name:"用户输入"}],conditionData={id:generateCode(6),title:"条件1",target:"end0",type:"if",priority:1,collapse:!1,expressions:[{type:"and",rules:[{left:{code:generateCode(8),value:{type:"literal",content:""}},operator:"eq",right:{code:generateCode(8),value:{type:"literal",content:""}}}]}]};function getDefaultConditionData(){const e=JSON.parse(JSON.stringify(conditionData));return e.id=generateCode(6),[e,{id:generateCode(6),title:"否则",target:"end0",type:"else",priority:50,expressions:[]}]}const CARD_NODES={[CARD_TYPE.START]:{name:ACTION_NAME[CARD_TYPE.START],code:"start0",type:"Start",position:{x:100,y:100},config:{inputs:SKILL_DEFAULT_INPUT,outputType:OUTPUT_TYPE.CONTENT,outputs:OUTPUT_DEFAULT_DATA[OUTPUT_TYPE.CONTENT],uploadables:"",useFileUpload:!1,useQRCodeUpload:!1,maxUploadNumber:1}},[CARD_TYPE.INTERACTIVE]:{name:ACTION_NAME[CARD_TYPE.INTERACTIVE],code:"card0",type:"Card",position:{x:100,y:240},config:{type:"interactive",templateId:"401f4036-9449-4726-a318-4178dbc3c7ef",content:"",inputs:[],title:"",props:{}}},[CARD_TYPE.MESSAGE]:{name:ACTION_NAME[CARD_TYPE.MESSAGE],code:"card1",type:"Card",position:{x:100,y:240},config:{type:"message",content:"",inputs:[]}},[CARD_TYPE.PROMPT]:{name:ACTION_NAME[CARD_TYPE.PROMPT],code:"prompttemplate0",type:"PromptTemplate",position:{x:100,y:240},config:{templateId:"",inputs:[],outputs:[],stream:!0,asMessage:!0,memories:0,files:{type:"literal",content:""}}},[CARD_TYPE.KNOWLEDGE]:{name:ACTION_NAME[CARD_TYPE.KNOWLEDGE],code:"knowledge0",type:"Knowledge",position:{x:100,y:240},config:{knowledges:[],minScore:.5,topK:3,asSource:!0,isCOR:!1,pattern:0,inputs:[{code:"input",type:"string",value:{type:"ref",content:"System_Input"},required:!0}],outputs:[{code:"result",type:"string",name:"查询结果"}]}},[CARD_TYPE.CHAT_BI]:{name:ACTION_NAME[CARD_TYPE.CHAT_BI],code:"chatBI0",type:"ChatBI",position:{x:100,y:240},config:{knowledges:[],inputs:[{code:"input",type:"string",value:{type:"ref",content:"System_Input"},required:!0}],outputs:[{code:"result",type:"string",name:"查询结果"}]}},[CARD_TYPE.PLUGIN]:{name:ACTION_NAME[CARD_TYPE.PLUGIN],code:"plugin0",type:"Plugin",position:{x:100,y:240},config:{pluginId:"",source:0,toolId:"",inputs:[],outputs:[],async:!1,asMessage:!1}},[CARD_TYPE.SELECTOR]:{name:ACTION_NAME[CARD_TYPE.SELECTOR],code:"selector0",type:"selector",position:{x:100,y:240},config:{conditions:getDefaultConditionData(),selectorId:"",inputs:[],outputs:[]}},[CARD_TYPE.FINISH]:{name:"结束步骤：完成执行动作",code:"end0",type:"End",position:{x:100,y:204},config:{outputs:[]}},[CARD_TYPE.CONDITION]:{code:"condition0",type:"Condition",position:{x:100,y:240},config:{}},[CARD_TYPE.CONDITION_MERGE]:{code:"merge0",type:"Merge",position:{x:100,y:240},config:{}},[CARD_TYPE.PAGE]:{name:ACTION_NAME[CARD_TYPE.PAGE],code:"page0",type:"Page",position:{x:100,y:240},config:{mount:"page",url:{content:"",type:"literal"},visible:!0}},[CARD_TYPE.DOCUMENT_ANALYSIS]:{name:ACTION_NAME[CARD_TYPE.DOCUMENT_ANALYSIS],code:CARD_ID_NAME[CARD_TYPE.DOCUMENT_ANALYSIS]+"0",type:CARD_TYPE.DOCUMENT_ANALYSIS,position:{x:100,y:240},config:{files:{type:"ref",content:"System_Keyword_CurrentDocument"},imageRecognizeType:"none",ocrService:"",pattern:0,outputs:[],useTOC:!1,imagConverter:!1,usePageRange:"all",useFirstFewPages:0,useLastFewPages:0}},[CARD_TYPE.AUXILIARY_INPUT]:{name:ACTION_NAME[CARD_TYPE.AUXILIARY_INPUT],code:CARD_ID_NAME[CARD_TYPE.AUXILIARY_INPUT]+"0",type:CARD_TYPE.AUXILIARY_INPUT,position:{x:100,y:240},config:{appCode:"",formId:""}},[CARD_TYPE.TEXT_TEMPLATE]:{name:ACTION_NAME[CARD_TYPE.TEXT_TEMPLATE],code:CARD_ID_NAME[CARD_TYPE.TEXT_TEMPLATE]+"0",type:CARD_TYPE.TEXT_TEMPLATE,position:{x:100,y:240},config:{inputs:[],content:"",outputs:[{code:"result",type:"string",name:"文本内容"}]}},[CARD_TYPE.IMAGE_ANALYSIS]:{name:ACTION_NAME[CARD_TYPE.IMAGE_ANALYSIS],code:CARD_ID_NAME[CARD_TYPE.IMAGE_ANALYSIS]+"0",type:CARD_TYPE.IMAGE_ANALYSIS,position:{x:100,y:240},config:{templateId:"",inputs:[],files:{type:"ref",content:"System_Keyword_CurrentImage"},recognizeType:"multimodal",ocrService:"",outputType:"content",outputs:[{code:"result",type:"string",name:"文本内容"}],asMessage:!0,pattern:0}},[CARD_TYPE.INTENTION_RECOGNITION]:{name:ACTION_NAME[CARD_TYPE.INTENTION_RECOGNITION],code:CARD_ID_NAME[CARD_TYPE.INTENTION_RECOGNITION]+"0",type:CARD_TYPE.INTENTION_RECOGNITION,position:{x:100,y:240},config:{inputs:[{code:"input",type:"string",value:{type:"literal",content:""},required:!0}],classifications:[{id:0,intention:"其它意图"},{id:1,intention:""}],outputs:[{code:"classificationId",type:"number",name:"意图匹配ID"},{code:"classification",type:"string",name:"意图选项"},{code:"reason",type:"string",name:"意图匹配原因"}]}},[CARD_TYPE.SMART_CHECK]:{name:ACTION_NAME[CARD_TYPE.SMART_CHECK],code:CARD_ID_NAME[CARD_TYPE.SMART_CHECK]+"0",type:CARD_TYPE.SMART_CHECK,position:{x:100,y:240},config:{id:"",inputs:[],outputs:[{name:"执行结果",code:"result",type:"number",description:"执行结果"},{name:"规则分组",code:"ruleGroups",type:"array<object>",description:"规则分组"}]}}},FLOW_DEFAULT_DATA={nodes:[CARD_NODES[CARD_TYPE.START],CARD_NODES[CARD_TYPE.FINISH]],edges:[{code:"edge0",source:"start0",target:"end0"}]};function getSelectorData(e,t){const a=e+"_merge0",o=getDefaultConditionData(),n=`${e}_condition_${o[0].id}`,r=`${e}_condition_${o[1].id}`;return o[0].target=n,o[1].target=r,{nodes:[{id:e,code:e,type:"card",position:{x:100,y:0},data:{_id:e,name:"选择器",_actionName:"选择器",type:CARD_TYPE.SELECTOR,conditions:o}},{id:n,code:n,type:"condition",position:{x:0,y:0},parentNode:e,data:{_id:n,type:CARD_TYPE.CONDITION,conditionId:o[0].id}},{id:r,code:r,type:"condition",position:{x:0,y:0},parentNode:e,data:{_id:r,type:CARD_TYPE.CONDITION,conditionId:o[1].id}},{id:n+"_end",code:n+"_end",type:"condition",position:{x:0,y:0},parentNode:e,data:{_id:n,type:CARD_TYPE.CONDITION},with:10,height:1},{id:r+"_end",code:r+"_end",type:"condition",position:{x:0,y:0},parentNode:e,data:{_id:r,type:CARD_TYPE.CONDITION},with:10,height:1},{id:a,code:a,type:"merge",position:{x:0,y:0},parentNode:e,data:{_id:a,type:CARD_TYPE.CONDITION_MERGE}}],edges:[{code:`edge${t}`,source:e,target:n,type:"custom"},{code:`edge${t+1}`,source:e,target:r,type:"custom"},{code:`edge${t+2}`,source:n,target:n+"_end",type:"custom"},{code:`edge${t+3}`,source:r,target:r+"_end",type:"custom"},{code:`edge${t+4}`,source:n+"_end",target:a,type:"custom"},{code:`edge${t+5}`,source:r+"_end",target:a,type:"custom"}]}}function getAddCondition(e,t,a,o,n){const r=`${t}_condition_${e}`;return{nodes:[{id:r,code:r,type:"condition",position:{x:0,y:0},parentNode:t,data:{_id:r,type:CARD_TYPE.CONDITION,conditionId:e}},{id:r+"_end",code:r+"_end",type:"condition",position:{x:0,y:0},parentNode:t,data:{_id:r,type:CARD_TYPE.CONDITION},with:10,height:1}],edges:[{code:`edge${a}`,source:t,target:r,type:"custom"},...o?[{code:`edge${a+1}`,markerEnd:MarkerType.ArrowClosed,source:r,target:o,type:"custom"},{code:`edge${a+2}`,source:n,target:r+"_end",type:"custom"}]:[{code:`edge${a+1}`,source:r,target:r+"_end",type:"custom"}],{code:`edge${a+(o?3:2)}`,source:r+"_end",target:`${t}_merge0`,type:"custom"}]}}const mockData={id:"8e3a48ab-6bae-49db-b73a-d9a0f075a232",saveMode:3,flow:{nodes:[{name:"开始",code:"start0",type:"Start",position:{x:100,y:100},parentNode:null,config:{inputs:[{code:"input",value:{type:"ref",content:"System_Input"},type:"string",name:"用户输入"}],outputType:"content",outputs:[{code:"output",type:"string",name:"默认输出"}],uploadables:"doc,docx,pdf,txt,jpg,jpeg,bmp,gif,png,tif,webp"}},{name:"智能检查_0",description:"技能描述",code:"plan0",type:"Plan",position:{x:100,y:204},parentNode:"",config:{id:"6c0fa6e0-51c1-446e-a4e2-a79ebecece4d",inputs:[{code:"content",name:"消息内容",required:!1,type:"string",description:"",value:{type:"literal",content:"1"}},{code:"businessId",name:"业务对象ID",required:!1,type:"string",description:"",value:{type:"literal",content:"2"}},{code:"data",name:"流程表单数据",required:!1,type:"string",description:"",value:{type:"literal",content:"3"}},{code:"attachments",name:"流程附件数据",required:!1,type:"string",description:"",value:{type:"literal",content:"4"}}],outputs:[{name:"执行结果",code:"result",type:"number",description:"执行结果"},{name:"规则分组",code:"ruleGroups",type:"array<object>",description:"规则分组"}]}},{name:"文档分析_0",code:"documentAnalysis0",type:"DocumentAnalysis",position:{x:100,y:308},parentNode:"",config:{files:[{code:"fileInput",type:"file",value:{type:"ref",content:"System_Keyword_CurrentDocument"},required:!0}],pattern:1,outputs:[{name:"工程名称",code:"name",type:"string",description:"工程名称"},{name:"开标时间",code:"time",type:"string",description:"开标时间"},{name:"开标地点",code:"place",type:"string",description:"开标地点"},{name:"招标人",code:"preson",type:"string",description:"招标人"},{name:"深圳市信任行工程造价咨询有限公司的开标情况",code:"recode2",type:"string",description:"投标人为深圳市信任行工程造价咨询有限公司的开标情况记录"},{name:"投标信息",code:"bidInformation",type:"array<object>",description:"",collapse:!1,schema:[{name:"投标人",code:"bidder",type:"string",description:""},{name:"投标总价",code:"totalBidPrice",type:"string",description:""},{name:"技术标",code:"tTechnicalProposal",type:"string",description:""}]}],inputs:[],imageRecognizeType:"none",ocrService:"",useTOC:!1,imagConverter:!1,usePageRange:"all",useFirstFewPages:0,useLastFewPages:0}},{name:"交互卡片_0",code:"card0",type:"Card",position:{x:100,y:412},parentNode:"",config:{templateId:"401f4036-9449-4726-a318-4178dbc3c7ef",content:"",inputs:[],title:"请确认如下信息：",props:[{name:"editable",value:!0},{name:"mode",value:"view"},{name:"columns",value:[{name:"工程名称",code:"name",type:"Input",required:!0,columns:[]},{name:"开标时间",code:"time",type:"Input",required:!0,columns:[]},{name:"开标地点",code:"place",type:"Input",required:!0,readonly:!0,columns:[]},{name:"招标人",code:"preson",type:"Input",required:!0,columns:[]},{name:"投标信息",code:"bidInformation",type:"DataTable",required:!0,readonly:!1,columns:[{name:"投标人",code:"bidder",type:"Input",required:!0,readonly:!1},{name:"投标总价",code:"totalBidPrice",type:"Input",required:!0,readonly:!0},{name:"技术标",code:"tTechnicalProposal",type:"Input",required:!0,readonly:!1}]}]},{name:"fields",value:[]}],outputs:[{name:"工程名称",code:"name",value:{type:"ref",content:"NodeOutput_documentAnalysis0_name"},required:!0,type:"string",schema:[]},{name:"开标时间",code:"time",value:{type:"ref",content:"NodeOutput_documentAnalysis0_time"},required:!0,type:"string",schema:[]},{name:"开标地点",code:"place",value:{type:"ref",content:"NodeOutput_documentAnalysis0_place"},required:!0,type:"string",schema:[]},{name:"招标人",code:"preson",value:{type:"ref",content:"NodeOutput_documentAnalysis0_preson"},required:!0,type:"string",schema:[]},{name:"投标信息",code:"bidInformation",value:{type:"ref",content:"NodeOutput_documentAnalysis0_bidInformation"},required:!0,type:"array<object>",schema:[{name:"投标人",code:"bidder",value:{type:"ref",content:"bidder"},required:!0,type:"string"},{name:"投标总价",code:"totalBidPrice",value:{type:"ref",content:"totalBidPrice"},required:!0,type:"string"},{name:"技术标",code:"tTechnicalProposal",value:{type:"ref",content:"tTechnicalProposal"},required:!0,type:"string"}]},{code:"recode2",value:{type:"ref",content:"NodeOutput_documentAnalysis0_recode2"},type:"string",required:!0,name:"深圳市信任行工程造价咨询有限公司的开标情况",description:"投标人为深圳市信任行工程造价咨询有限公司的开标情况记录"}],type:"interactive"}},{name:"交互卡片_2",code:"card2",type:"Card",position:{x:100,y:516},parentNode:"",config:{templateId:"08dc64ca-b4b8-4c56-8225-302339e29baf",content:"",inputs:[],title:"",props:[{name:"mount",value:"message"},{name:"visible",value:!0},{name:"url",value:{type:"literal",content:"https://www.baidu.com/"}}],outputs:[],type:"interactive"}},{name:"结束步骤：完成执行动作",code:"end0",type:"End",position:{x:100,y:620},parentNode:null,config:{outputs:[]}}],edges:[{code:"edge0",source:"start0",target:"plan0"},{code:"edge1",source:"documentAnalysis0",target:"card0"},{code:"edge5",source:"card0",target:"card2"},{code:"edge7",source:"card2",target:"end0"},{code:"edge8",source:"plan0",target:"documentAnalysis0"}]}},FIELD_OPTIONS=[{label:"字符串",value:"string"},{label:"数值",value:"number"},{label:"日期",value:"date"}],FIELD_OBJECT_OPTIONS=[...FIELD_OPTIONS,{label:"对象数组",value:"array<object>"}],defaultConfig=[{label:"执行动作",prop:"_actionName",placeholder:"",type:"input",readonly:!0},{label:"步骤名称",prop:"name",placeholder:"请输入步骤名称",type:"input",rules:[{required:!0,message:"请输入步骤名称"}]},{label:"步骤描述",prop:"description",placeholder:"请输入步骤描述",type:"input",rules:[{required:!1,message:"请输入步骤描述"}]}],startOutputConfig={label:"输出参数",type:"output-type",defaultData:{outputType:"variables"},config:[{label:"参数格式",prop:"outputType",type:"radio",tooltip:"纯文本：用户提问的原始文本。<br />参数列表：通过AI分析用户输入中的参数信息，可以为这些参数定义名称、类型、是否必填，描述，从而让AI提取得更加准确。",options:[{label:"纯文本",value:"content"},{label:"参数列表",value:"variables"}]},{label:"格式定义",prop:"outputs",type:"dynamicForms",props:[{prop:"name",placeholder:"请输入名称",width:"20%",type:"input",default:""},{prop:"code",placeholder:"请输入编码",width:"20%",type:"input",default:""},{prop:"type",placeholder:"请选择",width:"16%",type:"select",options:FIELD_OPTIONS,default:"string"},{prop:"required",placeholder:"请选择",width:"14%",type:"select",options:[{label:"必填",value:!0},{label:"非必填",value:!1}],default:!0},{prop:"description",placeholder:"请输入描述",width:"30%",type:"input",default:""}],defaultData:[]}]},outputConfig=JSON.parse(JSON.stringify(startOutputConfig)),configWidth={name:"26%",code:"24%",type:"20%",description:"30%"};outputConfig.config[1].props.forEach((e,t)=>{e.prop==="required"&&outputConfig.config[1].props.splice(t,1),e.width=configWidth[e.prop]});const CARD_TEMPLATE_TYPE={FORM:"401f4036-9449-4726-a318-4178dbc3c7ef",TEXT:"ca1a0b77-6634-4828-9a12-0ac79cd0fcfc",IMPLANT:"08dc64ca-b4b8-4c56-8225-302339e29baf"},configInfo={[CARD_TYPE.START]:[{label:"技能名称",prop:"startTitle",placeholder:"请输入技能名称",type:"input",readonly:!0},{label:"技能描述",prop:"describe",placeholder:"请输入步骤描述",type:"textarea",readonly:!0,maxLength:300},startOutputConfig,{label:"文件上传",type:"upload-params"}],[CARD_TYPE.INTERACTIVE]:[...defaultConfig,{label:"卡片内容",type:"title"},{type:"interactive-form"},{type:"variables",variables:[]}],[CARD_TYPE.PLUGIN]:[...defaultConfig,{label:"服务API配置",type:"title"},{type:"plugin-api",options:[{label:"选择插件",prop:"pluginId",placeholder:"请选择",type:"select",options:[],default:""},{label:"插件服务",prop:"toolId",placeholder:"请选择",type:"select",options:[],default:""},{label:"请求参数",prop:"body",type:"dynamicForms",props:[{prop:"code",placeholder:"请选择",width:"50%",type:"select",options:[],default:""},{prop:"value",placeholder:"请选择",width:"50%",type:"select",options:[],default:""}],defaultData:[]}]},{label:"异步调用",prop:"async",type:"checkbox",default:!1,width:"100%",advancedconfig:!0,tips:"<p>1、开启异步调用后，技能编排不再等待插件执行完成；</p><p>2、插件节点之后的节点不能使用该节点输出参数；</p>"},{label:"输出到聊天对话框",prop:"asMessage",type:"checkbox",default:!1,width:"100%",advancedconfig:!0}],[CARD_TYPE.MESSAGE]:[...defaultConfig,{label:"消息内容",type:"title"},{label:"",prop:"content",placeholder:"请输入消息内容",type:"template",required:!0}],[CARD_TYPE.PROMPT]:[...defaultConfig,{label:"分析文档",prop:"files",type:"field-filling",minHeight:"30px",placeholder:"请选择参数",hideLabel:!1,required:!1,inputDisabled:!0,disabledInputs:!0},{label:"提示模板",type:"title"},{type:"ai-prompt"},{label:"输出到聊天对话框",prop:"asMessage",type:"checkbox",default:!0,width:"100%",advancedconfig:!0},{label:"会话记忆",type:"memory-component",advancedconfig:!0}],[CARD_TYPE.KNOWLEDGE]:[...defaultConfig,{label:"知识库",type:"knowledge-form"},{label:"显示文档来源",prop:"asSource",type:"checkbox",default:!0,width:"100%",advancedconfig:!0,tips:"对话框底部显示来源文档连接，可以查看原始文档。"},{label:"问题优化",prop:"isCOR",type:"checkbox",default:!1,width:"100%",advancedconfig:!0,tips:"<p>1、根据历史聊天优化完善当前问题，需要提示词节点开启“会话记忆”</p><p>2、如：提问1 今天天气，提问2 昨天呢？ ，能够将转换问题为 昨天天气呢？</p>"}],[CARD_TYPE.CHAT_BI]:[...defaultConfig,{label:"数据知识库",type:"chat-bi-form"}],[CARD_TYPE.SELECTOR]:[...defaultConfig,{type:"selector"}],[CARD_TYPE.FINISH]:[{label:"输出参数",type:"title"},{label:"",prop:"outputs",type:"dynamicForms",props:[{prop:"name",placeholder:"请输入名称",width:"25%",type:"input",default:""},{prop:"code",placeholder:"请输入编码",width:"25%",type:"input",default:""},{prop:"type",placeholder:"请选择",width:"20%",type:"select",options:FIELD_OBJECT_OPTIONS,default:"string"},{prop:"value",placeholder:"",width:"30%",type:"field-filling"}],enableFillField:!0}],[CARD_TYPE.PAGE]:[...defaultConfig,{label:"页面配置",type:"title"},{label:"打开方式",prop:"mount",type:"select",options:[{label:"左滑面板",value:"page"},{label:"聊天区域",value:"chat"}]},{label:"页面地址",prop:"url",type:"field-filling",mode:"input",minHeight:"30px",placeholder:"请输入页面地址"},{label:"默认显示",prop:"visible",type:"checkbox",default:!0}],[CARD_TYPE.DOCUMENT_ANALYSIS]:[...defaultConfig,{label:"分析文档",prop:"files",type:"field-filling",mode:"tag",minHeight:"30px",placeholder:"请选择参数",hideLabel:!1,required:!0,inputDisabled:!0},{type:"image-recognize",config:[{label:"图片分析方式",prop:"imageRecognizeType",type:"select",options:[{label:"不识别",value:"none"},{label:"视觉识别",value:"ocr"}],default:"none"}]},{label:"知识库",type:"document-analysis"},{label:"解析内容配置",type:"document-scope",advancedconfig:!0}],[CARD_TYPE.AUXILIARY_INPUT]:[...defaultConfig,{type:"auxiliary-input"}],[CARD_TYPE.TEXT_TEMPLATE]:[...defaultConfig,{type:"text-template"}],[CARD_TYPE.IMAGE_ANALYSIS]:[...defaultConfig,{label:"分析图片",prop:"files",type:"field-filling",mode:"tag",minHeight:"30px",placeholder:"请选择参数",hideLabel:!1,required:!0,inputDisabled:!0},{type:"image-recognize",config:[{label:"分析方式",prop:"recognizeType",type:"select",options:[{label:"多模态识别",value:"multimodal"},{label:"视觉识别",value:"ocr"}],default:"multimodal"}]},{type:"image-analysis"},{label:"输出到聊天对话框",prop:"asMessage",type:"checkbox",default:!0,width:"100%",hide:!1,advancedconfig:!0}],[CARD_TYPE.INTENTION_RECOGNITION]:[...defaultConfig,{label:"输入参数",type:"title"},{label:"输入参数",prop:"_input",type:"field-filling",mode:"input",minHeight:"30px",placeholder:"请选择参数",hideLabel:!0,inputDisabled:!1},{label:"意图匹配",type:"title"},{label:"",prop:"classifications",type:"intention",props:[{prop:"intention",placeholder:"请输入意图描述",width:"100%",type:"input",default:""}],defaultData:[]},{label:"输出参数",type:"title"},{prop:"outputs",type:"table",columns:[{title:"名称",dataIndex:"code"},{title:"类型",dataIndex:"type"},{title:"描述",dataIndex:"name"}],tips:'<p style="margin-top: 8px;">1. 当输入参数与意图匹配时，输出意图匹配ID和原因。</p><p>2. 意图匹配ID可作为选择器判断条件使用。</p>'},{label:"会话记忆",type:"memory-component",advancedconfig:!0}],[CARD_TYPE.SMART_CHECK]:[...defaultConfig,{label:"智能检查",type:"smart-check"}]},outputParamsConfig=[{prop:"name",placeholder:"请输入名称",width:"25%",type:"input",default:""},{prop:"code",placeholder:"请输入编码",width:"25%",type:"input",default:""},{prop:"type",placeholder:"请选择",width:"25%",type:"select",options:FIELD_OBJECT_OPTIONS,default:"string"},{prop:"description",placeholder:"请输入描述",width:"25%",type:"input",default:""}],INTERACTIVE_CONFIG={SELECT:{label:"卡片模板",prop:"templateId",placeholder:"请选择",type:"select-template",options:[{label:"表单卡片",value:CARD_TEMPLATE_TYPE.FORM,tips:"说明：卡片表单用于用户确认字段信息，也可以通过点击编辑按钮或者对话方式修改字段。"},{label:"文本生成卡片",value:CARD_TEMPLATE_TYPE.TEXT,tips:"说明：文本生成卡片生成的内容，可通过点击卡片按钮填写到建模平台多行文本。"},{label:"嵌入卡片",value:CARD_TEMPLATE_TYPE.IMPLANT,tips:"说明：嵌入卡片允许在对话框中嵌入一个外部页面或者组件，支持在滑出面板、消息内容、聊天区域显示，从而实现复杂场景的交互逻辑。"}],default:CARD_TEMPLATE_TYPE.FORM},TEMPLATE:{label:"模板内容",prop:"content",placeholder:"请输入模板内容",type:"template",minHeight:"240px",rules:[{required:!0,message:"请输入模板内容"}]},TITLE:{label:"卡片标题",prop:"title",placeholder:"请输入卡片标题",type:"template",minHeight:"120px",rules:[{required:!0,message:"请输入卡片标题"}]}},useConfigStore=defineStore("config",{state:()=>({config:configInfo,itemConfig:[],data:{},oldData:{},activeType:"",knowledge:[]}),getters:{configData:e=>e.itemConfig,formData:e=>e.data,oldFormData:e=>e.oldData,knowledgeOptions:e=>e.knowledge},actions:{setData({data:e}){const t=e.type;this.activeType=t,this.itemConfig=t&&this.config[t]?this.config[t]:[],this.data=e,this.setOldData(e)},setOldData(e){this.oldData=JSON.parse(JSON.stringify(e))},async updateKnowledgeOptions(e){this.knowledge=e}}}),spaceGUID=getParams()?.space||"",getData=()=>{const{oid:e,_debug:t}=getParams();return!e&&t==="true"?{data:{data:mockData}}:e?axios.request({url:`/api/42000301/skill/detail?skillGUID=${e}`,method:"POST"}):{data:{data:{}}}},saveData$1=e=>axios.request({url:"/api/42000301/skill/saveAndUpdateNode",method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"},data:e}),getSystemParam=()=>axios.request({url:"/api/42000301/skill/systemParam",method:"POST"}),getSetupConfig=()=>axios.request({url:"/api/42001301/setup/initConfig",method:"GET"}),onMapping=e=>axios.request({url:"/api/42000301/skill/paramMapping",method:"POST",data:e}),getKnowledgeList=()=>axios.request({url:"/api/42000401/knowledge/queryKnowledgeListToNode",method:"POST",data:{spaceGUID}}),verifyParams=e=>{const t=[];return e.forEach(a=>{let o=[];if((a.data?.outputType==="variables"||a.data?.pattern===1||a.data?.type===CARD_TYPE.INTERACTIVE)&&(o=a.data?.outputs||[]),a.data?.type===CARD_TYPE.TEXT_TEMPLATE&&(o=a.data?.inputs||[]),a.data?.type===CARD_TYPE.FINISH&&(o=a.data?.outputs||[]),o?.length){const n=[];o.some(r=>{if(a.data?.type===CARD_TYPE.START&&(!r.code||!r.name))return t.push({id:a.id,message:`请完善【${a.data?.name}】节点参数！`}),!0;if(n.includes(r.code))return t.push({id:a.id,message:`【${a.data?.name}】节点的参数字段存在重复！`}),!0;r.code&&n.push(r.code)})}}),t},clearParamValue=e=>{let t={};e.forEach(a=>{a.data?.outputs?.length&&a.data.outputs.forEach(r=>{const s=`NodeOutput_${a.id}_${r.code}`,l=r.value;l&&l.type==="ref"&&l.content?.startsWith("NodeOutput_")&&(t[l.content]||(r.value={type:"literal",content:""})),r.code&&(t[s]=r.code),r?.schema?.length&&r.schema.forEach(i=>{const u=s+"_"+i.code,g=i.value;g&&g.type==="ref"&&g.content&&!g.content?.startsWith("System_")&&(!l?.content||!t[l.content+"_"+g.content])&&(i.value={type:"literal",content:""}),i.code&&(t[u]=i.code)})}),a.data?.inputs?.length&&a.data.inputs.forEach(r=>{const s=r.value;s&&s.type==="ref"&&s.content?.startsWith("NodeOutput_")&&(t[s.content]||(r.value={type:"literal",content:""}))});const o=a.data?.files;o&&o.type==="ref"&&o.content?.startsWith("NodeOutput_")&&(t[o.content]||(o.type="literal",o.content=""));const n=a.data?.conditions;n?.length&&n.forEach(r=>{r.expressions?.length&&r.expressions.forEach(s=>{s?.rules?.length&&s.rules.forEach(l=>{const{left:i,right:u}=l,g=i?.value||{};g?.type==="ref"&&typeof g?.content=="string"&&g?.content?.startsWith("NodeOutput_")&&(t[g.content]||(i.value={type:"literal",content:""}));const _=u?.value||{};_.type==="ref"&&typeof _?.content=="string"&&_?.content?.startsWith("NodeOutput_")&&(t[_.content]||(i.value={type:"literal",content:""}))})})}),(a.data.type===CARD_TYPE.INTERACTIVE||a.data.type===CARD_TYPE.MESSAGE)&&(a.data.inputs=a.data.inputs?.filter(({value:r})=>r?.content)||[],"content"in a.data&&a.data.content&&(a.data.content=clearMessageContent(a.data.content,a.data.inputs)),"title"in a.data&&a.data.title&&(a.data.title=clearMessageContent(a.data.title,a.data.inputs)))}),t={}},clearMessageContent=(e,t)=>{let a=e;const o={};t.forEach(({code:s})=>{o[s]=!0});const n=/{{\$([^{}]+)}}/g;let r;for(;(r=n.exec(a))!==null;){const[,s]=r;o[s]||(a=a.replaceAll(`{{$${s}}}`,""))}return a},verifyAgentParams=e=>{if(e.inputs.length){const t=[];let a="";if(e.inputs.some(o=>{if(!o.code||!o.name)return a="请完善输入参数",a;if(!/^[A-Za-z_][A-Za-z0-9_]*$/.test(o.code))return a="编码支持使用字母、数字和下划线",a;if(t.includes(o.code))return a="输入参数编码存在重复",a;o.code&&t.push(o.code)}),a)return a}return""},{updateNodeData}=useVueFlow();let timer=null;const skipConfig=ref(!1),useFlowStore=defineStore("flow",{state:()=>({cardWidth:160,mode:"",activeCard:{id:""},flowData:{},nodes:[],edges:[],systemParam:[],showError:!1,saveStatus:{loading:!1,status:!1,message:"",errorMessage:"",time:""},warningNodes:[],nodeSortMap:{},agentData:{prompt:{template:"",inputs:[]},tools:[],mcps:[],knowledgs:[],inputs:[],uploadables:"",useFileUpload:!1,useQRCodeUpload:!1,maxResultNumber:10,maxContextTurnsNumber:30,maxUploadNumber:1,modelInstanceCode:"",generationDiversity:"balance",executionSetting:""},setupConfigData:{}}),getters:{activeCardId:e=>e.activeCard.id,flowNodes:e=>e.nodes,flowEdges:e=>e.edges,isView:e=>e.mode===MODE_TYPE.VIEW,isDesigner:e=>e.mode===MODE_TYPE.DESIGNER,nodeOrder:e=>{const t=[],a=o=>{let n=e.edges.find(r=>r.source===o);n&&(t.push(n.data.source),n.target.indexOf("_condition_")>0&&(n=e.edges.find(r=>r.source===`${n.source}_merge0`)),a(n.target))};return a("start0"),t},nodeMap:e=>{const t={};return e.nodes.forEach(a=>{t[a.id]=a}),t},data:e=>e.flowData,edgeMap:e=>{const t={},a={};return e.edges.forEach(o=>{t[o.source]=o,a[o.target]=o}),{sourceMap:t,targetMap:a}},hidePrompt:e=>e.setupConfigData?.environment?.releaseMode==="Customer"},actions:{async getSystemParam(){const{data:e}=await getSystemParam(),t=a=>a.map(o=>{if(o.value=o.code,o.code?.startsWith("System_")){let n=o.code.replace("System_Input","input");n=n.replace("System_Keyword_",""),o.code=n.charAt(0).toLowerCase()+n.slice(1)}return o.children&&o.children?.length>0&&(o.children=t(o.children)),o.label=o.name,o});this.systemParam=t(e.data)},setFlowMode(e){this.mode=e,this.getSystemParam()},setActiveCard(e){this.activeCard=e},async getData(){let{data:e}=await getData();return this.setFlowData(e.data)},setFlowData(e){if(this.showError=!e,!e||(this.flowData=e,e.mode==="agent"&&e.agent&&(this.agentData=e.agent),e.mode!=="flow"))return;let{flow:t,name:a,code:o,description:n}=this.flowData;t||(t=JSON.parse(JSON.stringify(FLOW_DEFAULT_DATA)));const r=t.nodes,s=t.edges;return r.forEach(l=>{let i=l.type;if(l.id=l.code,l.config&&l.config.type&&(i=l.type+"_"+l.config.type),l.data={...l.config||{},type:i,_id:l.id,description:l.description||""},l.data.props){const u={},g=new Map,_=[];l.data.outputs?.forEach(m=>{g.set(m.code,m),m.schema?.forEach(v=>{g.set(m.code+"_"+v.code,v)})}),l.data.props.forEach(m=>{u[m.name]=m.value,m.name==="columns"&&(u[m.name]=m.value.map(v=>{v.code&&_.push(v.code);const x=v?.columns?.map(D=>({...D,...g.get(v.code+"_"+D.code)||{},control:D.type}));return{...v,...g.get(v.code)||{},control:v.type,schema:x}}))}),u.actions||(u.actions=[{code:"card-confirm",name:""}]),u.hiddenFields=l.data.outputs?.filter(m=>m.code&&!_.includes(m.code)),l.data.props=u}delete l.config,i===CARD_TYPE.START?(l.data.name=l.name,l.data.startTitle=o?`${a}（${o}）`:a||l.name,l.data.describe=n):l.data.name=l.name,(i===CARD_TYPE.DOCUMENT_ANALYSIS||i===CARD_TYPE.IMAGE_ANALYSIS||i===CARD_TYPE.PROMPT)&&(l.data.files=l.data.files?.[0]?.value||{type:"literal",content:""}),i===CARD_TYPE.INTENTION_RECOGNITION&&(l.data._input=l.data.inputs?.[0]?.value||{type:"literal",content:""}),l.data._actionName=ACTION_NAME[i],l.type="card"}),s.forEach(l=>{l.id=l.code,l.sourceHandle=`${l.source}__handle-bottom`,l.type="custom",l.markerEnd=MarkerType.ArrowClosed,l.data=JSON.parse(JSON.stringify(l))}),this.nodes=r,this.edges=s,this.onComplete(),r},onComplete(){const{sourceMap:e}=this.edgeMap;let t=[],a=[],o=this.getNewEdgeId(!0);const n=r=>{const s=l=>{const i=e[l];return i?s(i.target):l};return s(r)};this.nodes.forEach(r=>{if(r.data.type===CARD_TYPE.SELECTOR){r.data.conditions.forEach(u=>{u.id=generateCode(6);const g=n(u.target)||u.target,_=getAddCondition(u.id,r.id,o,u.target,g);o+=_.edges.length,t=t.concat(_.nodes),a=a.concat(_.edges)});const s=`${r.id}_merge0`;t.push({id:s,code:s,type:"merge",position:{x:0,y:0},parentNode:r.id,data:{_id:s,type:CARD_TYPE.CONDITION_MERGE}});let l=this.edges.findIndex(u=>u.source===r.id),i=l?this.edges[l]:{};l>-1&&this.edges.splice(l,1),!i&&r.parentNode&&(l=a.findIndex(u=>u.source===r.id),i=l?a[l]:{},l>-1&&a.splice(l,1)),a.push({code:`edge${o}`,source:s,target:i?.target,type:"custom"}),o+=1}}),t.length&&this.addSelector({nodes:t,edges:a})},saveData(e=!0){if(this.flowData.mode==="agent"){const u=verifyAgentParams(this.agentData);return u?(Message.warning(u),new Promise((g,_)=>{_()})):saveData$1({...this.flowData,agent:this.agentData}).then(({data:g})=>{const _=g?.exception?.message||"";this.onSaveMessage(!!g.success,e,_),skipConfig.value=!0}).catch(()=>{this.onSaveMessage(!1,e)})}const t=this.onVerifyParams();if(t)return Message.warning(t),new Promise((u,g)=>{g()});timer&&clearTimeout(timer);const a="_condition_";this.saveStatus.loading=!0;let o=[];this.nodeOrder.forEach(u=>{o.push(u),this.nodeSortMap[u]&&(o=o.concat(this.nodeSortMap[u]))}),o.push("end0"),this.nodes.sort((u,g)=>o.indexOf(u.code)>o.indexOf(g.code)?1:-1);const n=[];clearParamValue(this.nodes);const r=JSON.parse(JSON.stringify(this.nodes)),s=JSON.parse(JSON.stringify(this.edges));r.forEach(u=>{let{_id:g,type:_,name:m,startTitle:v,_actionName:x,describe:D,description:y,...b}=u.data;const w=_.split("_"),E=b;if(w[1]&&(E.type=w[1]),!(u.id.indexOf(a)>0||u.id.endsWith("_merge0"))){if(E.files&&(E.files=[{code:"fileInput",type:"file",value:E.files,required:_!==CARD_TYPE.PROMPT}]),n.push({name:m,description:y,code:u.id,type:w[0],position:u.position,parentNode:u.parentNode,config:E}),E._input&&(E.inputs=[{code:"input",value:E._input,required:!0}],delete E._input),w[0]===CARD_TYPE.SELECTOR){E.conditions.forEach(N=>{const T=s.find(C=>C.source===`${u.id}${a}${N.id}`);N.target=T?.target||"",N.target.endsWith("_end")&&(N.target="")});const V=s.find(N=>N.source.startsWith(`${u.id}_merge0`));V&&(V.source=u.id)}if(E.props){const V=[];Object.keys(E.props).forEach(N=>{let T=E.props[N];N==="columns"&&(T=T.map(({name:C,code:f,control:d,required:h,readonly:k,thousands:S,options:A,schema:O})=>{const z=O?.map(({name:M,code:B,control:$,required:F,readonly:I,thousands:R,options:Y})=>({name:M,code:B,type:$,required:F,readonly:I,thousands:R,options:Y}))||[];return{name:C,code:f,type:d,required:h,readonly:k,thousands:S,options:A,columns:z}})),N!=="hiddenFields"&&V.push({name:N,value:T})}),E.props=V}}});const l=[];s.forEach(u=>{u.source.indexOf(a)>0||u.target.indexOf(a)>0||l.push({code:u.data.id,source:u.source,target:u.target})});const i={id:this.flowData?.id||"",mode:"flow",saveMode:3,flow:{nodes:n,edges:l}};return saveData$1(i).then(({data:u})=>{const g=u?.exception?.message||"";this.onSaveMessage(!!u.success,e,g),this.setFlowData({...this.flowData,...i})}).catch(()=>{this.onSaveMessage(!1,e)})},onVerifyParams(){const e=verifyParams(this.nodes);return e?.length>0?(this.warningNodes=e,e.map(a=>a.message).join("，")):(this.warningNodes=[],"")},onSaveMessage(e,t,a=""){e?(this.saveStatus={...this.saveStatus,message:"已保存",time:getSaveTime(),status:!0,loading:!1},t&&Message.success("保存成功")):(this.saveStatus={...this.saveStatus,errorMessage:a||"保存失败",status:!1,message:this.saveStatus.time?"上次保存":"",loading:!1},t&&Message.warning(a||"保存失败"))},getSystemParamData(e=!1){const t=[],a=this.systemParam.map(o=>{if(o.children?.length)return o.children.map(n=>{n.mapValue=`{{$${n.value}}}`,t.push(n)}),o.selectable=!1,o.hideIcon=!0,o;if(o.code){const n={...o,mapValue:`{{$${o.value}}}`};return t.push(n),n}});return e?a:t},getParamsData(e=!1){const{sourceMap:t,targetMap:a}=this.edgeMap;let o=[];const n=s=>{let l=a[s];if(!l)return;const i=this.nodeMap[l.source];if([CARD_TYPE.CONDITION,CARD_TYPE.CONDITION_MERGE,CARD_TYPE.SELECTOR].includes(i.data.type)||o.unshift(i),i.data.type===CARD_TYPE.CONDITION_MERGE){const u=i.id.replace("_merge0",""),g=_=>{let m=[];return this.nodes.forEach(v=>{if(v.parentNode===_){if(v.data.type===CARD_TYPE.SELECTOR){m=m.concat(g(v.id));return}[CARD_TYPE.CONDITION,CARD_TYPE.CONDITION_MERGE].includes(v.data.type)||m.push(v)}}),m};o=g(u).concat(o),l=t[u]}n(l.source)};n(this.activeCard.id);const r=[{name:"系统变量",label:"系统变量",code:"system",selectable:!1,iconName:"system",children:this.getSystemParamData(e)}];return o.forEach(s=>{if(!s.data.async&&s?.data?.outputs){const l={name:s.data.name,label:s.data.name,code:s.id,value:s.id,selectable:!1,iconName:CARD_DESCRIPTION[s.data.type]?.icon,children:s?.data?.outputs.filter(i=>!!i.code&&i.type!=="group").map(i=>({...i,value:`NodeOutput_${s.id}_${i.code}`,mapValue:`{{$NodeOutput_${s.id}_${i.code}}}`,label:`${i.name}(${i.code})`,name:`${s.data.name}-${i.name}`}))};r.push(l)}}),r},async getKnowledgeList(){const{data:e}=await getKnowledgeList();return e.data.map(a=>({label:a.name,value:a.code,typeEnum:a.typeEnum}))},updatePosition(){const{sourceMap}=this.edgeMap,positionY=104;Object.values(this.nodeMap).forEach(e=>e.children=[]),this.nodes.forEach(e=>{e.data.width&&(e.data.width=0),e.data.height&&(e.data.height=0),e.parentNode&&this.nodeMap[e.parentNode].children.push(e)});const parentNodes=this.nodes.filter(e=>{if(e.children?.length>0){let t=0;const a=o=>{if(t+=1,!o)return;const n=this.nodeMap[o];a(n.parentNode)};return a(e.parentNode),e.level=t,!0}return!1});parentNodes.sort((e,t)=>t.level>e.level?1:-1);const boxWidth=this.cardWidth+20,boxHeight=64,conditionPY=48,nodeSortMap={};parentNodes.forEach(node=>{nodeSortMap[node.code]=[];const group={},conditionWidths=[];node.data.conditions.forEach((e,t)=>{group[e.id]=[],conditionWidths[t]=boxWidth;const a=o=>{let n="";const r=this.nodeMap[o];r.data.width>conditionWidths[t]&&(conditionWidths[t]=r.data.width),group[e.id].push(o),this.nodeMap[o]?.data?.type===CARD_TYPE.SELECTOR?n=sourceMap[`${o}_merge0`]?.target||"":n=sourceMap[o]?.target||"",n&&!n.endsWith("_merge0")&&a(n)};a(`${node.id}_condition_${e.id}`)});const contentWidth=eval(conditionWidths.join("+"));let maxHeight=0,left=-(contentWidth/2);node.data.conditions.forEach((e,t)=>{let a=0;left+=conditionWidths[t]/2,t>0&&(left+=conditionWidths[t-1]/2);const o=(n,r,s)=>{if(n.indexOf("_condition_")===-1){nodeSortMap[node.code].push(n);const i=nodeSortMap[n];i&&(nodeSortMap[node.code]=nodeSortMap[node.code].concat(i),delete nodeSortMap[n])}a+=1,s>maxHeight&&(maxHeight=s),this.nodeMap[n].position={x:r,y:s};let l="";this.nodeMap[n]?.data?.type===CARD_TYPE.SELECTOR?(l=sourceMap[`${n}_merge0`]?.target||"",s+=this.nodeMap[n]?.data.height):l=sourceMap[n]?.target||"",l&&!l.endsWith("_merge0")&&o(l,r,s+positionY-(a===1?32:0))};o(`${node.id}_condition_${e.id}`,left,boxHeight+conditionPY)}),node.children.forEach(e=>{e.data.type===CARD_TYPE.CONDITION_MERGE&&(e.position={x:0,y:maxHeight+conditionPY}),e.id.endsWith("_end")&&(e.position.y=maxHeight)}),node.data.width=contentWidth,node.data.height=maxHeight});const loopNode=(e,t,a)=>{const o=sourceMap[e];if(o){const n=this.nodeMap[o.target];a=a+positionY,n.position={x:t,y:a};let r=o.target;n.data.type===CARD_TYPE.SELECTOR&&(r=r+"_merge0",a=a+n.data.height+20),loopNode(r,t,a)}};loopNode("start0",100,100),this.nodeSortMap=nodeSortMap,updateNodeData(this.nodes,this.edges)},addSelector(e){this.nodes=this.nodes.concat(e.nodes),e.edges.map(t=>{t.id=t.code,t.sourceHandle=`${t.source}__handle-bottom`,t.data=JSON.parse(JSON.stringify(t))}),this.edges=this.edges.concat(e.edges),updateNodeData(this.nodes,this.edges),this.updatePosition()},removeSelectorNodes(e,t){const a=this.nodes.filter(s=>s.data.type===CARD_TYPE.SELECTOR);let o=0,n=[];const r=(s,l)=>{l+=1,a.forEach(i=>{i.parentNode===s&&(n.push({id:i.id,level:l}),r(i.id,l))})};r(e,o),n.sort((s,l)=>s.level>l.level?-1:1),n.forEach(({id:s})=>{this.removeSelector(s,!1)}),this.removeSelector(e,t)},removeSelector(e,t=!1){const{targetMap:a,sourceMap:o}=this.edgeMap,n=`${e}_merge0`,r=[];this.nodes=this.nodes.filter(i=>i.id===e||i.id.startsWith(`${e}_`)?!1:i.parentNode===e?(r.push(i.id),!1):!0);const s=a[e],l=o[n];s.target=l.target,s?.data?.target&&(s.data.target=l.target),this.edges=this.edges.filter(i=>r.includes(i.target)||r.includes(i.source)?!1:!i.target.startsWith(`${e}_`)&&!i.source.startsWith(`${e}_`)),t&&(updateNodeData(this.nodes,this.edges),this.updatePosition())},removeCondition(e){const{sourceMap:t,targetMap:a}=this.edgeMap,o=[e],n=[],r=s=>{let l=t[s];const i=this.nodeMap[l.target],u=i.data.type===CARD_TYPE.SELECTOR;u&&(n.push(i.id),l=a[`${i.id}_merge0`]),l&&(!l.target.endsWith("_merge0")||u)&&(u||o.push(l.target),r(l.target))};r(e),n.length&&n.forEach(s=>{this.removeSelectorNodes(s,!1)}),o.push(`${e}_end`),o.forEach(s=>{s.indexOf("_condition_")===-1&&this.onDelNode(s)}),this.nodes=this.nodes.filter(s=>!o.includes(s.id)),this.edges=this.edges.filter(s=>!o.includes(s.source)&&!o.includes(s.target)),updateNodeData(this.nodes,this.edges),this.updatePosition()},addNode(e){this.nodes.push(e)},removeNode(e){const t=this.nodes.findIndex(a=>a.id===e);t>-1&&this.nodes.splice(t,1)},addEdge(e){this.edges.push(e)},removeEdge(e,t=!0){const{sourceMap:a,targetMap:o}=this.edgeMap,n=o[e],r=a[e];n.target=r.target;const s=this.edges.findIndex(l=>l.source===e);if(s>-1&&this.edges.splice(s,1),!t){const l=this.edges.findIndex(i=>i.data.id===n.data.id);this.edges.splice(l,1)}return{sourceItem:r,targetItem:n}},updateEdge(e){const t=this.edges.find(a=>a.data.id===e.id);t&&(t.target=e.target)},onDelNode(e,t=!1){this.removeNode(e),this.removeEdge(e),t&&this.updatePosition()},onAutoSave(e,t,a){timer&&clearTimeout(timer),timer=setTimeout(()=>{if(e._id!==t._id)return;const o=diff(e,t);Object.keys(o).length&&this.saveData(!1).then(a)},5e3)},getNewEdgeId(e=!1){let t=0;return this.edges.forEach(a=>{const o=parseInt(a.id.replace("edge",""));o>=t&&(t=o+1)}),e?t:`edge${t}`},getNewId(e,t=!1){let a=0;return this.nodes.forEach(o=>{if(o.id.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())){const n=parseInt(o.id.replace(e,""));n>=a&&(a=n+1)}}),t?{id:e+a,index:a}:e+a},initSetupConfig(){getSetupConfig().then(e=>{const t=e.data?.data||{};this.setupConfigData=t})}}}),_hoisted_1$A=["xlink:href"],_sfc_main$U=defineComponent({__name:"svg-icon",props:{prefix:{type:String,default:"icon"},name:{type:String,required:!0},color:{type:String,default:"#A0A5AC"},size:{type:String,default:"1em"},width:{type:String,default:""},height:{type:String,default:""}},setup(e){const t=e,a=computed(()=>`#svg-${t.name}`),o=computed(()=>t.color?{color:t.color,width:t.width||t.size,height:t.height||t.size}:"");return(n,r)=>(openBlock(),createElementBlock("svg",{"aria-hidden":"true",class:"svg-icon inline-block",style:normalizeStyle(o.value)},[createBaseVNode("use",{"xlink:href":a.value,fill:"currentColor"},null,8,_hoisted_1$A)],4))}}),_hoisted_1$z={class:"ml-[4px] text-[13px] leading-[22px] text-[#333333]"},_hoisted_2$r={key:1,class:"card-condition_line"},_sfc_main$T=defineComponent({__name:"card-condition",props:{nodeProps:{type:Object,default:()=>({})}},emits:["select"],setup(e,{emit:t}){const a=e,o=t,n=useFlowStore(),r=useConditionStore(),s=computed(()=>n.cardWidth),l=computed(()=>n.nodes.find(_=>_.id===a.nodeProps.parent)),i=computed(()=>l.value&&l.value.data.conditions.find(_=>_.id===a.nodeProps.data.conditionId)||null),u=()=>{const{parent:_}=a.nodeProps,m=n.nodes.find(v=>v.id===_);o("select",m),r.setActive(a.nodeProps.id)},g=computed(()=>a.nodeProps.id===r.activeId);return(_,m)=>{const v=_sfc_main$U;return openBlock(),createElementBlock("div",{class:"card-condition nodrag",style:normalizeStyle({width:s.value+"px"})},[i.value?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["card-condition_content",{"is-active":g.value}]),onClick:u},[createVNode(v,{name:"fx",size:"16px"}),createBaseVNode("span",_hoisted_1$z,toDisplayString(i.value.title),1)],2)):(openBlock(),createElementBlock("div",_hoisted_2$r))],4)}}}),state={draggedType:ref({}),isDragOver:ref(!1),isDragging:ref(!1),edge:ref({})};function useDragAndDrop(){const{draggedType:e,isDragOver:t,isDragging:a,edge:o}=state;watch(a,g=>{document.body.style.userSelect=g?"none":""});function n(g,_){g.dataTransfer&&(g.dataTransfer.setData("application/vueflow",_.type),g.dataTransfer.effectAllowed="move"),e.value=_,a.value=!0,document.addEventListener("drop",l)}function r(g,_){g.preventDefault(),e.value&&(t.value=!0,o.value=_,g.dataTransfer&&(g.dataTransfer.dropEffect="move"))}function s(){t.value=!1,o.value={}}function l(){a.value=!1,t.value=!1,e.value={},document.removeEventListener("drop",l)}function i(g,_){if(!_||!_.type)return{};const m=CARD_ID_NAME[_.type],{id:v,index:x}=g.getNewId(m,!0),{name:D,config:y}=JSON.parse(JSON.stringify(CARD_NODES[_.type]));return{id:v,code:v,name:D,type:"card",position:{x:100,y:0},data:{_id:v,...y,name:`${D}_${x}`,_actionName:D,type:_.type}}}function u(g,_){let m=i(g,e.value);if(!m?.id)return;const v=m.data.type===CARD_TYPE.SELECTOR;let x={};v&&(x=getSelectorData(m.id,g.getNewEdgeId(!0)+1),m=x.nodes.find(E=>E.id===m.id));const D=o.value;m.parentNode=g.nodeMap[D.target]?.parentNode||"";const y=D.target.startsWith(CARD_ID_NAME[CARD_TYPE.SELECTOR])&&D.target.endsWith("_end"),b={id:D.newId,code:D.newId,markerEnd:MarkerType.ArrowClosed,source:v?`${m.id}_merge0`:m.id,sourceHandle:`${m.id}__handle-bottom`,target:D.target,type:"custom"};y&&delete b.markerEnd,b.data=JSON.parse(JSON.stringify(b));const w={...D,target:m.id};v?g.addSelector(x):g.addNode(m),g.updateEdge(w),g.addEdge(b),g.updatePosition(),g.setActiveCard(m),_.setData(m),e.value={}}return{draggedType:e,edge:o,isDragOver:t,isDragging:a,onDragStart:n,onDragLeave:s,onDragOver:r,onDrop:u}}const _hoisted_1$y={class:"drag-box_inner inline-block h-[14px] w-[100%]"},_hoisted_2$q={class:"add-card flex h-[14px] w-[14px] cursor-pointer items-center justify-center"},_hoisted_3$h={class:"add-card_popover"},_hoisted_4$e=["onClick"],_sfc_main$S=defineComponent({__name:"card-edge",props:{id:{},sourceNode:{},targetNode:{},source:{},target:{},type:{},label:{},style:{},selected:{type:Boolean},sourcePosition:{},targetPosition:{},sourceHandleId:{},targetHandleId:{},animated:{type:Boolean},updatable:{type:Boolean},markerStart:{},markerEnd:{},curvature:{},interactionWidth:{},data:{},events:{},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{},sourceX:{},sourceY:{},targetX:{},targetY:{}},setup(e){const t=useFlowStore(),a=useConfigStore(),o=e,n=computed(()=>getBezierPath(o)),r=computed(()=>`position: absolute; transform: translate(-50%, -50%) translate(${n.value[1]}px,${o.sourceY+16}px`),s=computed(()=>`width: ${t.cardWidth}px; padding: 5px 10px; text-align: center; pointer-events: all;); border-radius: 2px; ${r.value}`),{onDragOver:l,onDragLeave:i,isDragging:u,draggedType:g,edge:_,onDrop:m}=useDragAndDrop(),v=ref(!1),x=()=>{const T=t.edges.find(({data:f})=>f.id===o.data.id);T.markerEnd=MarkerType.ArrowClosed;const C=JSON.parse(JSON.stringify(T));return C.newId=t.getNewEdgeId(),C},D=T=>{v.value=!0;const C=x();l(T,C)},y=()=>{v.value=!1,i()},b=computed(()=>{if(t.isView)return!1;const T=o.data.source,C=o.data.target;return T.startsWith(CARD_ID_NAME[CARD_TYPE.SELECTOR])&&C.startsWith(CARD_ID_NAME[CARD_TYPE.SELECTOR])?!!(C.endsWith("_end")||t.nodeMap[C]?.data?.type===CARD_TYPE.SELECTOR):!0}),w=computed(()=>CARD_LIST),E=computed(()=>{const T=o.data.source;return T!==t.activeCardId?{}:T.startsWith(CARD_ID_NAME[CARD_TYPE.SELECTOR])?{stroke:"#266EFF"}:{}}),V=T=>{g.value=T;const C=x();_.value=C,m(t,a)},N=()=>{v.value=!1,m(t,a)};return(T,C)=>{const f=_sfc_main$U,d=Popover;return openBlock(),createElementBlock(Fragment,null,[createVNode(unref(SmoothStepEdge$1),mergeProps(o,{style:E.value}),null,16,["style"]),createVNode(unref(_sfc_main$3$1),null,{default:withCtx(()=>[b.value?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass({"is-dragging":v.value,"drag-box":!0}),style:normalizeStyle(s.value),onDragover:D,onDragleave:y,onDrop:N},[withDirectives(createBaseVNode("div",_hoisted_1$y,null,512),[[vShow,unref(u)]]),createBaseVNode("span",_hoisted_2$q,[createVNode(d,{position:"rt",trigger:"hover","content-style":{padding:0,border:0},"arrow-style":{display:"none"},"popup-container":".designer-app"},{content:withCtx(()=>[createBaseVNode("div",_hoisted_3$h,[(openBlock(!0),createElementBlock(Fragment,null,renderList(w.value,(h,k)=>(openBlock(),createElementBlock("div",{class:"add-card_item",key:"add_"+k,onClick:S=>V(h)},[createVNode(f,{name:h.icon,size:"16px"},null,8,["name"]),createBaseVNode("span",null,toDisplayString(h.label),1)],8,_hoisted_4$e))),128))])]),default:withCtx(()=>[createVNode(f,{name:"add-card",size:"14px"})]),_:1})])],38)):createCommentVNode("",!0)]),_:1})],64)}}}),_hoisted_1$x={class:"card-merge_content"},_sfc_main$R=defineComponent({__name:"card-merge",setup(e){const t=useFlowStore(),a=computed(()=>t.cardWidth);return(o,n)=>{const r=_sfc_main$U;return openBlock(),createElementBlock("div",{class:"card-merge nodrag",style:normalizeStyle({width:a.value+"px"})},[createBaseVNode("div",_hoisted_1$x,[createVNode(r,{name:"merge",size:"16px"})])],4)}}}),useVerifiesStore=defineStore("verifies",{state:()=>({verifies:{}}),getters:{verifiesData:e=>e.verifies},actions:{verifyAll(e){e.forEach(t=>{this.verify({data:t.data,cardId:t.id,cardType:t.data.type})})},verify({data:e,cardId:t,cardType:a}){switch(a){case CARD_TYPE.START:this.verifies[t]=this.verifyStart(e)?.verified;return;case CARD_TYPE.PROMPT:this.verifies[t]=this.verifyPrompt(e)?.verified;return;case CARD_TYPE.KNOWLEDGE:this.verifies[t]=this.verifyKnowledge(e)?.verified;return;case CARD_TYPE.CHAT_BI:this.verifies[t]=this.verifyChatBI(e)?.verified;return;case CARD_TYPE.MESSAGE:case CARD_TYPE.INTERACTIVE:this.verifies[t]=this.verifyCard(e)?.verified;return;case CARD_TYPE.PLUGIN:this.verifies[t]=this.verifyPlugin(e)?.verified;return;case CARD_TYPE.FINISH:this.verifies[t]=this.verifyEnd(e)?.verified;return;case CARD_TYPE.SELECTOR:this.verifies[t]=this.verifySelector(e)?.verified;return;case CARD_TYPE.PAGE:this.verifies[t]=this.verifyPage(e)?.verified;return;case CARD_TYPE.DOCUMENT_ANALYSIS:this.verifies[t]=this.verifyDocumentAnalysis(e)?.verified;return;case CARD_TYPE.IMAGE_ANALYSIS:this.verifies[t]=this.verifyImageAnalysis(e)?.verified;return;case CARD_TYPE.AUXILIARY_INPUT:this.verifies[t]=this.verifyAuxiliaryInput(e)?.verified;return;case CARD_TYPE.TEXT_TEMPLATE:this.verifies[t]=this.verifyTextTemplate(e)?.verified;return;case CARD_TYPE.INTENTION_RECOGNITION:this.verifies[t]=this.verifyIntentionRecognition(e)?.verified;return;case CARD_TYPE.SMART_CHECK:this.verifies[t]=this.verifyPlan(e)?.verified}},onLoopOutputs(e){const t=a=>a?a?.some(o=>!o||!o.code||!o.name?!0:o.schema&&o.schema?.length?t(o.schema):!1):!1;return t(e?.outputs)},commonVerify(e){if(!e.name)return{verified:!1,message:"请完善步骤名称"};if(e.outputType===OUTPUT_TYPE.VARIABLES){const t=e.outputs.some(a=>!a.code||!a.name);if(!e.outputs.length||t)return{verified:!1,message:"请完善参数列表"}}return{verified:!0}},verifyStart(e){return this.commonVerify(e)},verifyPrompt(e){return e.templateId?e.inputs.some(a=>!!a.required&&!a?.value?.content)?{verified:!1,message:"请完善输入参数"}:this.commonVerify(e):{verified:!1,message:"提示模板必填"}},verifyChatBI(e){return e.knowledges.length?e.inputs?.[0]?.value?.content?this.commonVerify(e):{verified:!1,message:"请完善输入参数"}:{verified:!1,message:"请选择数据知识库"}},verifyKnowledge(e){return e.knowledges.length?e.inputs?.[0]?.value?.content?this.commonVerify(e):{verified:!1,message:"请完善输入参数"}:{verified:!1,message:"请选择知识库"}},verifyCard(e){return e.templateId===CARD_TEMPLATE_TYPE.TEXT&&!e.content?{verified:!1,message:"请完善卡片模板"}:e.templateId===CARD_TEMPLATE_TYPE.FORM&&!e.title?{verified:!1,message:"请完善卡片标题"}:e.outputs?.length&&e.outputs.some(a=>a.type==="group"&&a.name?!1:!a.code||!a.name||!a?.value?.content?!0:a.schema?.length?a.schema.some(o=>!o.code||!o.name||!o?.value?.content):!1)?{verified:!1,message:"请完善字段信息"}:this.commonVerify(e)},verifyPlugin(e){return e.pluginId?e.toolId?e.inputs.some(a=>!!a.required&&!a?.value?.content)?{verified:!1,message:"请完善输入参数"}:this.commonVerify(e):{verified:!1,message:"请选择插件服务"}:{verified:!1,message:"请选择插件"}},verifyEnd(e){return e?.outputs?.some(a=>!a.value?.content||!a.code||!a.name)?{verified:!1,message:"请完善输出参数"}:{verified:!0}},verifySelector(e){return e.conditions.some(a=>a.type==="else"?!1:a.expressions.length===0?!0:a.expressions[0].rules.some(o=>o.left?.value?.content?o.right?.value?.content?!1:!["isempty","notisempty"].includes(o.operator):!0))?{verified:!1,message:"请完善条件表达式"}:this.commonVerify(e)},verifyPage(e){return e.url?.content?e.url?.type==="literal"&&!validateURL(e.url.content)?{verified:!1,message:"请输入正确的URL"}:this.commonVerify(e):{verified:!1,message:"请完善页面地址"}},verifyDocumentAnalysis(e){return e.files?.content?e.imageRecognizeType==="ocr"&&!e.ocrService?{verified:!1,message:"请完善视觉识别服务"}:e.pattern===1&&(this.onLoopOutputs(e)||!e.outputs?.length)?{verified:!1,message:"请完善输出参数"}:this.commonVerify(e):{verified:!1,message:"请完善输入参数"}},verifyImageAnalysis(e){return e.files?.content?e.recognizeType==="ocr"?e.ocrService?e.pattern===1&&(this.onLoopOutputs(e)||!e.outputs?.length)?{verified:!1,message:"请完善输出参数"}:{verified:!0}:{verified:!1,message:"请完善视觉识别服务"}:this.verifyPrompt(e):{verified:!1,message:"请完善输入参数"}},verifyAuxiliaryInput(e){if(!e.appCode)return{verified:!1,message:"请选择应用"};if(!e.formId)return{verified:!1,message:"请选择表单"};const t=e.inputs?.some(a=>!a.value?.content);return!e.inputs?.length||t?{verified:!1,message:"请完善输入参数"}:this.commonVerify(e)},verifyTextTemplate(e){if(!e?.content)return{verified:!1,message:"请完善模板内容"};const t=e.inputs?.some(a=>!a.value?.content);return!e.inputs?.length||t?{verified:!1,message:"请完善输入参数"}:this.commonVerify(e)},verifyIntentionRecognition(e){if(!e._input?.content)return{verified:!1,message:"请完善输入参数"};const t=e.classifications?.some(a=>!a?.intention);return!e.classifications?.length||t?{verified:!1,message:"请完善意图匹配"}:this.commonVerify(e)},verifyPlan(e){return e.id?e.inputs.some(a=>!!a.required&&!a?.value?.content)?{verified:!1,message:"请完善输入参数"}:this.commonVerify(e):{verified:!1,message:"请选择方案"}}}}),_hoisted_1$w={class:"flex items-center justify-center gap-[6px] self-stretch leading-[22px]"},_hoisted_2$p={class:"ml-[6px] w-[194px] text-[13px] font-semibold not-italic text-[#333333]"},_hoisted_3$g=["title"],_hoisted_4$d={class:"flex flex-row justify-center"},_sfc_main$Q=defineComponent({__name:"card-node",props:{nodeProps:{type:Object,default:()=>{}},edges:{type:Object,default:()=>[]}},emits:["select"],setup(e,{emit:t}){const{updateEdge:a,removeNodes:o,removeEdges:n}=useVueFlow(),r=useFlowStore(),s=e,l=t,i=ref(!1),u=computed(()=>s.nodeProps.data),g=computed(()=>s.edges.some(f=>f.target===s.nodeProps.id)),_=computed(()=>s.edges.some(f=>f.source===s.nodeProps.id)),m=computed(()=>r.cardWidth),v=()=>{if(s.nodeProps.id===r.activeCardId&&l("select",r.flowNodes[0]),s.nodeProps.data.type===CARD_TYPE.SELECTOR)l("select",r.flowNodes[0]),r.removeSelectorNodes(s.nodeProps.id,!0);else{r.removeNode(s.nodeProps.id);const{targetItem:f,sourceItem:d}=r.removeEdge(s.nodeProps.id);d.markerEnd||delete f.markerEnd,a(f,f),o(s.nodeProps.id),n(d),r.updatePosition()}},x=computed(()=>!r.isView&&r.activeCardId===s.nodeProps.id),D=()=>{l("select",s.nodeProps)},y=computed(()=>!r.isView&&s.nodeProps.data.type!==CARD_TYPE.START),b=computed(()=>!r.isView&&s.nodeProps.data.type!==CARD_TYPE.FINISH),w=computed(()=>{const f=r.nodeOrder.findIndex(d=>d===s.nodeProps.id);return getStepName(f)||""}),E=useVerifiesStore(),V=computed(()=>!!E.verifiesData?.[s.nodeProps.id]),N=()=>{i.value=!0},T=computed(()=>w.value+(u.value.name||u.value.describe||"")),C=computed(()=>r.warningNodes?.some(({id:f})=>f===s.nodeProps.id));return(f,d)=>{const h=_sfc_main$U,k=Button,S=Popover,A=Modal;return openBlock(),createElementBlock(Fragment,null,[y.value?(openBlock(),createBlock(unref(_sfc_main$f$1),{key:0,type:"source",position:unref(Position).Top,class:normalizeClass({"handle-hidden":g.value})},null,8,["position","class"])):createCommentVNode("",!0),createBaseVNode("div",{class:normalizeClass([{"node-active":x.value,nodrag:!0},"card-node flex-col items-center justify-center rounded-[4px] border-[1px] border-solid border-[#EAEAEA] bg-[#FFF] px-[12px] py-[10px]"]),onClick:D,style:normalizeStyle({width:m.value+"px"})},[createBaseVNode("div",_hoisted_1$w,[C.value?(openBlock(),createBlock(h,{key:0,name:"warning",color:"#ff9902",size:"20px"})):(openBlock(),createBlock(h,{key:1,name:"success",size:"20px",color:V.value?"#1CC78D":"#C5C5C5"},null,8,["color"])),createBaseVNode("span",_hoisted_2$p,toDisplayString(u.value._actionName),1)]),createBaseVNode("div",{class:"text-ellipsis text-xs font-normal not-italic leading-[20px] text-[#999999]",title:T.value},toDisplayString(T.value),9,_hoisted_3$g),createVNode(S,{position:"bottom","arrow-style":{display:"none"},"content-style":{padding:"4px 0",display:"inline-block",width:"82px"},"popup-container":".designer-app"},{content:withCtx(()=>[createVNode(k,{type:"text",class:"float-left w-[100%]",style:{color:"#333"},onClick:N},{default:withCtx(()=>d[1]||(d[1]=[createTextVNode("删除")])),_:1})]),default:withCtx(()=>[y.value&&b.value?(openBlock(),createBlock(h,{key:0,name:"more",size:"16px",class:"card-btn absolute right-[12px] top-[12px] cursor-pointer"})):createCommentVNode("",!0)]),_:1})],6),b.value?(openBlock(),createBlock(unref(_sfc_main$f$1),{key:1,type:"source",position:unref(Position).Bottom,class:normalizeClass({"handle-hidden":_.value})},null,8,["position","class"])):createCommentVNode("",!0),createVNode(A,{visible:i.value,"onUpdate:visible":d[0]||(d[0]=O=>i.value=O),simple:!0,"title-align":"start","popup-container":".designer-app",onOk:v},{title:withCtx(()=>[createBaseVNode("div",_hoisted_4$d,[createVNode(h,{name:"warning",color:"#FF9902",size:"24px"}),d[2]||(d[2]=createBaseVNode("span",{class:"ml-[12px] text-base font-semibold not-italic leading-[24px] text-[#333333]"},"确认删除",-1))])]),default:withCtx(()=>[d[3]||(d[3]=createBaseVNode("div",{class:"ml-[36px] text-[13px] font-normal not-italic leading-[22px] text-[#666666]"}," 是否确认删除当前卡片？ ",-1))]),_:1},8,["visible"])],64)}}}),_sfc_main$P=defineComponent({__name:"vue-flow",setup(e){const t=useFlowStore(),a=useConfigStore(),o=useConditionStore();onMounted(()=>{t.nodes?.length>0&&v(t.nodes[0])});const{addEdges:n,panOnDrag:r,panOnScrollMode:s,panOnScroll:l}=useVueFlow();r.value=!0,l.value=!0,s.value=PanOnScrollMode.Vertical;const{isDragOver:i}=useDragAndDrop(),u=computed(()=>t.nodes),g=computed(()=>t.edges),_=computed(()=>t.isView);function m(x){if(!x.targetHandle?.endsWith("__handle-top")||!x.sourceHandle?.endsWith("__handle-bottom")||g.value.some(b=>b.target===x.target))return;const y={...x,type:"custom",markerEnd:MarkerType.ArrowClosed};y.data=JSON.parse(JSON.stringify(y)),n([y])}const v=x=>{o.setActive(""),t.setActiveCard(x),a.setData(x)};return t.getKnowledgeList().then(x=>{a.updateKnowledgeOptions(x)}),(x,D)=>(openBlock(),createBlock(unref(_sfc_main$1$1),{nodes:u.value,edges:g.value,"onUpdate:edges":D[3]||(D[3]=y=>g.value=y),onConnect:m,"max-zoom":1.2,"min-zoom":.8,style:normalizeStyle(unref(t).isDesigner?{background:"#f3f4f9"}:{}),"elevate-edges-on-select":"","delete-key-code":null},{"node-card":withCtx(y=>[createVNode(_sfc_main$Q,{nodeProps:y,edges:g.value,"onUpdate:edges":D[0]||(D[0]=b=>g.value=b),onSelect:v},null,8,["nodeProps","edges"])]),"node-condition":withCtx(y=>[createVNode(_sfc_main$T,{nodeProps:y,edges:g.value,"onUpdate:edges":D[1]||(D[1]=b=>g.value=b),onSelect:v},null,8,["nodeProps","edges"])]),"node-merge":withCtx(y=>[createVNode(_sfc_main$R,{nodeProps:y,edges:g.value,"onUpdate:edges":D[2]||(D[2]=b=>g.value=b),onSelect:v},null,8,["nodeProps","edges"])]),"edge-custom":withCtx(y=>[createVNode(_sfc_main$S,normalizeProps(guardReactiveProps(y)),null,16)]),default:withCtx(()=>[_.value?(openBlock(),createBlock(unref(_sfc_main$W),{key:0,variant:"lines",gap:19,patternColor:"#F3F5F8",style:normalizeStyle({backgroundColor:unref(i)?"#e7f3ff":"#FAFAFA",transition:"background-color 0.2s ease"})},{default:withCtx(()=>[renderSlot(x.$slots,"default")]),_:3},8,["style"])):createCommentVNode("",!0)]),_:3},8,["nodes","edges","style"]))}}),_hoisted_1$v=["draggable"],_hoisted_2$o={class:"h-[20px] w-[20px] text-xl"},_hoisted_3$f={class:"mt-[4px] text-center text-xs font-normal not-italic leading-[20px] text-[#333333]"},_hoisted_4$c={key:0,class:"mx-[0] my-[8px] h-[1px] bg-[#EAEAEA]"},_sfc_main$O=defineComponent({__name:"tool-item",props:{item:{type:Object,default:()=>{}},draggable:{type:Boolean,default:!0}},setup(e){const{onDragStart:t}=useDragAndDrop(),a=e,o=computed(()=>a.item),n=(r,s)=>{t(r,s)};return(r,s)=>{const l=_sfc_main$U,i=Tooltip;return openBlock(),createElementBlock(Fragment,null,[createVNode(i,{content:o.value.describe,position:"right","background-color":"#FFFFFF","content-style":{color:"#333333",padding:"8px 12px","border-radius":"4px","box-shadow":"0 3px 8px 0 #0000001a"},"arrow-style":{border:"1px solid #EAEAEA","box-shadow":"0 3px 8px 0 #0000001a"},"popup-container":".designer-app"},{default:withCtx(()=>[createBaseVNode("div",{draggable:e.draggable,onDragstart:s[0]||(s[0]=u=>n(u,e.item)),class:"card-tool_item flex h-[64px] w-[100%] cursor-pointer flex-col items-center justify-center gap-[4px] hover:bg-[#F2F4F6]"},[createBaseVNode("div",_hoisted_2$o,[createVNode(l,{name:o.value.icon},null,8,["name"])]),createBaseVNode("div",_hoisted_3$f,toDisplayString(o.value.label),1)],40,_hoisted_1$v)]),_:1},8,["content"]),o.value.splitLine?(openBlock(),createElementBlock("div",_hoisted_4$c)):createCommentVNode("",!0)],64)}}}),_sfc_main$N=defineComponent({__name:"tool",setup(e){const t=ref(CARD_LIST);return(a,o)=>(openBlock(!0),createElementBlock(Fragment,null,renderList(t.value,(n,r)=>(openBlock(),createBlock(_sfc_main$O,{item:n,key:r,draggable:!0},null,8,["item"]))),128))}}),_sfc_main$M=defineComponent({__name:"form-actions",props:{formData:{type:Object,default:()=>({})}},setup(e){const t=e;return onMounted(()=>{t.formData.props?.actions?.length||t.formData.props&&(t.formData.props.actions=[{code:"card-confirm",name:"",description:""}])}),(a,o)=>{const n=Input,r=FormItem,s=Textarea;return e.formData.props?.actions?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(r,{field:"props.actions[0].name",label:"按钮标题",style:{width:"100%"}},{default:withCtx(()=>[createVNode(n,{modelValue:e.formData.props.actions[0].name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.formData.props.actions[0].name=l),placeholder:"请输入按钮标题"},null,8,["modelValue"])]),_:1}),createVNode(r,{field:"props.actions[0].description",label:"按钮说明",style:{width:"100%"}},{default:withCtx(()=>[createVNode(s,{modelValue:e.formData.props.actions[0].description,"onUpdate:modelValue":o[1]||(o[1]=l=>e.formData.props.actions[0].description=l),placeholder:"请输入按钮说明","allow-clear":""},null,8,["modelValue"])]),_:1})],64)):createCommentVNode("",!0)}}}),onQueryPrompt=e=>axios.request({url:"/api/42000301/skill/promptQuery",method:"POST",data:{promptName:e,promptCode:e,spaceGUID}}),_hoisted_1$u={class:"select-field_cascader"},_sfc_main$L=defineComponent({__name:"select-field",props:{paramsData:{},filterSystemCode:{type:Boolean},noLevel:{type:Boolean},stepName:{}},emits:["input","select"],setup(e,{emit:t}){const a=e,o=t,n=ref("step"),r=ref([]),s=ref(!1),l=ref(""),i=ref(""),u=computed(()=>a.paramsData.some(b=>b.code==="system")),g=computed(()=>a.noLevel?a.paramsData:a.paramsData.filter(b=>b.children?.length>0)),_=computed(()=>n.value==="step"?g.value.filter(w=>w.code!=="system"):g.value.filter(w=>w.code==="system")?.[0]?.children||[]);watch(()=>_.value,b=>{r.value=b,l.value&&D()},{immediate:!0});const m=b=>{n.value=b},v=b=>{let w=null;_.value.find(E=>{if(E.children&&E.children.find(V=>{if(V.value===b)return w=V,!0;if(V.children)return V.children.find(N=>{if(N.value===b)return w=N,!0})}),E.value===b)return w=E,!0}),o("select",w),o("input",!1),s.value=!1},x=(b,w)=>{if(!w)return[];if(!b)return w;b=b.toLocaleLowerCase();const E="label",V="children",N=[];return Object.prototype.toString.call(w)==="[object Array]"&&w.forEach(T=>{const C=T[E]?.toLocaleLowerCase()||"",f=T.code?.toLocaleLowerCase()||"";if(C.indexOf(b)>-1||f.indexOf(b)>-1){const d={...T,children:T[V]};N.push(d)}else if(T[V]&&T[V].length>0){const d=x(b,T[V]),h={...T,children:d};d&&d.length>0&&N.push(h)}}),N},D=()=>{r.value=x(l.value,_.value)},y=b=>{s.value&&b.target instanceof HTMLElement&&b.target.classList.contains("arco-trigger-content")&&(s.value=!1)};return onMounted(()=>{document.addEventListener("click",y)}),onUnmounted(()=>{document.removeEventListener("click",y)}),(b,w)=>{const E=InputSearch,V=TabPane,N=Tabs,T=CascaderPanel,C=Popover;return b.$slots.default?(openBlock(),createBlock(C,{key:0,trigger:"click",placement:"right",position:"br","popup-visible":s.value,"onUpdate:popupVisible":w[3]||(w[3]=f=>s.value=f),"content-style":{padding:0,boxShadow:"none",borderWidth:0,background:"transparent",width:"424px",display:"flex",justifyContent:"flex-end"},"arrow-style":{display:"none"},"popup-container":".designer-app"},{content:withCtx(()=>[createBaseVNode("div",_hoisted_1$u,[createVNode(E,{style:{width:"100%"},placeholder:"请输入",modelValue:l.value,"onUpdate:modelValue":w[1]||(w[1]=f=>l.value=f),onInput:D},null,8,["modelValue"]),createVNode(N,{"default-active-key":n.value,"hide-content":"",onChange:m},{default:withCtx(()=>[createVNode(V,{key:"step",title:b.stepName||"步骤变量"},null,8,["title"]),u.value?(openBlock(),createBlock(V,{key:"system",title:"系统变量"})):createCommentVNode("",!0)]),_:1},8,["default-active-key"]),(openBlock(),createBlock(T,{key:n.value,options:r.value,modelValue:i.value,"onUpdate:modelValue":w[2]||(w[2]=f=>i.value=f),onChange:v},null,8,["options","modelValue"]))])]),default:withCtx(()=>[createBaseVNode("div",{class:"float-right inline-block",onClick:w[0]||(w[0]=f=>s.value=!0)},[renderSlot(b.$slots,"default")])]),_:3},8,["popup-visible"])):createCommentVNode("",!0)}}}),scriptRel="modulepreload",assetsURL=function(e){return"/gptbuilder/designer/"+e},seen={},__vitePreload=function e(t,a,o){let n=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");n=Promise.allSettled(a.map(i=>{if(i=assetsURL(i),i in seen)return;seen[i]=!0;const u=i.endsWith(".css"),g=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${g}`))return;const _=document.createElement("link");if(_.rel=u?"stylesheet":scriptRel,u||(_.as="script"),_.crossOrigin="",_.href=i,l&&_.setAttribute("nonce",l),document.head.appendChild(_),u)return new Promise((m,v)=>{_.addEventListener("load",m),_.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${i}`)))})}))}function r(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return n.then(s=>{for(const l of s||[])l.status==="rejected"&&r(l.reason);return t().catch(r)})};var PlaceholderType=(e=>(e.VARIABLE="variable",e.FUNCTION="function",e.PARAMETER="parameter",e.REFERENCE="reference",e.UNKNOWN="unknown",e))(PlaceholderType||{});const useMarkdownEditor=({content:e,data:t,elementId:a,disabled:o,minHeight:n,maxHeight:r,update:s})=>{const l=useTemplateRef(a),i=shallowRef(null),u=shallowRef([]);let g,_;const m=y=>{const b=i.value?.state.doc.toString();y!==b&&i.value?.dispatch({changes:{from:0,to:b?.length,insert:y}})},v=()=>{if(!i.value)return;const y=i.value.state.doc,b=[];for(let w=0;w<y.lines;w++){const E=y.line(w+1),V=E.text,N=/\{\{\$(\w+)\}\}/g;let T;for(;(T=N.exec(V))!==null;){const C=T[1];t.value[`$${C}`]||b.push({from:E.from+T.index,to:E.from+T.index+T[0].length})}}b.length>0&&i.value.dispatch({changes:b})};onMounted(async()=>{if(!l.value)return;const{createMarkdownEditor:y}=await __vitePreload(async()=>{const{createMarkdownEditor:V}=await import("./markdownEditor.js");return{createMarkdownEditor:V}},__vite__mapDeps([0,1,2])),{markdownEditorView:b,addFieldToCurrent:w,refreshPlaceholders:E}=y(l.value,e.value,{sourceMap:t.value,disabled:!!o,minHeight:n,maxHeight:r,update:s});i.value=b,g=w,_=E,u.value&&u.value.length>0&&(u.value.forEach(V=>V()),u.value=[])});const x=y=>{_&&_(t.value),g&&g(y)},D=()=>{if(!i.value){u.value=[D];return}_&&_(t.value,!0),v()};return{markdownEditorView:i,addFieldToCurrent:x,setContent:m,refreshPlaceholders:D}},_hoisted_1$t={class:"designer-template-editor w-[100%]"},_hoisted_2$n={class:"pd-input-textarea__header"},_hoisted_3$e={key:0,class:"pd-input-textarea__header-title"},_hoisted_4$b={class:"pd-input-textarea__header-btn"},_hoisted_5$a={class:"pd-input-textarea__header-btn"},_hoisted_6$7={key:0,class:"text-xs font-normal not-italic leading-[20px] text-[#999999]"},_sfc_main$K=defineComponent({__name:"template-editor",props:{value:{type:Object,default:()=>{}},minHeight:{type:String,default:"240px"},maxHeight:{type:String,default:"400px"},prompt:{type:String,default:""},inputs:{type:Array,default:()=>[]},mode:{type:String,default:"textarea"},placeholder:{type:String,default:"请输入提示词"},disabled:{type:Boolean,default:!1},isCustom:{type:Boolean,default:!1},customParams:{type:Object,default:()=>[]},title:{type:String,default:""},allowDel:{type:Boolean,default:!1},selected:{type:Array,default:()=>[]},filterSystemCode:{type:Boolean,default:!1},noLevel:{type:Boolean,default:!1},stepName:{type:String,default:""}},emits:["input","inputs","del","fieldInfo"],setup(e,{emit:t}){const a=e,o=t,n=useFlowStore(),r=computed(()=>a.isCustom?a.customParams:n.getParamsData()),s=computed(()=>a.isCustom?a.customParams:n.getParamsData(!0));let l=ref("");const i=C=>{l.value=C},u=computed(()=>{const C={};return r.value.forEach(f=>{f.children&&f.children.forEach(d=>{d.title=d.name,C[d.value]=d,d.children&&d.children.forEach(h=>{h.title=h.name,C[h.value]=h})}),a.noLevel&&(f.title=f.name,C[f.value]=f)}),C}),g=computed(()=>a.inputs.reduce((C,f)=>(f.value?.content&&(C[f.code]=u.value[f.value.content]),C),{})),_=computed(()=>a.isCustom?u.value:g.value),m=/{{\$([^{}]+)}}/g,v=C=>{const f=_.value,d=C.replace(/[\n\r\t\f\v\u2028\u2029]/g,""),h=[];let k;for(;(k=m.exec(d))!==null;){const[,S]=k,A=f[S]||{};A.value?h.push({code:S,value:{type:"ref",content:A.value}}):nextTick(()=>{N(S)})}o("inputs",h)},x=computed(()=>Object.keys(u.value).map(C=>u.value[C].code)),D=computed(()=>{const C={};return Object.keys(_.value).forEach(f=>{const d=_.value[f];C[`$${f}`]={...d,type:"variable",label:d.name||d.title||d.label||d.value}}),C});onMounted(()=>{l.value=a.value,v(l.value)});const{setContent:y,addFieldToCurrent:b,refreshPlaceholders:w}=useMarkdownEditor({content:l,data:D,elementId:"refEditor",disabled:a.disabled,minHeight:a.minHeight,maxHeight:a.maxHeight,update:C=>{o("input",C)}}),E=C=>{let f=0;return a.inputs.forEach(d=>{if(d.code.startsWith(C)){const h=Number(d.code.replace(C,""));typeof h=="number"&&(f=h+1)}}),C+f},V=C=>{if(a.isCustom){b(C.value);return}const f=E(C.code);o("inputs",[...a.inputs,{code:f,value:{type:"ref",content:C.value}}]),nextTick(()=>{b(f)})},N=C=>{if(x.value.includes(C)){const f=E(C),d=Object.keys(u.value).find(k=>u.value[k].code===C),h=u.value[d||""]||{};h&&(o("inputs",[...a.inputs,{code:f,value:{type:"ref",content:h.value}}]),nextTick(()=>{i(l.value.replace(`{{$${C}}}`,`{{$${f}}}`)),y(l.value.replace(`{{$${C}}}`,`{{$${f}}}`))}))}};watch(()=>l.value,C=>{v(l.value),y(C),nextTick(()=>{w(),o("input",C)})});const T=()=>{o("del")};return(C,f)=>(openBlock(),createElementBlock("div",_hoisted_1$t,[createBaseVNode("div",{class:normalizeClass(["pd-input-textarea",{"pd-input-textarea_input":!0,"pd-input-textarea_disabled":e.disabled}])},[createBaseVNode("div",_hoisted_2$n,[e.title?(openBlock(),createElementBlock("div",_hoisted_3$e,toDisplayString(e.title),1)):createCommentVNode("",!0),e.allowDel?(openBlock(),createElementBlock("div",{key:1,class:"pd-input-textarea__header-btn del",title:"删除",onClick:T},[createVNode(_sfc_main$U,{name:"trash",size:"16px",color:"#999"})])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_4$b,[renderSlot(C.$slots,"btn")]),C.$slots.btn?createCommentVNode("",!0):(openBlock(),createBlock(_sfc_main$L,{key:2,paramsData:s.value,selected:e.selected,onSelect:V,filterSystemCode:e.filterSystemCode,noLevel:e.noLevel,stepName:e.stepName},{default:withCtx(()=>[createBaseVNode("div",_hoisted_5$a,[createVNode(_sfc_main$U,{name:"add",size:"16px"}),f[0]||(f[0]=createTextVNode("插入变量 "))])]),_:1},8,["paramsData","selected","filterSystemCode","noLevel","stepName"]))]),createBaseVNode("div",{ref:"refEditor",class:"pd-input-textarea__body",style:normalizeStyle({"min-height":e.minHeight,"max-height":e.maxHeight,"--editor-min-height":`${e.minHeight}`,"--editor-max-height":`${e.maxHeight}`})},null,4)],2),e.prompt?(openBlock(),createElementBlock("span",_hoisted_6$7,toDisplayString(e.prompt),1)):createCommentVNode("",!0)]))}}),_hoisted_1$s={class:"designer-field-selector w-[100%]"},_hoisted_2$m={class:"absolute right-[8px] top-[7px] flex cursor-pointer"},_sfc_main$J=defineComponent({__name:"field-filling",props:{value:{type:Object,default:()=>{}},prompt:{type:String,default:""},inputs:{type:Array,default:()=>[]},placeholder:{type:String,default:"请输入提示词"},disabled:{type:Boolean,default:!1},isCustom:{type:Boolean,default:!1},customParams:{type:Object,default:()=>[]},title:{type:String,default:""},inputDisabled:{type:Boolean,default:!1},selected:{type:Array,default:()=>[]},filterSystemCode:{type:Boolean,default:!1},noLevel:{type:Boolean,default:!1},stepName:{type:String,default:""}},emits:["input","inputs","del","fieldInfo"],setup(e,{emit:t}){const a=e,o=t,n=useFlowStore(),r=computed(()=>a.isCustom?a.customParams:n.getParamsData()),s=computed(()=>a.isCustom?a.customParams:n.getParamsData(!0)),l=computed(()=>{const x={};return r.value.forEach(D=>{D.children&&D.children.forEach(y=>{y.title=y.name,x[y.value]=y,y.children&&y.children.forEach(b=>{b.title=b.name,x[b.value]=b})}),a.noLevel&&(D.title=D.name,x[D.value]=D)}),x});let i=ref("");const u=x=>{i.value=x};onMounted(()=>{i.value=a.value?.content||"",a.value?.type==="literal"&&i.value&&(g.value=i.value)});const g=ref(""),_=computed(()=>{const x=l.value?.[i.value];return x?[{value:i.value,label:x?.name,closable:!0,tagProps:{size:"small"}}]:[]}),m=x=>{if(a.inputDisabled){u(x.value);return}g.value&&(g.value=""),u(x.value)};watch(()=>i.value,x=>{if(a.inputDisabled){o("fieldInfo",l.value?.[x]||{}),o("input",{type:"ref",content:x});return}const D=!!g.value,y=D?g.value:x;o("fieldInfo",l.value?.[y]||{}),o("input",D?{type:"literal",content:g.value}:{type:"ref",content:y||""})});const v=x=>{a.inputDisabled||(i.value&&l.value[i.value]&&u(""),g.value=x,u(x))};return(x,D)=>{const y=InputTag;return openBlock(),createElementBlock("div",_hoisted_1$s,[createVNode(y,{modelValue:_.value,inputValue:g.value,disabled:e.disabled,placeholder:e.placeholder,size:"medium","retain-input-value":!e.inputDisabled,maxTagCount:1,onRemove:D[0]||(D[0]=()=>u("")),onInputValueChange:v},null,8,["modelValue","inputValue","disabled","placeholder","retain-input-value"]),e.disabled?createCommentVNode("",!0):(openBlock(),createBlock(_sfc_main$L,{key:0,paramsData:s.value,selected:e.selected,onSelect:m,filterSystemCode:e.filterSystemCode,noLevel:e.noLevel,stepName:e.stepName},{default:withCtx(()=>[createBaseVNode("div",_hoisted_2$m,[createVNode(_sfc_main$U,{name:"add",size:"16px"})])]),_:1},8,["paramsData","selected","filterSystemCode","noLevel","stepName"]))])}}}),_hoisted_1$r={class:"field-form_box w-[100%] pb-[12px]"},_hoisted_2$l={key:0,class:"mb-[8px] box-border flex w-[calc(100%_-_24px)] flex-row pl-[18px]"},_hoisted_3$d={key:0,class:"absolute left-[0] flex h-[32px] w-[18px] items-center"},_sfc_main$I=defineComponent({__name:"field-form",props:{config:{type:Object,default:()=>[]},value:{type:Object,default:()=>[]},allowAdd:{type:Boolean,default:!0},allowDelete:{type:Boolean,default:!0},selected:{type:Array,default:()=>[]},filterSystemCode:{type:Boolean,default:!1},isFillField:{type:Boolean,default:!1},defaultRow:{type:Object},enableSort:{type:Boolean,default:!1},showLabel:{type:Boolean,default:!1}},emits:["input","change"],setup(e,{expose:t,emit:a}){const o=e,n=a;let r={};const s=ref(o.config),l=ref(0);o.defaultRow?r=o.defaultRow:o.config.forEach(y=>{r[y.prop]=y.default});const i=reactive({nodeParam:[]});watch(()=>o.value,y=>{i.nodeParam=y},{immediate:!0}),watch(()=>i.nodeParam,y=>{n("change",y)},{deep:!0});const u=()=>{i.nodeParam.push({...r}),l.value+=1,n("input",i.nodeParam)},g=y=>{i.nodeParam.splice(y,1),l.value+=1,n("input",i.nodeParam)},_=computed(()=>({name:[{required:!0,message:"请完善名称"},{validator:(y,b)=>{y||b("请完善名称")}}],code:[{required:!0,message:"请完善编码"},{validator:(y,b)=>{y||b("请完善编码"),/^[A-Za-z_][A-Za-z0-9_]*$/.test(y)?i.nodeParam.filter(E=>E.code===y).length>1?b("编码不允许重复"):b():b("编码支持使用字母、数字和下划线")}}]})),m=(y,b)=>{if(o.isFillField&&!(b.value&&y.value?.content===b.value)){for(const w in y)if(Object.prototype.hasOwnProperty.call(y,w)&&b[w]!==void 0)switch(w){case"type":y[w]=b[w]??"string";break;case"required":y[w]=!!b[w];break;case"schema":y[w]=JSON.parse(JSON.stringify(b[w]||[]));break;default:y[w]=b[w];break}}},v=(y,b,w)=>{b==="code"&&(y[b]=w.trim())},x=ref(null),{option:D}=useSortable(x,i.nodeParam,{handle:".handle",onUpdate:y=>{const b=y.oldIndex,w=y.newIndex,E=i.nodeParam,V=E[b];E.splice(b,1),E.splice(w,0,V),i.nodeParam=E,l.value+=1,n("input",i.nodeParam)},onMove:y=>!y.related.className.endsWith("disabled")});return D("animation",200),t({add:u}),(y,b)=>{const w=_sfc_main$U,E=Input,V=FormItem,N=Checkbox,T=Option,C=Select,f=TreeSelect,d=Form;return openBlock(),createElementBlock("div",_hoisted_1$r,[e.showLabel?(openBlock(),createElementBlock("div",_hoisted_2$l,[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.value,h=>(openBlock(),createElementBlock("div",{style:normalizeStyle({width:h.width}),class:"text-[13px] font-normal not-italic leading-[22px] text-[#999999]"},toDisplayString(h.label),5))),256))])):createCommentVNode("",!0),createVNode(d,{class:"field-form form-custom",model:i,style:{width:"100%"},layout:"inline",ref_key:"refSelector",ref:x},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.nodeParam,(h,k)=>(openBlock(),createElementBlock("div",{class:"field-form_row w-[100%]",key:"row_"+k+"_"+l.value},[createBaseVNode("div",{class:normalizeClass(["field-form_row-inner float-left",{"field-form_full":!e.allowDelete,"field-form_sort":e.enableSort}])},[e.enableSort?(openBlock(),createElementBlock("span",_hoisted_3$d,[createVNode(w,{name:"drop",class:"handle cursor-all-scroll"})])):createCommentVNode("",!0),(openBlock(!0),createElementBlock(Fragment,null,renderList(s.value,S=>(openBlock(),createElementBlock(Fragment,null,[!S.hide&&S.type==="input"?(openBlock(),createBlock(V,{key:0,field:`nodeParam[${k}][${S.prop}]`,rules:_.value[S.prop]||[],style:normalizeStyle({width:S.width})},{default:withCtx(()=>[createVNode(E,{modelValue:h[S.prop],"onUpdate:modelValue":A=>h[S.prop]=A,placeholder:S.placeholder,onChange:A=>v(h,S.prop,A)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["field","rules","style"])):createCommentVNode("",!0),!S.hide&&S.type==="checkbox"?(openBlock(),createBlock(V,{key:1,field:`nodeParam[${k}][${S.prop}]`,rules:_.value[S.prop]||[],style:normalizeStyle({width:S.width})},{default:withCtx(()=>[createVNode(N,{modelValue:h[S.prop],"onUpdate:modelValue":A=>h[S.prop]=A,placeholder:S.placeholder,class:"left-[0] right-[0] m-auto"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","rules","style"])):createCommentVNode("",!0),!S.hide&&S.type==="select"?(openBlock(),createBlock(V,{key:2,field:`nodeParam[${k}][${S.prop}]`,disabled:!!S.disabled,style:normalizeStyle({width:S.width})},{default:withCtx(()=>[createVNode(C,{modelValue:h[S.prop],"onUpdate:modelValue":A=>h[S.prop]=A,placeholder:S.placeholder},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(S.options,(A,O)=>(openBlock(),createBlock(T,{value:A.value,disabled:!!A.disabled,key:"option_"+O},{default:withCtx(()=>[createTextVNode(toDisplayString(A.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","disabled","style"])):createCommentVNode("",!0),!S.hide&&S.type==="treeSelect"?(openBlock(),createBlock(V,{key:3,field:`nodeParam[${k}][${S.prop}]`,style:normalizeStyle({width:S.width})},{default:withCtx(()=>[createVNode(f,{fieldNames:{key:"mapValue",title:"name",children:"children"},data:S.treeData,modelValue:h[S.prop],"onUpdate:modelValue":A=>h[S.prop]=A,placeholder:S.placeholder},null,8,["data","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","style"])):createCommentVNode("",!0),S.type==="template-input"?(openBlock(),createBlock(V,{key:4,field:`nodeParam[${k}][${S.prop}]`,style:normalizeStyle({width:S.width})},{default:withCtx(()=>[createVNode(_sfc_main$K,{value:h[S.prop],minHeight:"30px",mode:S.mode||"input",placeholder:S.placeholder||"请选择/输入参数值","input-disabled":S.inputDisabled,onInput:A=>h[S.prop]=A,onFieldInfo:A=>m(h,A),selected:e.selected,filterSystemCode:e.filterSystemCode},null,8,["value","mode","placeholder","input-disabled","onInput","onFieldInfo","selected","filterSystemCode"])]),_:2},1032,["field","style"])):createCommentVNode("",!0),S.type==="field-filling"?(openBlock(),createBlock(V,{key:5,field:`nodeParam[${k}][${S.prop}]`,style:normalizeStyle({width:S.width})},{default:withCtx(()=>[createVNode(_sfc_main$J,{value:h[S.prop],placeholder:S.placeholder||"请选择/输入参数值","input-disabled":S.inputDisabled,onInput:A=>h[S.prop]=A,onFieldInfo:A=>m(h,A),selected:e.selected,filterSystemCode:e.filterSystemCode},null,8,["value","placeholder","input-disabled","onInput","onFieldInfo","selected","filterSystemCode"])]),_:2},1032,["field","style"])):createCommentVNode("",!0)],64))),256))],2),e.allowDelete?(openBlock(),createBlock(w,{key:0,name:"minus",size:"16px",onClick:S=>g(k)},null,8,["onClick"])):createCommentVNode("",!0)]))),128))]),_:1},8,["model"]),e.allowAdd?(openBlock(),createElementBlock("div",{key:1,class:"flex w-[48px] cursor-pointer flex-row items-center",onClick:u},[createVNode(w,{name:"add",size:"16px"}),b[0]||(b[0]=createBaseVNode("span",{class:"ml-[4px] text-center text-[13px] font-normal not-italic leading-[22px] text-[#333333]"},"添加",-1))])):createCommentVNode("",!0)])}}}),_hoisted_1$q={class:"gpt-option-group_table"},_hoisted_2$k={key:0,class:"flex items-center"},_hoisted_3$c={class:"handle cursor-all-scroll"},_hoisted_4$a={class:"ml-[32px]"},_hoisted_5$9=["onClick"],_sfc_main$H=defineComponent({__name:"option-group",props:{visible:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})}},emits:["close"],setup(e,{emit:t}){const a=e,o=t,n=ref([]),r=ref(null),s=ref(0),l={text:"",value:""},i=computed(()=>[{text:"",value:"sort"},{text:"选项",value:"text"},{text:"值",value:"value"},{text:"操作",value:"action"}]);onMounted(()=>{n.value=JSON.parse(JSON.stringify(a.formData.options||[l])),n.value.length||n.value.push({...l}),nextTick(()=>{const{option:v}=useSortable(r,n.value,{handle:".handle",onUpdate:x=>{const D=x.oldIndex,y=x.newIndex,b=JSON.parse(JSON.stringify(n.value)),w=b[D];b.splice(D,1),b.splice(y,0,w),n.value=JSON.parse(JSON.stringify(b)),s.value+=1}});v("animation",200)})});const u=()=>{let v="";if(n.value.some(x=>{if(n.value.filter(D=>D.value===x.value)?.length>1)return v="值",!0;if(n.value.filter(D=>D.text===x.text)?.length>1)return v="名称",!0}),v)return Message.warning(`选项${v}存在重复！`);a.formData.options=n.value,o("close")},g=()=>{o("close")},_=()=>{n.value.push({...l}),s.value+=1},m=v=>{if(n.value?.length<2)return Message.warning("至少保留一个选项");n.value.splice(v,1),s.value+=1};return(v,x)=>{const D=_sfc_main$U,y=Input,b=Modal;return openBlock(),createBlock(b,{visible:e.visible,simple:!0,maskClosable:!1,"title-align":"start","modal-style":{padding:"12px 20px 20px 20px"},width:600,"popup-container":".designer-app",onOk:u,onCancel:g},{title:withCtx(()=>x[0]||(x[0]=[createBaseVNode("div",{class:"flex flex-row justify-center"},[createBaseVNode("span",{class:"text-base font-semibold not-italic leading-[24px] text-[#333333]"},"定义备选项")],-1)])),default:withCtx(()=>[createBaseVNode("div",null,[createBaseVNode("div",{class:"float-right mb-[8px] flex cursor-pointer items-center",onClick:_},[createVNode(D,{name:"add",size:"16px"}),x[1]||(x[1]=createBaseVNode("span",{class:"ml-[4px]"},"新增",-1))]),createBaseVNode("table",_hoisted_1$q,[createBaseVNode("thead",null,[createBaseVNode("tr",null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.value,(w,E)=>(openBlock(),createElementBlock("th",{key:"col"+E},toDisplayString(w.text),1))),128))])]),createBaseVNode("tbody",{ref_key:"refSelector",ref:r},[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value||[],(w,E)=>(openBlock(),createElementBlock("tr",{key:"row"+s.value+E},[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.value,(V,N)=>(openBlock(),createElementBlock("td",{key:"col"+N},[V.value==="sort"?(openBlock(),createElementBlock("div",_hoisted_2$k,[createBaseVNode("span",_hoisted_3$c,[createVNode(D,{name:"drop",size:"16px"})]),createBaseVNode("span",_hoisted_4$a,toDisplayString(E+1),1)])):V.value==="action"?(openBlock(),createElementBlock("div",{key:1,class:"cursor-pointer",onClick:T=>m(E)},x[2]||(x[2]=[createBaseVNode("span",{class:"ml-[8px] text-[13px] text-[#266eff]"},"删除",-1)]),8,_hoisted_5$9)):(openBlock(),createBlock(y,{key:2,modelValue:w[V.value],"onUpdate:modelValue":T=>w[V.value]=T,placeholder:`请输入${V.text}`},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]))),128))]))),128))],512)])])]),_:1},8,["visible"])}}}),_hoisted_1$p={class:"flex w-[48px] cursor-pointer flex-row items-center"},_hoisted_2$j={class:"flex flex-col"},_sfc_main$G=defineComponent({__name:"output-params-toolbar",props:{enableGroup:{type:Boolean,default:!1}},emits:["add-row","add-group"],setup(e,{emit:t}){const a=t,o=()=>{a("add-row")},n=()=>{a("add-group")};return(r,s)=>{const l=_sfc_main$U,i=Button,u=Popover;return e.enableGroup?(openBlock(),createBlock(u,{key:0,"content-class":"skill-popover-content",position:"bottom","content-style":{padding:0},"arrow-style":{display:"none"},"popup-container":".designer-app"},{content:withCtx(()=>[createBaseVNode("div",_hoisted_2$j,[createVNode(i,{class:"skill-text-btn",type:"text",onClick:o},{default:withCtx(()=>s[1]||(s[1]=[createTextVNode("新增字段")])),_:1}),createVNode(i,{class:"skill-text-btn",type:"text",onClick:n},{default:withCtx(()=>s[2]||(s[2]=[createTextVNode("新增分组")])),_:1})])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_1$p,[createVNode(l,{name:"add",size:"16px"}),s[0]||(s[0]=createBaseVNode("span",{class:"ml-[4px] text-center text-[13px] font-normal not-italic leading-[22px] text-[#333333]"},"添加",-1))])]),_:1})):(openBlock(),createElementBlock("div",{key:1,class:"flex w-[48px] cursor-pointer flex-row items-center",onClick:o},[createVNode(l,{name:"add",size:"16px"}),s[3]||(s[3]=createBaseVNode("span",{class:"ml-[4px] text-center text-[13px] font-normal not-italic leading-[22px] text-[#333333]"},"添加",-1))]))}}}),_hoisted_1$o={class:"field-form_row w-[100%]"},_hoisted_2$i={key:0,class:"arco-form-item_group-line w-[100%]"},_hoisted_3$b=["onClick"],_hoisted_4$9={key:4,class:"field-form_btn"},_hoisted_5$8={key:0,class:"field-form_sub w-[100%]"},_sfc_main$F=defineComponent({__name:"output-params",props:{config:{type:Object,default:()=>[]},value:{type:Object,default:()=>[]},allowAdd:{type:Boolean,default:!0},allowDelete:{type:Boolean,default:!0},isSub:{type:Boolean,default:!1},level:{type:Number,default:0},isFillField:{type:Boolean,default:!1},defaultRow:{type:Object},parentNode:{type:Object},enableSort:{type:Boolean,default:!1},enableGroup:{type:Boolean,default:!1}},emits:["input"],setup(e,{emit:t}){const a=e,o=ref("array<object>"),n=t,r=useFlowStore();let s={};const l=ref(0),i=ref(!1),u=ref(-1);a.defaultRow?s=a.defaultRow:a.config.forEach(I=>{s[I.prop]=I.default});const g=computed(()=>{const I=JSON.parse(JSON.stringify(a.config));if(a.level>3){const R=I.find(Y=>Y.prop==="type");R&&R.options?.length&&(R.options=R.options.filter(Y=>Y.value!==o.value))}return I.filter(R=>!R.advancedconfig)}),_=computed(()=>a.config.filter(I=>I.advancedconfig)),m=computed(()=>!a.allowAdd&&!a.allowDelete),v=reactive({nodeParam:[]}),x=computed(()=>a.level>0?!0:v.nodeParam.some(I=>I.type===o.value)),D=computed(()=>{let I=0;return x.value&&(I+=24),`padding-left: ${I}px`});watch(()=>a.value,I=>{v.nodeParam=I},{immediate:!0});const y=()=>{v.nodeParam.push({...s}),l.value+=1,n("input",v.nodeParam)},b=()=>{v.nodeParam.push({...s,type:"group",control:"GroupLine",code:`group_${generateCode(6)}`}),l.value+=1,n("input",v.nodeParam)},w=I=>{v.nodeParam.splice(I,1),l.value+=1,n("input",v.nodeParam)},E=computed(()=>({name:[{required:!0,message:"请完善名称"}],code:[{required:!0,message:"请完善编码"},{validator:(I,R)=>{/^[A-Za-z_][A-Za-z0-9_]*$/.test(I)?v.nodeParam.filter(U=>U.code===I).length>1?R("编码不允许重复"):R():R("编码支持使用字母、数字和下划线")}}]})),V=computed(()=>a.config.some(({advancedconfig:I})=>!!I)),N=computed(()=>{let I=24;return x.value&&(I+=24),I}),T=computed(()=>`left: -${(a.level-1)*24+N.value+18}px;`),C=computed(()=>{if(!a.enableSort)return"";const R=(a.level-1)*24+N.value+18;return`margin-left: -${R}px; padding-left: ${R}px; width: calc(100% + ${R}px);`}),f=computed(()=>{let I=N.value;return V.value&&(I+=40),`width: calc(100% - ${I}px);`}),d=(I,R)=>{R.type===o.value?(R.schema||(R.schema=[]),R.collapse=!1):R.schema=[],R.options=[],R.thousands=R.control==="InputNumber"},h=I=>{I.schema.push({...s}),I.collapse=!1},k=I=>{if(I>0){const R=v.nodeParam?.[I-1];if(R?.collapse)return"display: none";let Y=R?.schema?.length||0;if(Y){const U=G=>{G.forEach(Z=>{const q=Z?.schema?.length||0;q&&!Z.collapse&&(Y+=q,U(Z.schema))})};U(R.schema)}if(Y)return`top: -${(Y+1)*43}px`}return"display: none"},S=(I,R)=>{if(!a.isFillField||R.value&&I.value?.content===R.value)return;const Y=I.type;for(const U in I)if(Object.prototype.hasOwnProperty.call(I,U)&&R[U]!==void 0)switch(U){case"type":I[U]=R[U]??"string";break;case"required":I[U]=!!R[U];break;case"schema":I.schema=[];break;default:I[U]=R[U];break}if(I.type!==Y&&!(I.control==="RadioGroup"&&["number","string"].includes(I.type)))switch(I.type){case"number":I.control="InputNumber",I.thousands=!0;break;case"date":I.control="DatePicker";break;case"array<object>":I.control="DataTable";break;default:I.control="Input"}},A=(I,R,Y)=>{R==="code"&&(I[R]=Y.trim())},O=()=>{if(a.level===0)return;const I=a.parentNode?.value?.content||"",[,R,Y]=I?.split("_")||[];if(R&&Y){const Z=(r.nodeMap[R]?.data?.outputs??[]).find(q=>q.code===Y);return[{name:"系统变量",code:"system",selectable:!1,iconName:"system",children:r.getSystemParamData(!0)},{name:a.parentNode?.name||"参数",label:a.parentNode?.name,code:"paramChild",value:"paramChild",selectable:!1,children:Z?.schema?.filter(q=>q.type!==o.value)?.map(q=>({...q,mapValue:`{{$${q.code}}}`,value:q.code,title:q.name,field:q.code,label:q.name}))||[]}]}return[]},z=(I,R,Y="string")=>{const U=a.config.find(G=>G.prop===R.prop);return typeof U.filterOptions=="function"?U.filterOptions(Y,a.level):I},M=I=>{i.value=!0,u.value=I},B=()=>{i.value=!1,u.value=-1},$=ref(null),{option:F}=useSortable($,v.nodeParam,{handle:".handle",onUpdate:I=>{const R=I.oldIndex,Y=I.newIndex,U=JSON.parse(JSON.stringify(v.nodeParam)),G=U[R];U.splice(R,1),U.splice(Y,0,G),v.nodeParam=JSON.parse(JSON.stringify(U)),n("input",v.nodeParam),nextTick(()=>{l.value+=1})},onMove:I=>!I.related.className.endsWith("disabled")});return F("animation",200),(I,R)=>{const Y=_sfc_main$U,U=Input,G=FormItem,Z=Option,q=Select,W=TreeSelect,K=Checkbox,X=Popover,Q=resolveComponent("output-params",!0),ee=Form,te=_sfc_main$H;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",{class:"field-form_box w-[100%] pb-[12px]",style:normalizeStyle(D.value)},[createVNode(ee,{class:"field-form form-custom field-form_params",model:v,style:{width:"100%"},layout:"inline",disabled:m.value,ref_key:"refSelector",ref:$},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(v.nodeParam,(L,j)=>(openBlock(),createElementBlock("div",{class:"inline-block w-full",style:normalizeStyle(C.value),key:"row_"+j+"_"+l.value},[createBaseVNode("div",_hoisted_1$o,[e.enableSort?(openBlock(),createElementBlock("span",{key:0,class:"handle absolute z-10 flex h-[32px] w-[18px] cursor-all-scroll items-center",style:normalizeStyle(T.value)},[createVNode(Y,{name:"drop"})],4)):createCommentVNode("",!0),e.isSub?(openBlock(),createElementBlock("span",{key:1,class:"field-form_row-line",style:normalizeStyle(k(j))},null,4)):createCommentVNode("",!0),L.type===o.value?(openBlock(),createBlock(Y,{key:2,class:normalizeClass(["field-form_row-collapse",{"-rotate-90 transform":L.collapse}]),onClick:P=>L.collapse=!L.collapse,name:"down",size:"16px"},null,8,["onClick","class"])):createCommentVNode("",!0),createBaseVNode("div",{class:normalizeClass(["field-form_row-inner float-left",{"field-form_full":!e.allowDelete}]),style:normalizeStyle(f.value)},[e.enableGroup&&L.control==="GroupLine"?(openBlock(),createElementBlock("div",_hoisted_2$i,[createVNode(G,{label:"字段分组",field:`nodeParam[${j}].control`,required:!0},{default:withCtx(()=>[createVNode(U,{modelValue:L.name,"onUpdate:modelValue":P=>L.name=P,placeholder:"请输入分组名称",disabled:m.value},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:2},1032,["field"])])):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(g.value,P=>(openBlock(),createElementBlock(Fragment,null,[!P.hide&&P.type==="input"?(openBlock(),createBlock(G,{key:0,field:`nodeParam[${j}][${P.prop}]`,rules:E.value[P.prop]||[],style:normalizeStyle({width:P.width})},{default:withCtx(()=>[createVNode(U,{modelValue:L[P.prop],"onUpdate:modelValue":H=>L[P.prop]=H,placeholder:P.placeholder,onChange:H=>A(L,P.prop,H)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["field","rules","style"])):createCommentVNode("",!0),!P.hide&&P.type==="select"?(openBlock(),createBlock(G,{key:1,field:`nodeParam[${j}][${P.prop}]`,disabled:!!P.disabled||m.value,style:normalizeStyle({width:P.width})},{default:withCtx(()=>[createVNode(q,{modelValue:L[P.prop],"onUpdate:modelValue":H=>L[P.prop]=H,placeholder:P.placeholder,onChange:H=>d(H,L)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(z(P.options,P,L?.type),(H,J)=>(openBlock(),createBlock(Z,{value:H.value,disabled:!!H.disabled,key:"option_"+J},{default:withCtx(()=>[createTextVNode(toDisplayString(H.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["field","disabled","style"])):createCommentVNode("",!0),!P.hide&&P.type==="treeSelect"?(openBlock(),createBlock(G,{key:2,field:`nodeParam[${j}][${P.prop}]`,style:normalizeStyle({width:P.width})},{default:withCtx(()=>[createVNode(W,{fieldNames:{key:"mapValue",title:"name",children:"children"},data:P.treeData,modelValue:L[P.prop],"onUpdate:modelValue":H=>L[P.prop]=H,placeholder:P.placeholder},null,8,["data","modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","style"])):createCommentVNode("",!0),P.type==="field-filling"?(openBlock(),createBlock(G,{key:3,field:`nodeParam[${j}][${P.prop}]`,style:normalizeStyle({width:P.width})},{default:withCtx(()=>[createVNode(_sfc_main$J,{value:L[P.prop],placeholder:P.placeholder||"请选择/输入参数值","input-disabled":P.inputDisabled,isCustom:e.level!==0,customParams:O(),onInput:H=>L[P.prop]=H,onFieldInfo:H=>S(L,H)},null,8,["value","placeholder","input-disabled","isCustom","customParams","onInput","onFieldInfo"])]),_:2},1032,["field","style"])):createCommentVNode("",!0),P.type==="form-field"?(openBlock(),createBlock(G,{key:4,field:`nodeParam[${j}][${P.prop}]`,style:normalizeStyle({width:P.width})},{default:withCtx(()=>[createVNode(_sfc_main$K,{value:L[P.prop],minHeight:"30px",mode:P.mode||"input",placeholder:P.placeholder||"请选择/输入参数值","input-disabled":P.inputDisabled,onInput:H=>L[P.prop]=H,onFieldInfo:H=>S(L,H),isCustom:e.level!==0,customParams:O()},null,8,["value","mode","placeholder","input-disabled","onInput","onFieldInfo","isCustom","customParams"])]),_:2},1032,["field","style"])):createCommentVNode("",!0)],64))),256))],6),V.value?(openBlock(),createBlock(X,{key:3,position:"br",trigger:"click","content-class":"skill-popover-content skill-advanced-config","popup-container":".designer-app"},{content:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(_.value,P=>(openBlock(),createElementBlock(Fragment,null,[P.type!=="option-group"?withDirectives((openBlock(),createBlock(G,{key:0,label:P.label,field:`nodeParam[${j}][${P.prop}]`},{default:withCtx(()=>[P.type==="checkbox"?(openBlock(),createBlock(K,{key:0,modelValue:L[P.prop],"onUpdate:modelValue":H=>L[P.prop]=H},null,8,["modelValue","onUpdate:modelValue"])):createCommentVNode("",!0),P.type==="select"?(openBlock(),createBlock(q,{key:1,modelValue:L[P.prop],"onUpdate:modelValue":H=>L[P.prop]=H,placeholder:P.placeholder,disabled:!!P.disabled},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(P.options,(H,J)=>(openBlock(),createBlock(Z,{value:H.value,disabled:!!H.disabled,key:"option_"+J},{default:withCtx(()=>[createTextVNode(toDisplayString(H.label),1)]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"])):createCommentVNode("",!0)]),_:2},1032,["label","field"])),[[vShow,P.prop!=="thousands"||L.control==="InputNumber"]]):createCommentVNode("",!0),P.type==="option-group"&&L.control==="RadioGroup"?(openBlock(),createBlock(G,{key:1,label:P.label,field:`nodeParam[${j}][${P.prop}]`},{default:withCtx(()=>[createBaseVNode("span",{class:"cursor-pointer pl-[5px]",onClick:H=>M(j)},[createVNode(Y,{name:"edit",size:"16px"})],8,_hoisted_3$b)]),_:2},1032,["label","field"])):createCommentVNode("",!0)],64))),256))]),default:withCtx(()=>[createBaseVNode("span",{class:normalizeClass(["field-form_btn-box skill-svg-hover_primary",{invisible:e.enableGroup&&L.control==="GroupLine"}])},[createVNode(Y,{name:"setting",size:"16px"})],2)]),_:2},1024)):createCommentVNode("",!0),x.value?(openBlock(),createElementBlock("span",_hoisted_4$9,[L.type===o.value&&e.allowAdd?(openBlock(),createBlock(Y,{key:0,name:"add-sublevel",size:"16px",onClick:P=>h(L)},null,8,["onClick"])):createCommentVNode("",!0)])):createCommentVNode("",!0),e.allowDelete?(openBlock(),createBlock(Y,{key:5,class:"field-form_btn",name:"minus",size:"16px",onClick:P=>w(j)},null,8,["onClick"])):createCommentVNode("",!0)]),L.type===o.value&&!L.collapse&&L?.schema?.length?(openBlock(),createElementBlock("div",_hoisted_5$8,[(openBlock(),createBlock(Q,{"is-sub":!0,key:"dynamicForms"+j,value:L.schema,config:e.config,allowAdd:e.allowAdd,"allow-delete":e.allowDelete,level:e.level+1,isFillField:e.isFillField,defaultRow:e.defaultRow,parentNode:L,"enable-sort":e.enableSort,onInput:P=>L.schema=P},null,8,["value","config","allowAdd","allow-delete","level","isFillField","defaultRow","parentNode","enable-sort","onInput"]))])):createCommentVNode("",!0)],4))),128))]),_:1},8,["model","disabled"]),e.allowAdd&&e.level===0?(openBlock(),createBlock(_sfc_main$G,{key:0,"enable-group":e.enableGroup,onAddRow:y,onAddGroup:b},null,8,["enable-group"])):createCommentVNode("",!0)],4),i.value?(openBlock(),createBlock(te,{key:0,visible:i.value,"form-data":v.nodeParam[u.value],onClose:B},null,8,["visible","form-data"])):createCommentVNode("",!0)],64)}}}),_hoisted_1$n={class:"w-full"},_hoisted_2$h={class:"ml-[4px]"},_sfc_main$E=defineComponent({__name:"ai-prompt",props:{formData:{type:Object,default:()=>({})}},setup(e){const t=e,a=ref([]),o=ref(0),n=[{prop:"name",placeholder:"请选择",width:"40%",type:"select",options:[],disabled:!0},{prop:"required",placeholder:"请选择",width:"20%",type:"select",options:[{label:"必填",value:!0},{label:"非必填",value:!1}],disabled:!0},{prop:"value",placeholder:"",width:"40%",type:"field-filling"}];let r=[];onMounted(()=>{r=t.formData.inputs||[]});const s=useFlowStore(),l=ref(n),i=ref(!1),u=ref([]),g=ref(!1),_=computed(()=>outputParamsConfig),m=computed(()=>u.value.find(d=>d.value===t.formData.templateId)),v=computed(()=>s.hidePrompt),x=computed(()=>{const d=[];return JSON.parse(JSON.stringify(t.formData.inputs)).forEach(h=>{d.push({...h,title:h.name,field:h.code,value:h.code})}),[{name:"参数",code:"param",selectable:!1,children:d}]}),D=ref(""),y=ref([]);watch(()=>m.value,d=>{if(!d)return;D.value=d?.promptTemplate||"",y.value=d?.messageContent||[];const h=[],k=[];if(d?.promptParam){d.promptParam.forEach(A=>{const O={name:A.paramName,code:A.paramCode,type:A.fieldType,description:A.describe,required:!!A.isRequired,schema:[]};A.paramType===1&&h.push({...O,value:r.find(z=>z.code===A.paramCode)?.value||{type:"literal",content:""}}),A.paramType===2&&(A.schema&&(O.schema=A.schema),k.push(O))});const S=A=>A.map(O=>({name:O.paramName,code:O.paramCode,type:O.fieldType,description:O.describe,required:!!O.isRequired,schema:O.schema?.length?S(O.schema):[]}));k.forEach(A=>{A.schema?.length&&(A.schema=S(A.schema))})}o.value=new Date().getTime(),t.formData.pattern=d.outputType==="content"?0:1,t.formData.inputs=h,t.formData.outputs=k}),onMounted(()=>{onQueryPrompt("").then(d=>{u.value=d.data.data.map(h=>({...h,label:`${h.promptName}（${h.promptCode}）`,value:h.promptGUID})),a.value=u.value})});const b=d=>{g.value=!0;let h={promptGUID:""};t.formData.templateId&&(h=a.value.find(k=>k.promptGUID===t.formData.templateId)),onQueryPrompt(d).then(k=>{let S=!1;a.value=k.data.data.map(A=>(A.promptGUID===h?.promptGUID&&(S=!0),{...A,label:`${A.promptName}（${A.promptCode}）`,value:A.promptGUID})),!S&&h?.promptGUID&&a.value.push(h),g.value=!1}).catch(()=>{a.value=[],g.value=!1})},w=()=>{const d=t.formData.templateId;if(!d)return;const h=getParams();window.open(`/std/42001201/08dc8b7c-8383-4e0e-8739-c28f29f61e9f?mode=2&autoTitle=true&_mp=crumbs&oid=${d}&_title=提示词&SpaceGUID=${h.space}`)},E=computed(()=>{const d={};return s.getParamsData().forEach(h=>{if(h.children){if(h.code==="system")return;h.children.forEach(({value:k,description:S,name:A,type:O})=>{d[k]={description:S,name:A,type:O,code:k}})}}),d}),V=computed(()=>{const d={};return s.getSystemParamData().forEach(h=>{d[h.value]=h}),d}),N=computed(()=>y.value.length>0?"系统提示词 #system":""),T=()=>{t.formData?.inputs?.length&&(i.value=!0,onMapping({source:Object.values(E.value),target:t.formData.inputs}).then(({data:d})=>{if(i.value=!1,typeof d?.data=="object"){const h={};d.data.forEach(S=>{h[S.code]=S?.value});const k=JSON.parse(JSON.stringify(t.formData.inputs));k.forEach(S=>{const O=h[S.code]?.content;O&&(E.value[O]||V.value[O])&&(S.value={type:"ref",content:O})}),t.formData.inputs=k,o.value=new Date().getTime()}}).catch(()=>{i.value=!1}))},C=(d,h)=>{let k="",S=0,A=0;return y.value.some((O,z)=>(O.role==="user"&&(S+=1),z+1===h?(A=S,!0):!1)),d==="user"&&(k=`用户提问_${A}`),d==="assistant"&&(k=A<1?"AI回复":`AI回复_${A}`),`${k} #${d}`},f=()=>{r=[]};return(d,h)=>{const k=Option,S=Select,A=FormItem,O=_sfc_main$U,z=Button,M=Popover,B=Radio,$=RadioGroup;return openBlock(),createElementBlock(Fragment,null,[createVNode(A,{label:"选择提示",field:"templateId",rules:[{required:!0,message:"请选择提示"}]},{default:withCtx(()=>[createVNode(S,{modelValue:e.formData.templateId,"onUpdate:modelValue":h[0]||(h[0]=F=>e.formData.templateId=F),"allow-search":!0,loading:g.value,placeholder:"请输入提示词名称、编码",onSearch:b,onChange:f,"filter-option":!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(a.value,F=>(openBlock(),createBlock(k,{value:F.promptGUID},{default:withCtx(()=>[createTextVNode(toDisplayString(F.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","loading"])]),_:1}),v.value?createCommentVNode("",!0):(openBlock(),createBlock(A,{key:0,label:"",field:"promptContent"},{default:withCtx(()=>[(openBlock(),createBlock(_sfc_main$K,{key:"editor_"+o.value,placeholder:" ",value:D.value,inputs:e.formData.inputs,disabled:!0,"is-custom":!0,"custom-params":x.value,title:N.value},{btn:withCtx(()=>[createBaseVNode("span",{onClick:w},[createVNode(O,{name:"edit",size:"16px",color:"#266EFF"}),h[3]||(h[3]=createTextVNode(" 编辑提示词 "))])]),_:1},8,["value","inputs","custom-params","title"]))]),_:1})),v.value?createCommentVNode("",!0):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(y.value,(F,I)=>(openBlock(),createBlock(A,{key:"message_"+I},{default:withCtx(()=>[(openBlock(),createBlock(_sfc_main$K,{key:"message_"+I+o.value,placeholder:" ",value:F.content,inputs:e.formData.inputs,disabled:!0,"is-custom":!0,"custom-params":x.value,title:C(F.role,I+1),"min-height":"40px"},{btn:withCtx(()=>h[4]||(h[4]=[])),_:2},1032,["value","inputs","custom-params","title"]))]),_:2},1024))),128)),e.formData.inputs?.length?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(A,{label:"输入参数",class:"form-item_title"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$n,[createVNode(M,{position:"top","content-style":{padding:"4px 12px 8px 12px"},"popup-container":".designer-app"},{content:withCtx(()=>h[6]||(h[6]=[createBaseVNode("div",{class:"w-[120px] text-[13px] leading-[22px] text-[#333333]"}," 通过提示模板参数，自动生成输入参数。 ",-1)])),default:withCtx(()=>[createVNode(z,{type:"primary",class:"float-right rounded-[4px]",loading:i.value,onClick:T},{default:withCtx(()=>[h[5]||(h[5]=createTextVNode(" 参数自动映射 ")),createBaseVNode("span",_hoisted_2$h,[createVNode(O,{name:"help",size:"16px",color:"white"})])]),_:1},8,["loading"])]),_:1})])]),_:1}),(openBlock(),createBlock(_sfc_main$I,{key:"field-form_"+o.value,value:e.formData.inputs,config:l.value,allowAdd:!1,allowDelete:!1},null,8,["value","config"]))],64)):createCommentVNode("",!0),createVNode(A,{label:"输出参数",class:"form-item_title"}),createVNode(A,{field:"pattern",label:"参数格式"},{default:withCtx(()=>[createVNode($,{modelValue:e.formData.pattern,"onUpdate:modelValue":h[1]||(h[1]=F=>e.formData.pattern=F),disabled:!0},{default:withCtx(()=>[createVNode(B,{value:0},{default:withCtx(()=>h[7]||(h[7]=[createTextVNode("纯文本")])),_:1}),createVNode(B,{value:1},{default:withCtx(()=>h[8]||(h[8]=[createTextVNode("参数列表")])),_:1})]),_:1},8,["modelValue"])]),_:1}),createVNode(_sfc_main$F,{"allow-add":!1,"allow-delete":!1,value:e.formData.outputs,config:_.value,onInput:h[2]||(h[2]=F=>e.formData.outputs=F)},null,8,["value","config"])],64)}}}),onGetAllMyApplications=()=>axios.request({url:"/api/42000301/skill/GetAllMyApplications",method:"POST"}),GetFunctionControlsByAppCode=({appCode:e,keyword:t})=>axios.request({url:"/api/42000301/skill/GetFunctionControlsByAppCode",method:"POST",data:{appCode:e,keyword:t}}),GetFunctionControlFieldsById=({id:e})=>axios.request({url:`/api/42000301/skill/GetFunctionControlFieldsById?id=${e}`,method:"POST"}),_sfc_main$D=defineComponent({__name:"auxiliary-input-form",props:{formData:{type:Object,default:()=>({})}},setup(e){const t=e,a=ref(!1),o=ref([]),n=ref(0),r=computed(()=>{let b=!1;const w=o.value.map(E=>(E.id===_?.value?.value&&(b=!0),{...E,label:`${E.myFunction?.name}/${E.functionPage?.name}/${E.name}`,value:E.id}));return b||w.push(_.value),w}),s=ref([]),l=ref([]),i=computed(()=>[{prop:"code",placeholder:"请选择",width:"50%",type:"select",options:[],default:"",disabled:!1},{prop:"value",placeholder:"",width:"50%",type:"field-filling"}]),u=computed(()=>({code:"",required:!0,value:{type:"literal",content:""}}));onMounted(()=>{g(),t.formData.formId&&(m(),x())});const g=()=>{onGetAllMyApplications().then(({data:b})=>{s.value=b?.data||[]}).catch(()=>{s.value=[]})},_=ref({}),m=(b="")=>{a.value=!0,t.formData.formId?_.value=r.value.find(w=>w.value===t.formData.formId)||{}:_.value={},GetFunctionControlsByAppCode({appCode:t.formData.appCode,keyword:b||t.formData.formId||""}).then(({data:w})=>{o.value=w?.data||[],a.value=!1}).catch(()=>{o.value=[],a.value=!1})},v=()=>{const b=JSON.parse(JSON.stringify(l.value)),w=t.formData.inputs?.map(E=>E.code);i.value[0].options=b.map(E=>({...E,disabled:w?.includes(E.value)}))},x=(b=!1)=>{GetFunctionControlFieldsById({id:t.formData.formId}).then(({data:w})=>{const E=w?.data||[],V=[],N=E.map(T=>(V.push({label:`${T.field}（${T.title}）`,value:T.field}),{code:T.field,label:T.title,type:T.controlName,required:!0,value:{type:"literal",content:""}}));l.value=V,b?(t.formData.inputs=N,n.value=Date.now()):v()}).catch(()=>{t.formData.inputs=[]})};watch(()=>t.formData.inputs,()=>{nextTick(()=>{v()})},{deep:!0});const D=()=>{x(!0)},y=()=>{t.formData.formId="",t.formData.inputs=[],m("")};return(b,w)=>{const E=Option,V=Select,N=FormItem;return openBlock(),createElementBlock(Fragment,null,[createVNode(N,{field:"appCode",label:"子系统",required:!0},{default:withCtx(()=>[createVNode(V,{modelValue:e.formData.appCode,"onUpdate:modelValue":w[0]||(w[0]=T=>e.formData.appCode=T),placeholder:"请选择子系统",onChange:y},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.value,(T,C)=>(openBlock(),createBlock(E,{value:T.application,key:"option_"+C},{default:withCtx(()=>[createTextVNode(toDisplayString(T.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(N,{field:"formId",label:"表单控件",required:!0},{help:withCtx(()=>w[3]||(w[3]=[createBaseVNode("div",null,"请输入“建模表单控件名称”查询，或直接输入元数据 ID",-1)])),default:withCtx(()=>[createVNode(V,{modelValue:e.formData.formId,"onUpdate:modelValue":w[1]||(w[1]=T=>e.formData.formId=T),placeholder:"请选表单控件","allow-search":!0,loading:a.value,onSearch:m,onChange:D,"filter-option":!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.value,(T,C)=>(openBlock(),createBlock(E,{value:T.value,key:"option_"+C},{default:withCtx(()=>[createTextVNode(toDisplayString(T.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),createVNode(N,{field:"inputs",class:"form-item_no-pb",label:"录入字段",required:!0},{help:withCtx(()=>w[4]||(w[4]=[createBaseVNode("div",null,"支持单行、多行文本、下拉选择、日期、金额类字段",-1)])),default:withCtx(()=>[(openBlock(),createBlock(_sfc_main$I,{key:n.value+"_inputs",value:e.formData.inputs,config:i.value,"default-row":u.value,"enable-sort":!0,onInput:w[2]||(w[2]=T=>e.formData.inputs=T)},null,8,["value","config","default-row"]))]),_:1})],64)}}}),_sfc_main$C=defineComponent({__name:"card-form",props:{label:{default:""},config:{default:()=>[]},formData:{default:()=>({})}},emits:["input"],setup(e,{emit:t}){const a=e,o=t,n=useFlowStore(),r=ref({}),s=computed(()=>n.getParamsData()),l=computed(()=>(a.config[0].treeData=s.value,a.config)),i=computed(()=>{const u={};return s.value.forEach(g=>{g.children&&g.children.forEach(_=>{_.title=_.name,u[_.mapValue]=_})}),u});return watch(()=>a.formData,()=>{r.value=a.formData||{},r.value?.layout||(r.value.layout=[])},{immediate:!0}),watch(()=>r.value,()=>{o("input",r.value)}),watch(()=>r.value.layout,u=>{u.forEach(g=>{const _=i.value[g.code];_&&(g.name=_.name)})}),(u,g)=>{const _=FormItem;return openBlock(),createElementBlock(Fragment,null,[createVNode(_,{label:u.label,style:{width:"100%"}},null,8,["label"]),createVNode(_sfc_main$I,{value:r.value.layout,config:l.value,onInput:g[0]||(g[0]=m=>r.value.layout=m)},null,8,["value","config"])],64)}}}),_sfc_main$B=defineComponent({__name:"document-analysis-config",props:{formData:{}},setup(e){const t=e,a=computed(()=>[{label:"所有页",value:"all"},{label:"指定页",value:"range"}]),o=ref({1:1,2:"默认",10:10}),n=()=>{const r=t.formData.usePageRange==="range";t.formData.useFirstFewPages=r?2:0,t.formData.useLastFewPages=r?2:0};return(r,s)=>{const l=Checkbox,i=FormItem,u=Radio,g=RadioGroup,_=Slider;return openBlock(),createElementBlock(Fragment,null,[createVNode(i,{field:"useTOC",label:"解析目录"},{default:withCtx(()=>[createVNode(l,{modelValue:r.formData.useTOC,"onUpdate:modelValue":s[0]||(s[0]=m=>r.formData.useTOC=m)},null,8,["modelValue"])]),_:1}),createVNode(i,{field:"imagConverter",label:"全文图片转换"},{help:withCtx(()=>s[7]||(s[7]=[createBaseVNode("div",null,[createTextVNode(" 整个文档内容转换为图片后使用视觉识别服务，要求对应文档不大于"),createBaseVNode("b",null," 10 "),createTextVNode("页。 ")],-1)])),default:withCtx(()=>[createVNode(l,{modelValue:r.formData.imagConverter,"onUpdate:modelValue":s[1]||(s[1]=m=>r.formData.imagConverter=m)},null,8,["modelValue"])]),_:1}),createVNode(i,{field:"usePageRange",label:"解析范围"},{default:withCtx(()=>[createVNode(g,{modelValue:r.formData.usePageRange,"onUpdate:modelValue":s[2]||(s[2]=m=>r.formData.usePageRange=m),"default-value":"all",onChange:n},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(a.value,m=>(openBlock(),createBlock(u,{value:m.value,key:m.value},{default:withCtx(()=>[createTextVNode(toDisplayString(m.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r.formData.usePageRange==="range"?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(i,{field:"useFirstFewPages",class:"knowledge_slider",label:"解析前几页"},{default:withCtx(()=>[createVNode(_,{"default-value":2,modelValue:r.formData.useFirstFewPages,"onUpdate:modelValue":s[3]||(s[3]=m=>r.formData.useFirstFewPages=m),onInput:s[4]||(s[4]=m=>r.formData.useFirstFewPages=m),min:1,max:10,step:1,marks:o.value},null,8,["modelValue","marks"])]),_:1}),createVNode(i,{field:"useLastFewPages",class:"knowledge_slider",label:"解析后几页"},{default:withCtx(()=>[createVNode(_,{"default-value":2,modelValue:r.formData.useLastFewPages,"onUpdate:modelValue":s[5]||(s[5]=m=>r.formData.useLastFewPages=m),onInput:s[6]||(s[6]=m=>r.formData.useLastFewPages=m),min:1,max:10,step:1,marks:o.value},null,8,["modelValue","marks"])]),_:1})],64)):createCommentVNode("",!0)],64)}}}),_hoisted_1$m={key:1,class:"ml-[20px] inline-block w-[calc(100%_-_20px)]"},_sfc_main$A=defineComponent({__name:"document-analysis-form",props:{formData:{type:Object,default:()=>{}},contentData:{type:Object,default:()=>[{name:"文档内容",code:"content",type:"markdown"}]},type:{type:String,default:"document"}},setup(e){const t=e,a=computed(()=>[{title:"名称",dataIndex:"name"},{title:"ID",dataIndex:"code"},{title:"类型",dataIndex:"type"}]),o=computed(()=>t.contentData||[]),n=computed(()=>outputParamsConfig),r=computed(()=>t.type==="image"?"文本读取":"文档读取");onMounted(()=>{t.formData.pattern===0&&(t.formData.outputs=o.value)});const s=l=>{l===0&&(t.formData.outputs=o.value),l===1&&(t.formData.outputs=[{name:"",code:"",type:"string",description:""}])};return(l,i)=>{const u=Radio,g=RadioGroup,_=FormItem,m=Table;return openBlock(),createElementBlock(Fragment,null,[createVNode(_,{field:"pattern",label:"分析模式"},{default:withCtx(()=>[createVNode(g,{modelValue:e.formData.pattern,"onUpdate:modelValue":i[0]||(i[0]=v=>e.formData.pattern=v),onChange:s},{default:withCtx(()=>[createVNode(u,{value:0},{default:withCtx(()=>[createTextVNode(toDisplayString(r.value),1)]),_:1}),createVNode(u,{value:1},{default:withCtx(()=>i[2]||(i[2]=[createTextVNode("信息提取")])),_:1})]),_:1},8,["modelValue"])]),_:1}),createVNode(_,{label:"输出参数",class:"form-item_title"}),e.formData.pattern===0?(openBlock(),createBlock(m,{key:0,pagination:!1,class:"custom-grid",columns:a.value,data:o.value},null,8,["columns","data"])):createCommentVNode("",!0),e.formData.pattern===1?(openBlock(),createElementBlock("div",_hoisted_1$m,[createVNode(_sfc_main$F,{value:e.formData.outputs,config:n.value,"enable-sort":!0,onInput:i[1]||(i[1]=v=>e.formData.outputs=v)},null,8,["value","config"])])):createCommentVNode("",!0)],64)}}}),_hoisted_1$l={class:"ml-[20px] inline-block w-[calc(100%_-_20px)]"},_hoisted_2$g=["innerHTML"],_sfc_main$z=defineComponent({__name:"editor-form",props:{cardConfig:{type:Array,default:()=>[]},data:{type:Array,default:()=>{}},outputs:{type:Array,default:()=>{}}},emits:["input","outputs"],setup(e,{emit:t}){const a=t,o=e,n=ref([]),r=ref(0),s=computed(()=>[{label:"单行文本",value:"Input",supportType:["string","number"]},{label:"多行文本",value:"Textarea",supportType:["string"]},{label:"数字",value:"InputNumber",supportType:["number","string"]},{label:"日期",value:"DatePicker",supportType:["date","string"]},{label:"单选",value:"RadioGroup",supportType:["string","number"]},{label:"子列表",value:"DataTable",supportType:["array<object>"]},{label:"子表单",value:"DataForm",supportType:["array<object>"]}]),l=computed(()=>[{prop:"value",placeholder:"请选择/输入参数值",width:"30%",type:"field-filling",inputDisabled:!1},{prop:"name",placeholder:"选择字段后自动填入名称",width:"25%",type:"input",default:""},{prop:"code",placeholder:"选择字段后自动填入编码",width:"25%",type:"input",default:""},{prop:"control",placeholder:"请选择",width:"20%",type:"select",options:s.value,default:"string",filterOptions:(m,v)=>s.value.filter(x=>v>0&&x.value==="RadioGroup"?!1:x.supportType.includes(m))},{label:"字段类型",prop:"type",placeholder:"请选择",type:"select",options:FIELD_OBJECT_OPTIONS,disabled:!0,default:!1,advancedconfig:!0},{label:"是否必填",prop:"required",placeholder:"请选择",type:"checkbox",default:!0,advancedconfig:!0},{label:"是否只读",prop:"readonly",placeholder:"请选择",type:"checkbox",default:!1,advancedconfig:!0},{label:"使用千分位",prop:"thousands",placeholder:"请选择",type:"checkbox",default:!0,advancedconfig:!0},{label:"定义备选项",prop:"options",type:"option-group",default:[],advancedconfig:!0}]),i=computed(()=>[{prop:"code",placeholder:"选择字段后自动填入编码",width:"30%",type:"input",default:""},{prop:"name",placeholder:"选择字段后自动填入名称",width:"30%",type:"input",default:""},{prop:"value",placeholder:"请选择/输入参数值",width:"40%",type:"field-filling"}]);onMounted(()=>{n.value=JSON.parse(JSON.stringify(o.cardConfig));const m={};n.value?.forEach(y=>{if(y.defaultValue?m[y.name]=y.defaultValue:m[y.name]="",y.events){const b=typeof o.data?.[y.name]>"u";u("change",b?y.defaultValue:o.data[y.name],y)}});const v={...m,...o.data,hiddenFields:[]};for(const y in v)o.data[y]=v[y];const D=(o.data?.columns||[])?.map(y=>y.code)||[];o.data.hiddenFields=o.outputs?.filter(({code:y})=>!D.includes(y))}),watch(()=>[o.data?.columns,o.data?.hiddenFields],()=>{if(!o.data?.columns)return;const m=JSON.parse(JSON.stringify(o.data));delete m.hiddenFields;const v=m?.columns?.map(({name:x,code:D,value:y,required:b,type:w,schema:E})=>{const V=E?.map(N=>({name:N.name,code:N.code,value:N.value,required:N.required,type:N.type}))||[];return{name:x,code:D,value:y,required:b,type:w,schema:V}})||[];a("outputs",[...v,...o.data?.hiddenFields||[]]),r.value=new Date().getTime()},{deep:!0});const u=(m,v,x)=>{if(x.events){const D=x.events.find(y=>y.name===m);if(D&&D.type==="script"){const y={};n.value?.forEach(w=>{y[w.name]=w}),new Function("value","formData","config",D.callback)(v,o.data,y)}}},g=computed(()=>({code:"",value:{type:"literal",content:""},type:"string",required:!1,schema:[],control:"Input",name:"",readonly:!1,options:[],thousands:!1})),_=computed(()=>({code:"",value:{type:"literal",content:""},type:"string",required:!0,name:"",description:""}));return(m,v)=>{const x=FormItem,D=Input,y=InputNumber,b=Checkbox,w=Switch,E=Slider,V=Option,N=Select,T=Radio,C=RadioGroup,f=Form;return openBlock(),createBlock(f,{model:e.data,"label-align":"left"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(d,h)=>(openBlock(),createElementBlock(Fragment,null,[d?.editor?.type==="Fields"?(openBlock(),createElementBlock(Fragment,{key:0},[d?.name==="hiddenFields"?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(x,{label:"隐藏字段",class:"form-item_title"}),createVNode(_sfc_main$I,{value:e.data.hiddenFields,config:i.value,isFillField:!0,defaultRow:_.value,"enable-sort":!0,onInput:v[0]||(v[0]=k=>e.data.hiddenFields=k)},null,8,["value","config","defaultRow"])],64)):(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(x,{label:"表单字段",class:"form-item_title"}),createBaseVNode("div",_hoisted_1$l,[createVNode(_sfc_main$F,{value:e.data.columns,config:l.value,isFillField:!0,defaultRow:g.value,"enable-sort":!0,"enable-group":!0,onInput:v[1]||(v[1]=k=>e.data.columns=k)},null,8,["value","config","defaultRow"])])],64))],64)):withDirectives((openBlock(),createBlock(x,{field:d.name,label:d.label,required:!!d.required,rules:d.rules||[],tooltip:d.tooltip||"",disabled:!!d.disabled,validateTrigger:d.validateTrigger||"change",hideLabel:!!d.hideLabel,key:"item_"+h},createSlots({default:withCtx(()=>[d.editor&&d.editor.type==="Input"?(openBlock(),createBlock(D,mergeProps({key:0,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k,"default-value":d.defaultValue||"",placeholder:d.editor?.placeholder||""}),null,16,["modelValue","onUpdate:modelValue","default-value","placeholder"])):createCommentVNode("",!0),d.editor&&d.editor.type==="InputNumber"?(openBlock(),createBlock(y,mergeProps({key:1,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k,placeholder:d.editor?.placeholder||""}),null,16,["modelValue","onUpdate:modelValue","placeholder"])):createCommentVNode("",!0),d.editor&&d.editor.type==="Checkbox"?(openBlock(),createBlock(b,mergeProps({key:2,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k,"default-value":d.defaultValue||!1,onChange:k=>u("change",k,d)}),{default:withCtx(()=>[createTextVNode(toDisplayString(d.editor?.placeholder||""),1)]),_:2},1040,["modelValue","onUpdate:modelValue","default-value","onChange"])):createCommentVNode("",!0),d.editor&&d.editor.type==="Switch"?(openBlock(),createBlock(w,mergeProps({key:3,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k,"default-value":d.defaultValue||!1}),{default:withCtx(()=>[createTextVNode(toDisplayString(d.editor?.placeholder||""),1)]),_:2},1040,["modelValue","onUpdate:modelValue","default-value"])):createCommentVNode("",!0),d.editor&&d.editor.type==="Slider"?(openBlock(),createBlock(E,mergeProps({key:4,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k}),null,16,["modelValue","onUpdate:modelValue"])):createCommentVNode("",!0),d.editor&&d.editor.type==="Select"?(openBlock(),createBlock(N,mergeProps({key:5,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k,placeholder:d.editor?.placeholder||"","default-value":d.defaultValue||"",options:[]}),{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.editor?.props?.options||[],k=>(openBlock(),createElementBlock(Fragment,null,[k.hide?createCommentVNode("",!0):(openBlock(),createBlock(V,{key:0,value:k.value,disabled:k.disabled},{default:withCtx(()=>[createTextVNode(toDisplayString(k.text),1)]),_:2},1032,["value","disabled"]))],64))),256))]),_:2},1040,["modelValue","onUpdate:modelValue","placeholder","default-value"])):createCommentVNode("",!0),d.editor&&d.editor.type==="Radio"?(openBlock(),createBlock(C,mergeProps({key:6,ref_for:!0},d.editor.props,{modelValue:e.data[d.name],"onUpdate:modelValue":k=>e.data[d.name]=k,placeholder:d.editor?.placeholder||"","default-value":d.defaultValue||"",options:[]}),{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.editor?.props?.options||[],k=>(openBlock(),createElementBlock(Fragment,null,[k.hide?createCommentVNode("",!0):(openBlock(),createBlock(T,{key:0,value:k.value,disabled:k.disabled},{default:withCtx(()=>[createTextVNode(toDisplayString(k.text),1)]),_:2},1032,["value","disabled"]))],64))),256))]),_:2},1040,["modelValue","onUpdate:modelValue","placeholder","default-value"])):createCommentVNode("",!0),d.editor&&d.editor.type==="Template"?(openBlock(),createBlock(_sfc_main$K,{key:r.value,value:e.data[d.name],minHeight:d.editor.props?.minHeight||"30px",placeholder:d.editor.placeholder||"",onInput:k=>e.data[d.name]=k},null,8,["value","minHeight","placeholder","onInput"])):createCommentVNode("",!0),d.editor&&d.editor.type==="field-filling"?(openBlock(),createBlock(_sfc_main$J,{key:8,value:e.data[d.name],placeholder:d.placeholder||"请选择/输入参数值","input-disabled":d.inputDisabled,onInput:k=>e.data[d.name]=k},null,8,["value","placeholder","input-disabled","onInput"])):createCommentVNode("",!0)]),_:2},[d.extra?{name:"extra",fn:withCtx(()=>[createBaseVNode("span",{innerHTML:d.extra},null,8,_hoisted_2$g)]),key:"0"}:void 0]),1032,["field","label","required","rules","tooltip","disabled","validateTrigger","hideLabel"])),[[vShow,!d.hide]])],64))),256))]),_:1},8,["model"])}}}),_sfc_main$y=defineComponent({__name:"file-type",props:{formData:{type:Object,default:()=>({})},showTips:{type:Boolean,default:!1},support:{type:Array},disabled:{type:Boolean,default:!1}},setup(e){const t=e,a=ref([]),o=ref(""),n=computed(()=>[{label:"Word文档 (doc, docx)",value:"doc,docx"},{label:"PDF文件 (pdf)",value:"pdf"},{label:"Excel文档 (xls, xlsx)",value:"xls,xlsx"},{label:"PowerPoint文档 (ppt, pptx)",value:"ppt,pptx"},{label:"文本文件 (txt)",value:"txt"},{label:"图片文件 (jpg, jpeg, bmp, gif, png, tif, webp)",value:"jpg,jpeg,bmp,gif,png,tif,webp"},{label:"视频文件 (avi, mpg, mpeg, mov, wav, ram, mp3, mp4 )",value:"avi,mpg,mpeg,mov,wav,ram,mp3,mp4"},{label:"自定义",value:"custom"}]);onMounted(()=>{let i=t.formData.uploadables||"";n.value.forEach(u=>{i.indexOf(u.value)>-1&&(a.value.push(u.value),i=i.replace(u.value,""))}),o.value=i.split(",").filter(u=>!!u).join(","),o.value&&a.value.push("custom")});const r=computed(()=>a.value.includes("custom"));watch(()=>r.value,i=>{i||(o.value="",t.formData.customFile="")}),watch(()=>[o.value,a.value],()=>{const i=JSON.parse(JSON.stringify(a.value));r.value&&i.splice(i.indexOf("custom"),1),t.formData.uploadables=[...i,o.value].filter(u=>!!u).join(",")});const s=computed(()=>[{required:!0,message:"请完善自定义文件类型"},{validator:(i,u)=>{i.replace(/\s+/g,"").replace(/;/g,",").split(",").some(m=>m?!/^\w+$/.test(m):!1)?u("自定义文件类型格式不正确"):u()}}]),l=computed(()=>t.support?.length?n.value.filter(i=>t.support?.some(u=>u===i.value)):n.value);return(i,u)=>{const g=_sfc_main$U,_=Alert,m=Checkbox,v=CheckboxGroup,x=FormItem,D=Textarea;return openBlock(),createElementBlock(Fragment,null,[e.showTips?(openBlock(),createBlock(_,{key:0,type:"normal",class:"alert-normal"},{default:withCtx(()=>[createVNode(g,{name:"tips",size:"14px"}),u[2]||(u[2]=createTextVNode(" word、pdf、txt 文件已支持文档分析，其他类型文档可通过插件自定义分析文档。 "))]),_:1})):createCommentVNode("",!0),createVNode(x,{label:"可传文件类型",disabled:e.disabled},{default:withCtx(()=>[createVNode(v,{direction:"vertical",modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=y=>a.value=y)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.value,(y,b)=>(openBlock(),createBlock(m,{key:"file_"+b,value:y.value},{default:withCtx(()=>[createTextVNode(toDisplayString(y.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["disabled"]),r.value?(openBlock(),createBlock(x,{key:1,rules:s.value,class:"custom-file",label:"",disabled:e.disabled},{default:withCtx(()=>[createVNode(D,{modelValue:o.value,"onUpdate:modelValue":u[1]||(u[1]=y=>o.value=y),style:{"min-height":"84px"},placeholder:"请输入文件扩展名，多个请用逗号分隔，如：xml, mp3","auto-size":""},null,8,["modelValue"])]),_:1},8,["rules","disabled"])):createCommentVNode("",!0)],64)}}}),_hoisted_1$k={class:"flex items-center"},_hoisted_2$f={key:0,class:"agent-group_content"},_sfc_main$x=defineComponent({__name:"group-designer",props:{title:{type:String}},emits:["add"],setup(e,{expose:t,emit:a}){const o=a,n=ref(!0),r=()=>{n.value=!n.value},s=()=>{o("add")};return t({toggle:i=>{n.value=i}}),(i,u)=>{const g=_sfc_main$U;return openBlock(),createElementBlock("div",{class:normalizeClass(["agent-group border-bottom:#EAEAEA mt-[12px] border-b",{"agent-group_collapse":!n.value}])},[createBaseVNode("div",{class:"mb-[12px] flex h-[32px] cursor-pointer items-center justify-between px-[4px] py-[5px]",onClick:r},[createBaseVNode("span",_hoisted_1$k,[createVNode(g,{name:"down-line",size:"16px",class:"agent-group_toggle-bar mr-[8px]"}),createTextVNode(" "+toDisplayString(e.title),1)]),i.$slots.btn?renderSlot(i.$slots,"btn",{key:0}):(openBlock(),createElementBlock("span",{key:1,onClick:withModifiers(s,["stop"])},[createVNode(g,{name:"add-bg",size:"20px"})]))]),createVNode(Transition,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-screen","leave-active-class":"transition-all duration-300 ease-in","leave-from-class":"opacity-100 max-h-screen","leave-to-class":"opacity-0 max-h-0"},{default:withCtx(()=>[n.value?(openBlock(),createElementBlock("div",_hoisted_2$f,[renderSlot(i.$slots,"content")])):createCommentVNode("",!0)]),_:3})],2)}}}),_sfc_main$w=defineComponent({__name:"upload-params",props:{data:{},title:{},supportFiles:{},showTips:{type:Boolean}},setup(e){const t=useTemplateRef("groupDesigner"),a=()=>{e.data.useFileUpload&&t.value?.toggle(!0)};onMounted(()=>{e.data.maxUploadNumber===void 0&&(e.data.maxUploadNumber=1)});const o=()=>{e.data.maxUploadNumber||(e.data.maxUploadNumber=1)};return(n,r)=>{const s=Switch,l=Checkbox,i=FormItem,u=InputNumber;return openBlock(),createBlock(_sfc_main$x,{title:n.title,onAdd:r[3]||(r[3]=()=>{}),ref:"groupDesigner"},{btn:withCtx(()=>[createVNode(s,{modelValue:n.data.useFileUpload,"onUpdate:modelValue":r[0]||(r[0]=g=>n.data.useFileUpload=g),"default-value":!1,size:"small",onClick:withModifiers(a,["stop"])},null,8,["modelValue"])]),content:withCtx(()=>[createVNode(i,{label:"移动端上传",disabled:!n.data.useFileUpload},{default:withCtx(()=>[createVNode(l,{modelValue:n.data.useQRCodeUpload,"onUpdate:modelValue":r[1]||(r[1]=g=>n.data.useQRCodeUpload=g)},null,8,["modelValue"])]),_:1},8,["disabled"]),createVNode(_sfc_main$y,{"form-data":n.data,support:n.supportFiles,"show-tips":n.showTips,disabled:!n.data.useFileUpload},null,8,["form-data","support","show-tips","disabled"]),createVNode(i,{label:"允许上传文件数",disabled:!n.data.useFileUpload,required:n.data.useFileUpload},{default:withCtx(()=>[createVNode(u,{modelValue:n.data.maxUploadNumber,"onUpdate:modelValue":r[2]||(r[2]=g=>n.data.maxUploadNumber=g),placeholder:"请输入文件数量",precision:0,min:1,max:10,"model-event":"input",onBlur:o},null,8,["modelValue"])]),_:1},8,["disabled","required"])]),_:1},8,["title"])}}}),_sfc_main$v=defineComponent({__name:"image-analysis",props:{formData:{type:Object,default:()=>({})}},setup(e){const t=e,a=computed(()=>t.formData.recognizeType==="ocr"),o=computed(()=>[{name:"文本内容",code:"content",type:"string"}]);return(n,r)=>(openBlock(),createElementBlock(Fragment,null,[a.value?createCommentVNode("",!0):(openBlock(),createBlock(_sfc_main$E,{key:0,"form-data":e.formData},null,8,["form-data"])),a.value?(openBlock(),createBlock(_sfc_main$A,{key:1,"form-data":e.formData,"content-data":o.value,type:"image"},null,8,["form-data","content-data"])):createCommentVNode("",!0)],64))}}),getOcrServiceList=e=>axios.request({url:"/api/42000301/skill/modelInstallQuery",method:"POST",data:{serviceType:"2",modelInstanceCode:e,modelInstanceName:e}}),_sfc_main$u=defineComponent({__name:"image-recognize",props:{config:{type:Object,default:()=>[]},formData:{type:Object,default:()=>({})}},setup(e){const t=e,a=useConfigStore(),o=ref(!1),n=ref([]),r=computed(()=>t.config[0].prop),s=g=>{o.value=!0;let _=null;t.formData.ocrService&&(_=n.value.find(m=>m.value===t.formData.ocrService)),getOcrServiceList(g).then(({data:m})=>{let v=!1;n.value=m?.data?.map(x=>(x?.modelInstanceCode===_?.value&&(v=!0),{value:x.modelInstanceCode,label:x.modelInstanceName}))||[],!v&&_?.value&&n.value.push(_),o.value=!1}).catch(()=>{o.value=!1,n.value=[]})},l=computed(()=>t.formData.type===CARD_TYPE.IMAGE_ANALYSIS),i=g=>{g!=="ocr"&&(t.formData.ocrService=""),l.value&&(t.formData.templateId="",t.formData.inputs=[],t.formData.outputs=[]),u()};onMounted(()=>{s(""),u()});const u=()=>{const g=a.configData.find(_=>_.prop==="asMessage")||{};g&&(g.hide=t.formData.recognizeType==="ocr"),g.hide&&(t.formData.asMessage=!1)};return(g,_)=>{const m=Radio,v=RadioGroup,x=FormItem,D=Option,y=Select;return openBlock(),createElementBlock(Fragment,null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config,b=>(openBlock(),createBlock(x,{field:b.prop,label:b.label},{default:withCtx(()=>[createVNode(v,{modelValue:e.formData[b.prop],"onUpdate:modelValue":w=>e.formData[b.prop]=w,onChange:i},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(b.options,w=>(openBlock(),createBlock(m,{value:w.value,key:w.value},{default:withCtx(()=>[createTextVNode(toDisplayString(w.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","label"]))),256)),e.formData[r.value]==="ocr"?(openBlock(),createBlock(x,{key:0,label:"视觉识别服务",field:"ocrService",rules:[{required:!0,message:"请选择视觉识别服务"}]},{default:withCtx(()=>[createVNode(y,{modelValue:e.formData.ocrService,"onUpdate:modelValue":_[0]||(_[0]=b=>e.formData.ocrService=b),"allow-search":!0,loading:o.value,placeholder:"请输入",onSearch:s,"filter-option":!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,b=>(openBlock(),createBlock(D,{value:b.value},{default:withCtx(()=>[createTextVNode(toDisplayString(b.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","loading"])]),_:1})):createCommentVNode("",!0)],64)}}}),_hoisted_1$j={class:"field-form_box intention-config w-[100%] pb-[12px]"},_hoisted_2$e={class:"flex h-[28px] w-[20px] items-center"},_hoisted_3$a={class:"intention-id"},_sfc_main$t=defineComponent({__name:"intention",props:{value:{type:Object,default:()=>[]},allowAdd:{type:Boolean,default:!0},allowDelete:{type:Boolean,default:!0}},emits:["input"],setup(e,{emit:t}){const a=e,o=t,n=ref(0),r={id:"",intention:""},s=reactive({nodeParam:[]});watch(()=>a.value,_=>{s.nodeParam=_},{immediate:!0});const l=()=>{r.id=s.nodeParam.length,s.nodeParam.push({...r}),o("input",s.nodeParam)},i=_=>{s.nodeParam.splice(_,1),s.nodeParam.forEach((m,v)=>{m.id=v}),n.value=new Date().getTime(),o("input",s.nodeParam)},u=ref(null),{option:g}=useSortable(u,s.nodeParam,{handle:".handle",onUpdate:_=>{const m=_.oldIndex-1,v=_.newIndex-1,x=s.nodeParam,D=x[m];x.splice(m,1),x.splice(v,0,D),x.forEach((y,b)=>{y.id=b}),s.nodeParam=x,n.value=new Date().getTime(),o("input",s.nodeParam)},onMove:_=>!_.related.className.endsWith("disabled")});return g("animation",200),(_,m)=>{const v=_sfc_main$U,x=FormItem,D=Input,y=Form;return openBlock(),createElementBlock("div",_hoisted_1$j,[createVNode(y,{class:"field-form form-custom",model:s,style:{width:"100%"},layout:"inline"},{default:withCtx(()=>[createBaseVNode("div",{ref_key:"refSelector",ref:u,style:{width:"100%"}},[m[0]||(m[0]=createBaseVNode("div",{class:"disabled mb-[12px] flex flex-row items-center pl-[20px] text-[13px] text-[#999]"},[createBaseVNode("span",null,"意图ID"),createBaseVNode("span",{class:"ml-[12px]"},"意图原因")],-1)),(openBlock(!0),createElementBlock(Fragment,null,renderList(s.nodeParam,(b,w)=>(openBlock(),createElementBlock("div",{key:n.value,class:normalizeClass(["field-form_row inline-block w-[100%]",{disabled:b.id===0}])},[createBaseVNode("div",{class:normalizeClass(["field-form_row-inner float-left",{"field-form_full":!e.allowDelete}])},[createVNode(x,{style:{"margin-right":"0"}},{default:withCtx(()=>[createBaseVNode("span",_hoisted_2$e,[b.id>0?(openBlock(),createBlock(v,{key:0,name:"drop",class:"handle cursor-all-scroll"})):createCommentVNode("",!0)]),createBaseVNode("span",_hoisted_3$a,toDisplayString(b.id),1)]),_:2},1024),createVNode(x,{field:"intention",style:{width:"calc(100% - 40px)"}},{default:withCtx(()=>[createVNode(D,{disabled:b.id===0,modelValue:b.intention,"onUpdate:modelValue":E=>b.intention=E,placeholder:"请输入意图"},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024)],2),b.id>0?(openBlock(),createBlock(v,{key:0,name:"minus",size:"16px",onClick:E=>i(w)},null,8,["onClick"])):createCommentVNode("",!0)],2))),128))],512)]),_:1},8,["model"]),e.allowAdd?(openBlock(),createElementBlock("div",{key:0,class:"flex w-[48px] cursor-pointer flex-row items-center",onClick:l},[createVNode(v,{name:"add",size:"16px"}),m[1]||(m[1]=createBaseVNode("span",{class:"ml-[4px] text-center text-[13px] font-normal not-italic leading-[22px] text-[#333333]"},"添加",-1))])):createCommentVNode("",!0)])}}}),form={elements:[],variables:[{id:"gU27AC82K385al98",name:"fields",label:"表单字段",type:"array",defaultValue:[],editor:{type:"Fields"}},{id:"c3Jc41GIRqAJAxs3",name:"editable",label:"表单模式",type:"boolean",defaultValue:!0,editor:{type:"Radio",props:{options:[{text:"编辑模式",value:!0},{text:"查看模式",value:!1}]}}},{id:"kL43LC82K385jk11",name:"hiddenFields",label:"隐藏字段",type:"array",defaultValue:[],editor:{type:"Fields"}},{id:"kL43LC82K385jk12",name:"actions",label:"按钮标题",type:"array",defaultValue:[],advancedconfig:!0,editor:{type:"Actions"}}]},widget={elements:[{type:"Page",content:[{slot:"default",content:[{type:"Widget",props:{url:{type:"expression",content:"{{$url}}"},visible:!0,fullscreen:!0}}]}]}],variables:[{id:"NlZrsruKCfgQtODM",name:"mount",label:"显示方式",type:"string",defaultValue:"message",editor:{type:"Select",props:{options:[{text:"消息内容",value:"message"},{text:"页面打开",value:"page"},{text:"聊天区域",value:"chat"}]}}},{id:"lMKwcgBCgGWWPAwm",name:"url",label:"卡片地址",type:"string",editor:{type:"field-filling"}},{id:"FuHexzsFYWEtQNCh",name:"visible",label:"默认显示",type:"boolean",defaultValue:!0,editor:{type:"Checkbox",props:{options:[{text:"显示",value:!0},{text:"隐藏",value:!1}]}}}]},_sfc_main$s=defineComponent({__name:"select-template",props:{item:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})}},emits:["change"],setup(e,{emit:t}){const a=e,o=t,n=computed(()=>a.item.prop),r=computed(()=>a.item.options),s=ref(a.item.default),l=ref("");watch(()=>s.value,u=>{a.formData[n.value]=u,l.value=r.value.find(g=>g.value===u)?.tips}),watch(()=>a.formData[n.value],u=>{u&&s.value===u||(s.value=u||a.item.default)},{immediate:!0});const i=u=>{o("change",u)};return(u,g)=>{const _=Option,m=Select,v=FormItem;return openBlock(),createBlock(v,{field:e.item.prop,label:e.item.label,required:!!e.item.required,style:normalizeStyle({width:e.item.width||"100%"})},{help:withCtx(()=>[createBaseVNode("div",null,toDisplayString(l.value),1)]),default:withCtx(()=>[createVNode(m,{modelValue:s.value,"onUpdate:modelValue":g[0]||(g[0]=x=>s.value=x),placeholder:e.item.placeholder,onChange:i},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.item.options,(x,D)=>(openBlock(),createBlock(_,{value:x.value,key:"option_"+D},{default:withCtx(()=>[createTextVNode(toDisplayString(x.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["field","label","required","style"])}}}),_sfc_main$r=defineComponent({__name:"card-outputs",props:{formData:{type:Object,default:()=>({})}},setup(e){const t=computed(()=>[{prop:"code",placeholder:"请输入变量名",width:"30%",type:"input",default:""},{prop:"name",placeholder:"请输入名称",width:"30%",type:"input",default:""},{prop:"value",placeholder:"",width:"40%",type:"field-filling"}]),a=computed(()=>({name:"",code:"",value:{type:"literal",content:""},type:"string",required:!0}));return(o,n)=>{const r=FormItem;return openBlock(),createElementBlock(Fragment,null,[createVNode(r,{label:"输出参数",class:"form-item_title"}),createVNode(_sfc_main$I,{value:e.formData.outputs,config:t.value,defaultRow:a.value,isFillField:!0,"enable-sort":!0},null,8,["value","config","defaultRow"])],64)}}}),_sfc_main$q=defineComponent({__name:"interactive-form",props:{formData:{type:Object,default:()=>({})}},emits:["update-config"],setup(e,{emit:t}){const a=e,o=t,n=computed(()=>INTERACTIVE_CONFIG.SELECT),r=computed(()=>l.value?INTERACTIVE_CONFIG.TITLE:INTERACTIVE_CONFIG.TEMPLATE),s=computed(()=>a.formData.templateId===CARD_TEMPLATE_TYPE.TEXT),l=computed(()=>a.formData.templateId===CARD_TEMPLATE_TYPE.FORM),i=computed(()=>l.value?form.variables:s.value?[]:widget.variables),u=ref(0);watch(()=>i.value,_=>{o("update-config",{type:"variables",variables:_})},{immediate:!0});const g=()=>{u.value+=1,a.formData.inputs=[],a.formData.outputs=[],a.formData.content="",a.formData.props={},a.formData.title="",a.formData.actionName=""};return(_,m)=>{const v=FormItem;return openBlock(),createElementBlock(Fragment,null,[createVNode(_sfc_main$s,{"form-data":e.formData,item:n.value,onChange:g},null,8,["form-data","item"]),l.value?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(v,{class:"form-item_title",label:r.value.label},null,8,["label"]),(openBlock(),createBlock(_sfc_main$K,{key:"inputs_"+u.value,value:e.formData[r.value.prop],inputs:e.formData.inputs,onInputs:m[0]||(m[0]=x=>e.formData.inputs=x),minHeight:r.value.minHeight,placeholder:r.value.placeholder,onInput:m[1]||(m[1]=x=>e.formData[r.value.prop]=x)},null,8,["value","inputs","minHeight","placeholder"]))],64)):createCommentVNode("",!0),s.value?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(v,{label:r.value.label,class:"form-item_title"},null,8,["label"]),(openBlock(),createBlock(_sfc_main$K,{key:"inputs_"+u.value,value:e.formData[r.value.prop],inputs:e.formData.inputs,onInputs:m[2]||(m[2]=x=>e.formData.inputs=x),placeholder:"请输入模板内容",title:"",onInput:m[3]||(m[3]=x=>e.formData[r.value.prop]=x)},null,8,["value","inputs"])),createVNode(_sfc_main$r,{formData:e.formData},null,8,["formData"])],64)):createCommentVNode("",!0)],64)}}}),_sfc_main$p=defineComponent({__name:"knowledge-form",props:{formData:{type:Object,default:()=>{}}},emits:["input"],setup(e,{emit:t}){const a=e,o=t,n=ref({}),r=ref(""),s=ref(5);watch(()=>a.formData,()=>{n.value=a.formData||{},typeof n.value.minScore>"u"&&(n.value.minScore=.5),s.value=n.value.minScore*10,typeof n.value.topK>"u"&&(n.value.topK=3),r.value=n.value?.inputs?.[0]?.value||{type:"literal",content:""}},{immediate:!0}),watch(()=>n.value,()=>{o("input",n.value)},{deep:!0}),watch(()=>r.value,D=>{n.value.inputs=[{code:"input",type:"string",value:D,required:!0}]},{immediate:!0});const l=useConfigStore(),i=computed(()=>l.knowledgeOptions.filter(D=>D.typeEnum!==3)),u=computed(()=>a.formData.outputs),g=ref({1:1,3:"默认",10:10}),_=ref({0:0,5:"默认",10:10}),m=computed(()=>{const D=JSON.parse(JSON.stringify(outputParamsConfig));return D.splice(3,1),D.forEach(y=>{y.width="33%"}),D[2].options.push({label:"对象",value:"object"}),D});watch(()=>s.value,()=>{n.value.minScore=s.value/10},{immediate:!0}),watch(()=>n.value.topK,D=>{D<1&&(n.value.topK=1)});const v=computed(()=>[{title:"名称",dataIndex:"name"},{title:"编码",dataIndex:"code"},{title:"类型",dataIndex:"type"}]);onMounted(()=>{typeof a.formData.pattern>"u"&&(a.formData.pattern=0)});const x=D=>{D===0&&(a.formData.outputs=[{code:"result",type:"string",name:"查询结果"}]),D===1&&(a.formData.outputs=[{name:"查询结果",code:"result",type:"array<object>",description:"",schema:[{name:"分段内容",code:"content",type:"string",description:""},{name:"分段标题",code:"title",type:"string",description:""},{name:"分段连接",code:"url",type:"string",description:""},{name:"分段元数据",code:"metadata",type:"object",description:""}]}])};return(D,y)=>{const b=Option,w=Select,E=FormItem,V=Slider,N=Radio,T=RadioGroup,C=Table;return openBlock(),createElementBlock(Fragment,null,[createVNode(E,{field:"knowledges",label:"知识库",rules:[{required:!0,message:"请至少选择一个知识库"}],required:!0},{default:withCtx(()=>[createVNode(w,{multiple:"",modelValue:n.value.knowledges,"onUpdate:modelValue":y[0]||(y[0]=f=>n.value.knowledges=f),style:{width:"100%"},placeholder:"请选择知识库"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(i.value,(f,d)=>(openBlock(),createBlock(b,{value:f.value,key:"option_"+d},{default:withCtx(()=>[createTextVNode(toDisplayString(f.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(E,{field:"topK",class:"knowledge_slider",label:"最大结果数量"},{default:withCtx(()=>[createVNode(V,{modelValue:n.value.topK,"onUpdate:modelValue":y[1]||(y[1]=f=>n.value.topK=f),onInput:y[2]||(y[2]=f=>n.value.topK=f),min:1,max:10,step:1,marks:g.value},null,8,["modelValue","marks"])]),_:1}),createVNode(E,{field:"minScore",class:"knowledge_slider",label:"最小匹配度"},{default:withCtx(()=>[createVNode(V,{modelValue:s.value,"onUpdate:modelValue":y[3]||(y[3]=f=>s.value=f),min:0,max:10,step:.1,marks:_.value},null,8,["modelValue","marks"])]),_:1}),createVNode(E,{label:"输入参数",style:{width:"100%"},required:!0},{default:withCtx(()=>[createVNode(_sfc_main$J,{value:r.value,minHeight:"30px",mode:"input",placeholder:"请输入",onInput:y[4]||(y[4]=f=>r.value=f)},null,8,["value"])]),_:1}),createVNode(E,{label:"输出参数",class:"form-item_title"}),createVNode(E,{field:"pattern",label:"分析模式"},{default:withCtx(()=>[createVNode(T,{modelValue:e.formData.pattern,"onUpdate:modelValue":y[5]||(y[5]=f=>e.formData.pattern=f),onChange:x},{default:withCtx(()=>[createVNode(N,{value:0},{default:withCtx(()=>y[7]||(y[7]=[createTextVNode("纯文本")])),_:1}),createVNode(N,{value:1},{default:withCtx(()=>y[8]||(y[8]=[createTextVNode("参数列表")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e.formData.pattern===0?(openBlock(),createBlock(C,{key:0,pagination:!1,class:"custom-grid",columns:v.value,data:u.value},null,8,["columns","data"])):(openBlock(),createBlock(_sfc_main$F,{key:1,"allow-add":!1,"allow-delete":!1,value:e.formData.outputs,config:m.value,onInput:y[6]||(y[6]=f=>e.formData.outputs=f)},null,8,["value","config"]))],64)}}}),_sfc_main$o=defineComponent({__name:"memory-component",props:{formData:{type:Object,default:()=>{}}},setup(e){const t=e,a=n=>{t.formData.memories=n?5:0},o=ref({1:1,5:"默认",10:10});return(n,r)=>{const s=Checkbox,l=FormItem,i=Slider;return openBlock(),createElementBlock(Fragment,null,[createVNode(l,{field:"memories",label:"会话记忆"},{default:withCtx(()=>[createVNode(s,{"model-value":e.formData.memories>0,onChange:a},null,8,["model-value"])]),_:1}),e.formData.memories>0?(openBlock(),createBlock(l,{key:0,field:"memories",class:"knowledge_slider",label:"会话记忆数量（对数）"},{default:withCtx(()=>[createVNode(i,{modelValue:e.formData.memories,"onUpdate:modelValue":r[0]||(r[0]=u=>e.formData.memories=u),onInput:r[1]||(r[1]=u=>e.formData.memories=u),min:1,max:10,step:1,marks:o.value},null,8,["modelValue","marks"])]),_:1})):createCommentVNode("",!0)],64)}}}),_hoisted_1$i=["innerHTML"],_sfc_main$n=defineComponent({__name:"output-parameters",props:{config:{type:Array,default:()=>[]},formData:{type:Object,default:()=>{}},defaultData:{type:Object,default:()=>{}}},emits:["input"],setup(e,{emit:t}){const a=e,o=t,n=ref({});watch(()=>a.formData,()=>{n.value=a.formData,a.formData?.outputType||(n.value.outputType=a.defaultData.outputType)},{immediate:!0}),watch(()=>n.value,()=>{o("input",n.value)});const r=computed(()=>n.value.outputType===OUTPUT_TYPE.VARIABLES),s=i=>{i===OUTPUT_TYPE.CONTENT&&(n.value.outputs=OUTPUT_DEFAULT_DATA[OUTPUT_TYPE.CONTENT]),i===OUTPUT_TYPE.VARIABLES&&(n.value.outputs=OUTPUT_DEFAULT_DATA[OUTPUT_TYPE.VARIABLES])},l=computed(()=>a.config);return(i,u)=>{const g=Radio,_=RadioGroup,m=FormItem;return openBlock(!0),createElementBlock(Fragment,null,renderList(l.value,v=>(openBlock(),createElementBlock(Fragment,null,[v.type==="radio"?(openBlock(),createBlock(m,{key:0,field:v.prop,label:v.label,class:normalizeClass({"arco-form-item_column":!!v.tooltip}),style:{width:"100%"}},{default:withCtx(()=>[createVNode(_,{modelValue:n.value[v.prop],"onUpdate:modelValue":x=>n.value[v.prop]=x,onInput:x=>n.value[v.prop]=x,onChange:s},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(v.options,(x,D)=>(openBlock(),createBlock(g,{key:"output"+D,value:x.value},{default:withCtx(()=>[createTextVNode(toDisplayString(x.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"]),v.tooltip?(openBlock(),createElementBlock("p",{key:0,innerHTML:v.tooltip},null,8,_hoisted_1$i)):createCommentVNode("",!0)]),_:2},1032,["field","label","class"])):createCommentVNode("",!0),r.value&&v.type==="dynamicForms"?(openBlock(),createBlock(_sfc_main$I,{key:"dynamicForms"+v.prop,value:n.value[v.prop],config:v.props,"enable-sort":!0,onInput:x=>n.value[v.prop]=x},null,8,["value","config","onInput"])):createCommentVNode("",!0)],64))),256)}}}),getPluginList=()=>axios.request({url:"/api/42000801/pluginManager/pluginList",method:"POST",data:{spaceGUID}}),getPluginServiceList=e=>axios.request({url:`/api/42000801/pluginManager/pluginServiceList?pluginGUID=${e}`,method:"POST"}),usePluginStore=defineStore("pluginApi",{state:()=>({pluginList:[],serviceList:[]}),getters:{pluginData:e=>e.pluginList,serviceData:e=>e.serviceList},actions:{async getPluginList(){const{data:e}=await getPluginList();this.pluginList=e.data},getPluginServiceList(e){e?getPluginServiceList(e).then(({data:t})=>{this.serviceList=t?.data||[]}).catch(()=>{this.serviceList=[]}):this.serviceList=[]}}}),_hoisted_1$h={class:"w-full"},_hoisted_2$d={class:"ml-[4px]"},_sfc_main$m=defineComponent({__name:"plugin-api",props:{formData:{type:Object,default:()=>{}},config:{type:Object,default:()=>{}}},emits:["input","toolId"],setup(e,{emit:t}){const a=e,o=usePluginStore();o.getPluginList();const n=useFlowStore(),r=t;let s=ref([]),l=ref(!1);const i=ref({});let u=ref(new Date().getTime());const g=computed(()=>o.pluginData||[]),_=computed(()=>o.serviceData||[]),m=computed(()=>{const d={};return s.value.forEach(h=>{d[h.value]=h}),d}),v=computed(()=>[{title:"名称",dataIndex:"code"},{title:"类型",dataIndex:"type"},{title:"描述",dataIndex:"description"}]),x=d=>{i.value.pluginId=d,i.value.source=g.value.find(h=>h.pluginGUID===d)?.source||0,i.value.toolId="",i.value.contentType="",i.value.operationId="",i.value.inputs=[],i.value.outputs=[]},D=d=>{i.value.inputs=[],i.value.outputs=[],i.value.toolId=d;const h=_.value.find(k=>k.path===d||k.code===d);i.value.contentType=h?.contentType||"",i.value.operationId=h?.operationId||"",V(),u.value=new Date().getTime()},y=d=>{d.forEach(h=>{const k=m.value[h.code];k&&(h.required=k.required,h.type=k.type,h.name=k.label)}),i.value.inputs=d},b=d=>{const h=(d||[]).map(k=>({name:k.describe||k.name,code:k.name,type:"string",required:k.required||!1,description:k.describe}));i.value.outputs=h};let E=ref([{prop:"code",placeholder:"请选择",width:"40%",type:"select",options:[],disabled:!0},{prop:"required",placeholder:"请选择",width:"20%",type:"select",options:[{label:"必填",value:!0},{label:"非必填",value:!1}],disabled:!0},{prop:"value",placeholder:"",width:"40%",type:"field-filling"}]);const V=()=>{const d=o.serviceData.find(S=>(S.path||S.code)===i.value.toolId)||{},h=[];let k=s.value;d.params&&(k=d.params.filter(S=>S.show),s.value=k.map(S=>(h.push({code:S.name,value:{type:"literal",content:""}}),{label:S.name,value:S.name,type:S.type,required:S.required}))),b(d.results),E.value[0].options=s.value,y(h)};watch(()=>a.formData,d=>{i.value=d},{immediate:!0}),watch(()=>a.formData.pluginId,d=>{o.getPluginServiceList(d)},{immediate:!0}),watch(()=>i.value,d=>{r("input",d)});const N=computed(()=>n.getParamsData()),T=computed(()=>{const d={};return N.value.forEach(h=>{if(h.children){if(h.code==="system")return;h.children.forEach(({value:k,description:S,name:A,type:O})=>{d[k]={description:S,name:A,type:O,code:k}})}}),d}),C=computed(()=>{const d={};return n.getSystemParamData().forEach(h=>{d[h.value]=h}),d}),f=()=>{const d=o.serviceData.find(h=>(h.path||h.code)===i.value.toolId)||{};d.params&&(l.value=!0,onMapping({source:Object.values(T.value),target:d.params.filter(h=>h.show).map(h=>({...h,code:h.name}))}).then(h=>{if(!(h.status!==200||!h?.data?.data)){if(typeof h.data.data=="object"){const k={};h.data.data.forEach(A=>{k[A.code]=A?.value});const S=JSON.parse(JSON.stringify(i.value.inputs));S.forEach(A=>{const z=k[A.code]?.content;z&&(T.value[z]||C.value[z])&&(A.value={type:"ref",content:z})}),u.value=new Date().getTime(),i.value.inputs=S}l.value=!1}}).finally(()=>{l.value=!1}))};return(d,h)=>{const k=Option,S=Select,A=FormItem,O=_sfc_main$U,z=Button,M=Popover,B=Table;return openBlock(),createElementBlock(Fragment,null,[createVNode(A,{field:"pluginId",label:"选择插件",required:!0,style:{width:"100%"}},{default:withCtx(()=>[createVNode(S,{modelValue:i.value.pluginId,"onUpdate:modelValue":h[0]||(h[0]=$=>i.value.pluginId=$),placeholder:"请选择",onChange:x},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(g.value,($,F)=>(openBlock(),createBlock(k,{value:$.pluginGUID,key:"option_"+F},{default:withCtx(()=>[createTextVNode(toDisplayString($.pluginName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(A,{field:"toolId",label:"插件服务",required:!0,style:{width:"100%"}},{default:withCtx(()=>[createVNode(S,{modelValue:i.value.toolId,"onUpdate:modelValue":h[1]||(h[1]=$=>i.value.toolId=$),placeholder:"请选择",onChange:D},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(_.value,($,F)=>(openBlock(),createBlock(k,{value:$.path||$.code,key:"option_"+F},{default:withCtx(()=>[createTextVNode(toDisplayString($.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(A,{label:"输入参数",class:"form-item_title"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$h,[createVNode(M,{position:"top","content-style":{padding:"4px 12px 8px 12px"},"popup-container":".designer-app"},{content:withCtx(()=>h[3]||(h[3]=[createBaseVNode("div",{class:"w-[120px] text-[13px] leading-[22px] text-[#333333]"}," 通过插件服务参数，自动生成输入参数。 ",-1)])),default:withCtx(()=>[createVNode(z,{type:"primary",class:"float-right rounded-[4px]",loading:unref(l),onClick:f},{default:withCtx(()=>[h[2]||(h[2]=createTextVNode(" 参数自动映射 ")),createBaseVNode("span",_hoisted_2$d,[createVNode(O,{name:"help",size:"16px",color:"white"})])]),_:1},8,["loading"])]),_:1})])]),_:1}),(openBlock(),createBlock(_sfc_main$I,{key:unref(u),value:i.value.inputs,config:unref(E),allowAdd:!1,allowDelete:!1,onInput:y},null,8,["value","config"])),createVNode(A,{label:"输出参数",class:"form-item_title"}),createVNode(B,{pagination:!1,class:"custom-grid",columns:v.value,data:i.value.outputs},null,8,["columns","data"])],64)}}}),_hoisted_1$g={class:"flex flex-row justify-center"},_hoisted_2$c={class:"text-[13px] font-normal not-italic leading-[22px] text-[#666666]"},_sfc_main$l=defineComponent({__name:"confirm-dialog",props:{show:{type:Boolean,default:!1},content:{type:String,default:""}},emits:["onOk","input"],setup(e,{emit:t}){const a=e,o=ref(!1);watch(()=>a.show,()=>{o.value=a.show});const n=t,r=()=>{n("onOk")},s=()=>{n("input",!1)};return(l,i)=>{const u=_sfc_main$U,g=Modal;return openBlock(),createBlock(g,{visible:o.value,"onUpdate:visible":i[0]||(i[0]=_=>o.value=_),simple:!0,"title-align":"start","popup-container":".designer-app",onOk:r,onClose:s},{title:withCtx(()=>[createBaseVNode("div",_hoisted_1$g,[createVNode(u,{name:"warning",color:"#FF9902",size:"24px"}),i[1]||(i[1]=createBaseVNode("span",{class:"ml-[12px] text-base font-semibold not-italic leading-[24px] text-[#333333]"},"确认删除",-1))])]),default:withCtx(()=>[createBaseVNode("div",_hoisted_2$c,toDisplayString(e.content),1)]),_:1},8,["visible"])}}}),_hoisted_1$f={key:0,class:"flex items-center pb-[12px]"},_hoisted_2$b={class:"relative flex items-center pb-[12px]"},_hoisted_3$9={class:"branch-title mr-[8px] inline-block"},_hoisted_4$8={key:1,class:"inline-block text-[13px] font-semibold"},_hoisted_5$7=["onClick"],_hoisted_6$6={class:"expression_relation float-left"},_hoisted_7$6=["onClick"],_hoisted_8$2={class:"expression_form float-left"},_hoisted_9$1={key:1,class:"float-left ml-[8px] flex h-[32px] w-[16px] cursor-pointer items-center"},_hoisted_10$1=["onClick"],maxNum=30,_sfc_main$k=defineComponent({__name:"selector-form",props:{conditions:{},id:{}},setup(e){const t=e,a=ref(!1),o=useFlowStore(),n=useConditionStore(),r=ref(null),s=ref({}),l={eq:{label:"等于",value:"eq"},neq:{label:"不等于",value:"neq"},lgthgt:{label:"长度大于",value:"lgthgt"},lgthgte:{label:"长度大于等于",value:"lgthgte"},lgthlt:{label:"长度小于",value:"lgthlt"},lgthlte:{label:"长度小于等于",value:"lgthlte"},contains:{label:"包含",value:"contains"},notcontains:{label:"不包含",value:"notcontains"},isempty:{label:"为空",value:"isempty"},notisempty:{label:"不为空",value:"notisempty"},gt:{label:"大于",value:"gt"},gte:{label:"大于等于",value:"gte"},lt:{label:"小于",value:"lt"},lte:{label:"小于等于",value:"lte"}},i=ref([l.eq,l.neq,l.lgthgt,l.lgthgte,l.lgthlt,l.lgthlte,l.contains,l.notcontains,l.isempty,l.notisempty]),u=ref([l.eq,l.neq,l.isempty,l.notisempty,l.gt,l.gte,l.lt,l.lte]),g=ref(["isempty","notisempty"]),_=computed(()=>t.conditions.length>2),m=computed(()=>o.getParamsData()),v=computed(()=>{const d={};return m.value.forEach(h=>{h.children&&h.children.forEach(k=>{k.title=k.name,d[k.value]=k})}),d}),x=()=>{const d=t.conditions.length;if(d>=maxNum)return Message.warning(`最多支持${maxNum}个条件分支！`);const h=d-1,k=JSON.parse(JSON.stringify(conditionData));k.id=generateCode(6),k.priority=d,k.title=`条件${d}`,k.type=d>1?"else if":"if",k.expressions[0].rules[0].left.code=generateCode(8),k.expressions[0].rules[0].right.code=generateCode(8),t.conditions.splice(h,0,k);const S=o.getNewEdgeId(!0),A=getAddCondition(k.id,t.id,S,"","");o.addSelector(A),T(!0)},D=d=>{d.push({left:{code:generateCode(8),value:{type:"ref",content:""}},operator:"eq",right:{code:generateCode(8),value:{type:"literal",content:""}}})};let y=-1;const b=d=>{y=d,a.value=!0},w=()=>{if(y<0)return;const d=t.conditions[y];t.conditions.splice(y,1),o.removeCondition(`${t.id}_condition_${d.id}`),T()},E=d=>{d.type=d.type==="and"?"or":"and"},V=d=>{d.collapse=!d.collapse},{option:N}=useSortable(r,t.conditions,{handle:".handle",onUpdate:d=>{if(t.conditions[d.newIndex].type==="else")return;const k=t.conditions[d.oldIndex];t.conditions.splice(d.oldIndex,1),t.conditions.splice(d.newIndex,0,k),nextTick(()=>{T(!0)})},onMove:d=>!d.related.className.endsWith("disabled")});N("animation",200);const T=(d=!1)=>{t.conditions.forEach((h,k)=>{h.priority=k+1,h.type!=="else"&&(h.type=k>0?"else if":"if")}),d&&o.updatePosition()},C=d=>{d.enableEdit=!0,nextTick(()=>{s.value[d.id].focus()})},f=d=>{const{value:h}=d.left||{};let k=i.value;if(h?.type==="ref"&&h?.content){const A=v.value[h.content];A&&A.type==="number"&&(k=u.value)}return k.some(A=>A.value===d.operator)||(d.operator=k[0].value),k};return(d,h)=>{const k=_sfc_main$U,S=FormItem,A=Input,O=Tag,z=Option,M=Select;return openBlock(),createElementBlock(Fragment,null,[createVNode(S,{class:"form-item_title relative",label:"条件分支"},{default:withCtx(()=>[createBaseVNode("div",{class:"absolute right-[0] flex cursor-pointer items-center hover:text-[#266EFF]",onClick:x},[createVNode(k,{name:"add",size:"16px"}),h[1]||(h[1]=createBaseVNode("span",{class:"ml-[4px] text-[13px] font-normal"},"新增分支",-1))])]),_:1}),createBaseVNode("div",{ref_key:"refSelector",ref:r},[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.conditions,(B,$)=>(openBlock(),createElementBlock("div",{key:"fz_"+B.id,class:normalizeClass(["selector-branch",{disabled:B.type==="else","is-active":unref(n).conditionId===B.id}])},[B.type==="else"?(openBlock(),createElementBlock("div",_hoisted_1$f,h[2]||(h[2]=[createBaseVNode("span",{class:"mr-[8px] text-[13px] font-semibold"},"否则",-1)]))):(openBlock(),createElementBlock(Fragment,{key:1},[createBaseVNode("div",_hoisted_2$b,[createVNode(k,{name:"drop",class:"handle cursor-all-scroll",onMousedown:F=>B.collapse=!0},null,8,["onMousedown"]),createVNode(k,{name:"down",class:normalizeClass(["mx-[4px] my-[0] cursor-pointer",{"-rotate-90 transform":B.collapse}]),onClick:F=>V(B)},null,8,["class","onClick"]),createBaseVNode("div",_hoisted_3$9,[B.enableEdit?(openBlock(),createBlock(A,{key:0,modelValue:B.title,"onUpdate:modelValue":F=>B.title=F,"max-length":10,placeholder:"请输入条件标题",error:!B.title,onBlur:F=>B.enableEdit=!1,ref_for:!0,ref:F=>s.value[B.id]=F},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])):(openBlock(),createElementBlock("span",_hoisted_4$8,[createTextVNode(toDisplayString(B.title)+" ",1),createVNode(k,{name:"edit",size:"16px",style:{cursor:"pointer","margin-left":"4px"},onClick:F=>C(B)},null,8,["onClick"])]))]),createVNode(O,{color:"gray"},{default:withCtx(()=>[createTextVNode("优先级"+toDisplayString(B.priority),1)]),_:2},1024),_.value?(openBlock(),createElementBlock("div",{key:0,class:"absolute right-0 cursor-pointer",onClick:F=>b($)},[createVNode(k,{name:"minus",size:"16px"})],8,_hoisted_5$7)):createCommentVNode("",!0)]),B.collapse?createCommentVNode("",!0):(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(B.expressions,(F,I)=>(openBlock(),createElementBlock("div",{class:normalizeClass({"selector-expression":!0,"is-multiple":F?.rules?.length>1}),key:"expression_"+I},[createBaseVNode("div",_hoisted_6$6,[createBaseVNode("span",{onClick:R=>E(F),class:"z-[1] flex w-[24px] cursor-pointer items-center justify-center rounded-[4px] border-[1px] border-solid border-[#A1CAFF] bg-[#EBF2FF] px-[4px] py-px text-[13px] text-[#266EFF] hover:border-[#266EFF]"},toDisplayString(F.type==="and"?"且":"或"),9,_hoisted_7$6)]),(openBlock(!0),createElementBlock(Fragment,null,renderList(F.rules,(R,Y)=>(openBlock(),createElementBlock("div",_hoisted_8$2,[createVNode(S,{class:"rule-item float-left","hide-label":!0,style:{width:"calc(50% - 80px)"}},{default:withCtx(()=>[(openBlock(),createBlock(_sfc_main$J,{key:"left_"+B.id,value:R.left.value,minHeight:"30px",mode:"input",placeholder:"请选择/输入参数值",onInput:U=>R.left.value=U},null,8,["value","onInput"]))]),_:2},1024),createVNode(S,{class:"float-left mx-[8px] my-[0]","hide-label":!0,style:{width:"120px"}},{default:withCtx(()=>[createVNode(M,{modelValue:R.operator,"onUpdate:modelValue":U=>R.operator=U},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(f(R),(U,G)=>(openBlock(),createBlock(z,{value:U.value,key:"option_"+G},{default:withCtx(()=>[createTextVNode(toDisplayString(U.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),g.value.includes(R.operator)?createCommentVNode("",!0):(openBlock(),createBlock(S,{key:0,class:"float-left","hide-label":!0,style:{width:"calc(50% - 80px)"}},{default:withCtx(()=>[(openBlock(),createBlock(_sfc_main$J,{key:"right_"+B.id,value:R.right.value,minHeight:"30px",mode:"input",placeholder:"请选择/输入参数值",onInput:U=>R.right.value=U},null,8,["value","onInput"]))]),_:2},1024)),F.rules.length>1?(openBlock(),createElementBlock("div",_hoisted_9$1,[createVNode(k,{name:"minus",size:"16px",onClick:()=>F.rules.splice(Y,1)},null,8,["onClick"])])):createCommentVNode("",!0)]))),256)),createBaseVNode("div",{class:"flex w-[48px] cursor-pointer flex-row items-center pb-[12px]",onClick:R=>D(F.rules)},[createVNode(k,{name:"add",size:"16px"}),h[3]||(h[3]=createBaseVNode("span",{class:"ml-[4px] text-center text-[13px] font-normal not-italic leading-[22px] text-[#333333]"},"添加",-1))],8,_hoisted_10$1)],2))),128))],64))],2))),128))],512),createVNode(_sfc_main$l,{show:a.value,content:"请确认是否删除当前条件分支？",onOnOk:w,onInput:h[0]||(h[0]=B=>a.value=B)},null,8,["show"])],64)}}}),onQueryPlan=e=>axios.request({url:"/api/42001401/plan/searchPlan",method:"POST",data:{planName:e,planCode:e,spaceGUID}}),onQueryPlanGroup=e=>axios.request({url:`/api/42001401/plan/findPlanRuleGroup?planGUID=${e}`,method:"POST"}),findPlanParams=e=>axios.request({url:`/api/42001401/plan/findPlanParams?planGUID=${e}`,method:"POST"}),_hoisted_1$e={class:"pd-input-textarea skill-card-plan_tree w-[100%]"},_hoisted_2$a={class:"pd-input-textarea__header"},_hoisted_3$8={class:"pd-input-textarea__body max-h-[224px] min-h-[224px] overflow-y-auto px-[16px] py-[5px]"},_hoisted_4$7={class:"flex items-center text-[13px] font-normal text-[#333333]"},_hoisted_5$6={class:"ml-[6px] inline-block"},_hoisted_6$5={class:"w-full"},_hoisted_7$5={class:"ml-[4px]"},_sfc_main$j=defineComponent({__name:"smart-check",props:{formData:{type:Object,default:()=>({})}},setup(e){const t=e;let a=ref([]),o=ref(0);const n=[{prop:"name",placeholder:"请选择",width:"40%",type:"select",options:[],disabled:!0},{prop:"required",placeholder:"请选择",width:"20%",type:"select",options:[{label:"必填",value:!0},{label:"非必填",value:!1}],disabled:!0},{prop:"value",placeholder:"",width:"40%",type:"field-filling"}],r=useFlowStore();let s=ref(n),l=ref(!1),i=ref(!1);const u=ref([]);onMounted(()=>{g(""),t.formData.id&&m()});const g=E=>{i.value=!0;let V={planGUID:""};t.formData.id&&(V=a.value.find(N=>N.planGUID===t.formData.id)),onQueryPlan(E).then(N=>{let T=!1;a.value=N.data.data?.map(C=>(C.planGUID===V?.planGUID&&(T=!0),{...C,label:`${C.planName}（${C.planCode}）`,value:C.planGUID}))||[],!T&&V?.planGUID&&a.value.push(V),i.value=!1}).catch(()=>{a.value=[],i.value=!1})},_=(E,V)=>E.filter(N=>N.parentId===V).map(N=>{const T=N.rules&&N.rules.length>0?N.rules?.map(C=>({value:C.id,name:C.name}))||[]:_(E,N.id);return{name:N.name,value:N.id,children:T}}),m=async()=>{const E=(await onQueryPlanGroup(t.formData.id))?.data?.data||[];u.value=_(E,null);const V=(await findPlanParams(t.formData.id))?.data?.data||[],N={};t.formData.inputs?.forEach(T=>{N[T.code]=T?.value}),t.formData.inputs=V.map(T=>({code:T.ParamsId,name:T.ParamsName,required:!!T.Required,type:"string",description:"",value:N[T.ParamsId]||{type:"literal",content:""}})),o.value+=1},v=computed(()=>{const E={};return r.getParamsData().forEach(V=>{if(V.children){if(V.code==="system")return;V.children.forEach(({value:N,description:T,name:C,type:f})=>{E[N]={description:T,name:C,type:f,code:N}})}}),E}),x=computed(()=>{const E={};return r.getSystemParamData().forEach(V=>{E[V.value]=V}),E}),D=()=>{t.formData?.inputs?.length&&(l.value=!0,onMapping({source:Object.values(v.value),target:t.formData.inputs}).then(({data:E})=>{if(l.value=!1,typeof E?.data=="object"){const V={};E.data.forEach(T=>{V[T.code]=T?.value});const N=JSON.parse(JSON.stringify(t.formData.inputs));N.forEach(T=>{const f=V[T.code]?.content;f&&(v.value[f]||x.value[f])&&(T.value={type:"ref",content:f})}),t.formData.inputs=N,o.value+=1}}).catch(()=>{l.value=!1}))},y=()=>{t.formData.inputs=[],u.value=[],m()},b=computed(()=>[{title:"参数编码",dataIndex:"code"},{title:"类型",dataIndex:"type"},{title:"说明",dataIndex:"description"}]),w=()=>{t.formData.id||Message.warning("请先选择方案"),window.open(`/std/42001401/08dce8d6-936f-4ba1-858f-d8421f16a3a6?mode=2&autoTitle=true&_mp=crumbs&title=方案&SpaceGUID=${spaceGUID}&oid=${t.formData.id}`)};return(E,V)=>{const N=Option,T=Select,C=FormItem,f=_sfc_main$U,d=Tree,h=Button,k=Popover,S=Table;return openBlock(),createElementBlock(Fragment,null,[createVNode(C,{label:"选择方案",field:"id",rules:[{required:!0,message:"请选择方案"}]},{default:withCtx(()=>[createVNode(T,{modelValue:e.formData.id,"onUpdate:modelValue":V[0]||(V[0]=A=>e.formData.id=A),"allow-search":!0,loading:unref(i),placeholder:"请输入方案名称、编码",onSearch:g,onChange:y,"filter-option":!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(a),A=>(openBlock(),createBlock(N,{value:A.value},{default:withCtx(()=>[createTextVNode(toDisplayString(A.label),1)]),_:2},1032,["value"]))),256))]),_:1},8,["modelValue","loading"])]),_:1}),e.formData.id?(openBlock(),createBlock(C,{key:0,label:"方案预览","hide-label":!0},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$e,[createBaseVNode("div",_hoisted_2$a,[V[2]||(V[2]=createBaseVNode("div",{class:"pd-input-textarea__header-title"},"方案预览",-1)),createBaseVNode("div",{class:"pd-input-textarea__header-btn",onClick:w},[createVNode(f,{name:"edit",size:"16px",color:"#266EFF"}),V[1]||(V[1]=createTextVNode("编辑检查方案 "))])]),createBaseVNode("div",_hoisted_3$8,[createVNode(d,{ref:"tree",data:u.value,"default-expand-all":!0,"block-node":""},{title:withCtx(A=>[createBaseVNode("div",_hoisted_4$7,[A.children?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(f,{name:"folder-fill",size:"16px"}),createBaseVNode("span",_hoisted_5$6,toDisplayString(A.name),1)],64)):(openBlock(),createElementBlock(Fragment,{key:1},[createTextVNode(toDisplayString(A.name),1)],64))])]),_:1},8,["data"])])])]),_:1})):createCommentVNode("",!0),e.formData.inputs?.length?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(C,{label:"输入参数",class:"form-item_title"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_6$5,[createVNode(k,{position:"top","content-style":{padding:"4px 12px 8px 12px"},"popup-container":".designer-app"},{content:withCtx(()=>V[4]||(V[4]=[createBaseVNode("div",{class:"w-[120px] text-[13px] leading-[22px] text-[#333333]"}," 通过提示模板参数，自动生成输入参数。 ",-1)])),default:withCtx(()=>[createVNode(h,{type:"primary",class:"float-right rounded-[4px]",loading:unref(l),onClick:D},{default:withCtx(()=>[V[3]||(V[3]=createTextVNode(" 参数自动映射 ")),createBaseVNode("span",_hoisted_7$5,[createVNode(f,{name:"help",size:"16px",color:"white"})])]),_:1},8,["loading"])]),_:1})])]),_:1}),(openBlock(),createBlock(_sfc_main$I,{key:"field-form_"+unref(o),value:e.formData.inputs,config:unref(s),allowAdd:!1,allowDelete:!1},null,8,["value","config"]))],64)):createCommentVNode("",!0),e.formData.id?(openBlock(),createBlock(C,{key:2,label:"输出参数",class:"form-item_title"})):createCommentVNode("",!0),e.formData.id?(openBlock(),createBlock(S,{key:3,pagination:!1,class:"custom-grid",columns:b.value,data:e.formData.outputs},null,8,["columns","data"])):createCommentVNode("",!0)],64)}}}),_hoisted_1$d={class:"form-textarea"},_sfc_main$i=defineComponent({__name:"text-template-form",props:{formData:{type:Object,default:()=>{}}},setup(e){const t=computed(()=>[{prop:"code",placeholder:"请输入变量名",width:"50%",type:"input",default:""},{prop:"value",placeholder:"",width:"50%",type:"field-filling"}]),a=()=>{window.open("https://handlebarsjs.com/")},o=computed(()=>[{title:"名称",dataIndex:"name"},{title:"编码",dataIndex:"code"},{title:"类型",dataIndex:"type"}]),n=computed(()=>({code:"",value:{type:"literal",content:""},required:!0}));return(r,s)=>{const l=FormItem,i=Textarea,u=Table;return openBlock(),createElementBlock(Fragment,null,[createVNode(l,{label:"输入变量",class:"form-item_title"}),(openBlock(),createBlock(_sfc_main$I,{key:e.formData._id,value:e.formData.inputs,config:t.value,defaultRow:n.value,"enable-sort":!0,onInput:s[0]||(s[0]=g=>e.formData.inputs=g)},null,8,["value","config","defaultRow"])),createBaseVNode("div",_hoisted_1$d,[createBaseVNode("div",{class:"form-textarea-header"},[createBaseVNode("span",{class:"text-xs",onClick:a},"只支持 Handlebars 模板语法")]),createVNode(i,{placeholder:"请输入","allow-clear":"","auto-size":{minRows:10,maxRows:10},"model-value":e.formData.content,"onUpdate:modelValue":s[1]||(s[1]=g=>e.formData.content=g)},null,8,["model-value"])]),createVNode(l,{label:"输出变量",class:"form-item_title"}),createVNode(u,{pagination:!1,class:"custom-grid",columns:o.value,data:e.formData.outputs},null,8,["columns","data"])],64)}}}),_sfc_main$h=defineComponent({__name:"chat-bi-form",props:{formData:{type:Object,default:()=>{}}},emits:["input"],setup(e,{emit:t}){const a=e,o=t,n=ref({}),r=ref("");watch(()=>a.formData,()=>{n.value=a.formData||{},r.value=n.value?.inputs?.[0]?.value||{type:"literal",content:""}},{immediate:!0}),watch(()=>n.value,()=>{o("input",n.value)},{deep:!0}),watch(()=>r.value,i=>{n.value.inputs=[{code:"input",type:"string",value:i,required:!0}]},{immediate:!0});const s=useConfigStore(),l=computed(()=>s.knowledgeOptions.filter(i=>i.typeEnum&&i.typeEnum===3));return onMounted(()=>{}),(i,u)=>{const g=Option,_=Select,m=FormItem;return openBlock(),createElementBlock(Fragment,null,[createVNode(m,{field:"knowledges",label:"数据知识库",rules:[{required:!0,message:"请至少选择一个数据知识库"}],required:!0},{default:withCtx(()=>[createVNode(_,{multiple:"",modelValue:n.value.knowledges,"onUpdate:modelValue":u[0]||(u[0]=v=>n.value.knowledges=v),style:{width:"100%"},placeholder:"请选择数据知识库"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(l.value,(v,x)=>(openBlock(),createBlock(g,{value:v.value,key:"option_"+x},{default:withCtx(()=>[createTextVNode(toDisplayString(v.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),createVNode(m,{label:"输入参数",style:{width:"100%"},required:!0},{default:withCtx(()=>[createVNode(_sfc_main$J,{value:r.value,minHeight:"30px",mode:"input",placeholder:"请输入",onInput:u[1]||(u[1]=v=>r.value=v)},null,8,["value"])]),_:1}),createVNode(unref(Alert),{title:"数据查询与总结节点说明",banner:!0,class:"char-bi-form-warning"},{default:withCtx(()=>u[2]||(u[2]=[createBaseVNode("p",null,"目前已支持问数场景数据知识库，以下为知识库创建和使用步骤：",-1),createBaseVNode("div",{class:"-ml-[24px]"},[createBaseVNode("div",{class:"mt-[12px] flex items-center"},[createBaseVNode("span",{class:"mr-[8px] flex h-[16px] w-[16px] flex-shrink-0 flex-col justify-center rounded-[100%] bg-[#CCDDFF] text-center text-[10px] font-semibold leading-[15px] text-[#266eff]"},"1"),createBaseVNode("span",{class:"text-[13px] font-medium leading-[20px] text-[#333333]"},"问数场景配置")]),createBaseVNode("div",{class:"mt-[4px] pl-[24px] text-[13px] font-normal leading-[20px] text-[#666666]"},[createTextVNode(" 创建问数报表（基于已有报表，此步骤可忽略）"),createBaseVNode("br"),createTextVNode(" 进入数据平台-问数配置，选择问数报表，并配置场景描述、总结配置、相关问题"),createBaseVNode("br"),createTextVNode(" 问数配置信息会自动同步至AI开发平台的数据知识库"),createBaseVNode("br")])],-1),createBaseVNode("div",{class:"-ml-[24px]"},[createBaseVNode("div",{class:"mt-[12px] flex items-center"},[createBaseVNode("span",{class:"mr-[8px] flex h-[16px] w-[16px] flex-shrink-0 flex-col justify-center rounded-[100%] bg-[#CCDDFF] text-center text-[10px] font-semibold leading-[15px] text-[#266eff]"},"2"),createBaseVNode("span",{class:"text-[13px] font-medium leading-[20px] text-[#333333]"},"问数场景参数绑定")]),createBaseVNode("div",{class:"mt-[4px] pl-[24px] text-[13px] font-normal leading-[20px] text-[#666666]"},[createTextVNode(" 若问数报表有配置过滤参数，为了提高报表参数的匹配的准确率，请在AI开发平台的的数据知识库中将参数与基础资料进行绑定"),createBaseVNode("br")])],-1),createBaseVNode("div",{class:"-ml-[24px]"},[createBaseVNode("div",{class:"mt-[12px] flex items-center"},[createBaseVNode("span",{class:"mr-[8px] flex h-[16px] w-[16px] flex-shrink-0 flex-col justify-center rounded-[100%] bg-[#CCDDFF] text-center text-[10px] font-semibold leading-[15px] text-[#266eff]"},"3"),createBaseVNode("span",{class:"text-[13px] font-medium leading-[20px] text-[#333333]"},"在当前节点选择数据知识库")]),createBaseVNode("div",{class:"mt-[4px] pl-[24px] text-[13px] font-normal leading-[20px] text-[#666666]"},[createTextVNode(" 基于问数的业务场景及AI技能的颗粒度，选择一个或多个问数场景数据知识库，用于回答用户的问数需求"),createBaseVNode("br")])],-1)])),_:1})],64)}}}),_hoisted_1$c={key:0},_hoisted_2$9={key:0},_hoisted_3$7=["innerHTML"],_hoisted_4$6={key:0,class:"mt-[12px]"},_hoisted_5$5={key:0,class:"mt-[12px]"},_hoisted_6$4=["innerHTML"],_hoisted_7$4={key:3,class:"skill-config-tips"},_sfc_main$g=defineComponent({__name:"props-form",setup(e){const t=useConfigStore(),a=useFlowStore(),o=useVerifiesStore(),n=ref([]),r=ref([]),s=ref(!1),l=computed(()=>a.nodes.find(V=>V.id===a.activeCardId)?.data||{}),i=computed(()=>a.activeCardId),u=computed(()=>{switch(t.activeType){default:return null}}),g=computed(()=>t.activeType===CARD_TYPE.FINISH);let _=null;const m=ref("");watch(()=>l.value,V=>{o.verify({data:V,cardId:i.value,cardType:t.activeType}),_&&clearTimeout(_),_=setTimeout(()=>{m.value=a.onVerifyParams()},1e3)},{deep:!0}),watch(()=>t.configData,V=>{const N=JSON.parse(JSON.stringify(V));n.value=N.filter(T=>!T.advancedconfig),r.value=N.filter(T=>!!T.advancedconfig&&!T.hide)||[]});const v=()=>{s.value=!s.value},x=computed(()=>[{required:!0,message:"请输入步骤名称"},{validator:(V,N)=>{a.nodes.some(C=>C.data.name===V&&C.id!==l.value._id)?N("步骤名称不允许重复"):N()}}]),D=(V,N)=>{N||(l.value.inputs=V)},y=ref(0),b=ref([]),w=V=>{b.value=[];const N=n.value.find(T=>T.type===V.type);N&&(N.variables=V.variables.filter(T=>!T.advancedconfig),y.value+=1),V?.variables?.filter(T=>{T.advancedconfig&&b.value.push({type:T.name,label:T.label,prop:T.name})}),l.value?.type===CARD_TYPE.INTERACTIVE&&l.value.templateId===CARD_TEMPLATE_TYPE.FORM&&b.value.push({type:"card-form-tips",prop:"tip"})},E=computed(()=>[...r.value,...b.value]);return watch(()=>i.value,()=>{b.value=[]}),(V,N)=>{const T=Alert,C=Input,f=FormItem,d=Textarea,h=Option,k=Select,S=Checkbox,A=Table,O=_sfc_main$U,z=_sfc_main$M,M=Form;return openBlock(),createElementBlock(Fragment,null,[m.value?(openBlock(),createBlock(T,{key:0,type:"warning",class:"flow-alert warning"},{default:withCtx(()=>[createTextVNode(toDisplayString(m.value),1)]),_:1})):createCommentVNode("",!0),g.value?(openBlock(),createBlock(T,{key:1,class:"flow-alert"},{default:withCtx(()=>N[7]||(N[7]=[createTextVNode("输出参数用于技能 SDK 调用场景，对话框交互无需配置输出参数，默认使用 AI 提示。")])),_:1})):createCommentVNode("",!0),u.value?(openBlock(),createBlock(resolveDynamicComponent(u.value),{key:2})):(openBlock(),createBlock(M,{"label-align":"left",class:"field-form",key:i.value,model:l.value,style:{width:"100%",padding:"20px",overflow:"hidden"}},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,B=>(openBlock(),createElementBlock(Fragment,null,[B.type==="input"?(openBlock(),createBlock(f,{key:0,field:B.prop,label:B.label,rules:B.prop==="name"?x.value:B.rules||[],style:normalizeStyle({width:B.width||"100%"})},{default:withCtx(()=>[B.readonly?(openBlock(),createElementBlock("span",_hoisted_1$c,toDisplayString(l.value[B.prop]),1)):(openBlock(),createBlock(C,{key:1,modelValue:l.value[B.prop],"onUpdate:modelValue":$=>l.value[B.prop]=$,placeholder:B.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"]))]),_:2},1032,["field","label","rules","style"])):createCommentVNode("",!0),B.type==="textarea"?(openBlock(),createBlock(f,{key:1,field:B.prop,label:B.label,style:normalizeStyle({width:B.width||"100%"})},{default:withCtx(()=>[B.readonly?(openBlock(),createElementBlock("span",_hoisted_2$9,toDisplayString(l.value[B.prop]),1)):(openBlock(),createBlock(d,{key:1,modelValue:l.value[B.prop],"onUpdate:modelValue":$=>l.value[B.prop]=$,placeholder:B.placeholder,maxLength:B.maxLength},null,8,["modelValue","onUpdate:modelValue","placeholder","maxLength"]))]),_:2},1032,["field","label","style"])):createCommentVNode("",!0),B.type==="select"?(openBlock(),createBlock(f,{key:2,field:B.prop,label:B.label,required:!!B.required,style:normalizeStyle({width:B.width||"100%"})},{default:withCtx(()=>[createVNode(k,{modelValue:l.value[B.prop],"onUpdate:modelValue":$=>l.value[B.prop]=$,placeholder:B.placeholder},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(B.options,($,F)=>(openBlock(),createBlock(h,{value:$.value,key:"option_"+F},{default:withCtx(()=>[createTextVNode(toDisplayString($.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["field","label","required","style"])):createCommentVNode("",!0),B.type==="checkbox"?(openBlock(),createBlock(f,{key:3,field:B.prop,label:B.label,style:normalizeStyle({width:B.width||"100%"})},{default:withCtx(()=>[createVNode(S,{modelValue:l.value[B.prop],"onUpdate:modelValue":$=>l.value[B.prop]=$},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["field","label","style"])):createCommentVNode("",!0),B.type==="dynamicForms"?(openBlock(),createElementBlock(Fragment,{key:4},[B.label?(openBlock(),createBlock(f,{key:0,label:B.label},null,8,["label"])):createCommentVNode("",!0),(openBlock(),createBlock(_sfc_main$I,{key:"dynamicForms"+B.prop,value:l.value[B.prop],config:B.props,"enable-sort":!0,"is-fill-field":!!B.enableFillField,onInput:$=>l.value[B.prop]=$},null,8,["value","config","is-fill-field","onInput"]))],64)):createCommentVNode("",!0),B.type==="title"?(openBlock(),createBlock(f,{key:5,label:B.label,class:"form-item_title"},null,8,["label"])):createCommentVNode("",!0),B.type==="template"?(openBlock(),createElementBlock(Fragment,{key:6},[B.label?(openBlock(),createBlock(f,{key:0,label:B.label},null,8,["label"])):createCommentVNode("",!0),createVNode(_sfc_main$K,{value:l.value[B.prop],inputs:l.value.inputs,onInputs:N[0]||(N[0]=$=>l.value.inputs=$),minHeight:B.minHeight,placeholder:B.placeholder,onInput:$=>l.value[B.prop]=$},null,8,["value","inputs","minHeight","placeholder","onInput"])],64)):createCommentVNode("",!0),B.type==="field-filling"?(openBlock(),createElementBlock(Fragment,{key:7},[B.label?(openBlock(),createBlock(f,{key:0,label:B.label,"hide-label":!!B.hideLabel,required:!!B.required},{default:withCtx(()=>[createVNode(_sfc_main$J,{value:l.value[B.prop],inputs:l.value.inputs,onInputs:$=>D($,!!B.disabledInputs),minHeight:B.minHeight,placeholder:B.placeholder,"input-disabled":B.inputDisabled,onInput:$=>l.value[B.prop]=$},null,8,["value","inputs","onInputs","minHeight","placeholder","input-disabled","onInput"])]),_:2},1032,["label","hide-label","required"])):createCommentVNode("",!0)],64)):createCommentVNode("",!0),B.type==="plugin-api"?(openBlock(),createBlock(_sfc_main$m,{key:8,"form-data":l.value,config:B,onInput:N[1]||(N[1]=$=>l.value=$)},null,8,["form-data","config"])):createCommentVNode("",!0),B.type==="output-type"?(openBlock(),createElementBlock(Fragment,{key:9},[createVNode(f,{label:B.label,class:"form-item_title"},null,8,["label"]),(openBlock(),createBlock(_sfc_main$n,{key:"params"+l.value._id,"form-data":l.value,config:B.config,defaultData:B.defaultData,onInput:N[2]||(N[2]=$=>l.value=$)},null,8,["form-data","config","defaultData"]))],64)):createCommentVNode("",!0),B.type==="card-form"?(openBlock(),createBlock(_sfc_main$C,{key:10,"form-data":l.value,config:B.config,label:B.label,onInput:N[3]||(N[3]=$=>l.value=$)},null,8,["form-data","config","label"])):createCommentVNode("",!0),B.type==="knowledge-form"?(openBlock(),createBlock(_sfc_main$p,{key:11,"form-data":l.value,onInput:N[4]||(N[4]=$=>l.value=$)},null,8,["form-data"])):createCommentVNode("",!0),B.type==="chat-bi-form"?(openBlock(),createBlock(_sfc_main$h,{key:12,"form-data":l.value,onInput:N[5]||(N[5]=$=>l.value=$)},null,8,["form-data"])):createCommentVNode("",!0),B.type==="select-template"?(openBlock(),createBlock(_sfc_main$s,{key:13,"form-data":l.value,item:B},null,8,["form-data","item"])):createCommentVNode("",!0),B.type==="ai-prompt"?(openBlock(),createBlock(_sfc_main$E,{key:14,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="image-analysis"?(openBlock(),createBlock(_sfc_main$v,{key:15,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="selector"?(openBlock(),createBlock(_sfc_main$k,{key:16,id:l.value._id,conditions:l.value.conditions},null,8,["id","conditions"])):createCommentVNode("",!0),B.type==="interactive-form"?(openBlock(),createBlock(_sfc_main$q,{key:17,"form-data":l.value,onUpdateConfig:w},null,8,["form-data"])):createCommentVNode("",!0),B.type==="document-analysis"?(openBlock(),createBlock(_sfc_main$A,{key:18,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="auxiliary-input"?(openBlock(),createBlock(_sfc_main$D,{key:19,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="text-template"?(openBlock(),createBlock(_sfc_main$i,{key:20,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="table"?(openBlock(),createElementBlock(Fragment,{key:21},[createVNode(A,{pagination:!1,class:"custom-grid",columns:B.columns,data:l.value[B.prop]},null,8,["columns","data"]),B.tips?(openBlock(),createElementBlock("div",{key:0,class:"text-tips",innerHTML:B.tips},null,8,_hoisted_3$7)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),B.type==="intention"?(openBlock(),createBlock(_sfc_main$t,{value:l.value[B.prop],key:i.value},null,8,["value"])):createCommentVNode("",!0),B.type==="image-recognize"?(openBlock(),createBlock(_sfc_main$u,{key:23,"form-data":l.value,config:B.config},null,8,["form-data","config"])):createCommentVNode("",!0),B.type==="smart-check"?(openBlock(),createBlock(_sfc_main$j,{key:24,"form-data":l.value,config:B.config},null,8,["form-data","config"])):createCommentVNode("",!0),B.type==="variables"&&B.variables?.length?(openBlock(),createElementBlock(Fragment,{key:25},[(openBlock(),createBlock(_sfc_main$z,{key:l.value.templateId+y.value,"card-config":B.variables,data:l.value.props,outputs:l.value.outputs,onOutputs:N[6]||(N[6]=$=>l.value.outputs=$)},null,8,["card-config","data","outputs"])),l.value.templateId===unref(CARD_TEMPLATE_TYPE).IMPLANT?(openBlock(),createBlock(_sfc_main$r,{key:0,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0)],64)):createCommentVNode("",!0),B.type==="upload-params"?(openBlock(),createBlock(_sfc_main$w,{key:26,title:"文件上传",data:l.value,"show-tips":!0,"support-files":[]},null,8,["data"])):createCommentVNode("",!0)],64))),256)),E.value.length?(openBlock(),createElementBlock("div",_hoisted_4$6,[createBaseVNode("div",{class:"inline-block flex cursor-pointer flex-row items-center",onClick:v},[N[9]||(N[9]=createBaseVNode("span",{class:"form-item_title mr-[8px]"},"高级配置",-1)),(openBlock(),createElementBlock("svg",{style:normalizeStyle({transform:`rotate(${s.value?0:180}deg)`}),class:"rotate-180 transform",fill:"none",stroke:"currentColor","stroke-width":"4",viewBox:"0 0 48 48",width:"1em",height:"1em"},N[8]||(N[8]=[createBaseVNode("path",{d:"M39.6 17.443 24.043 33 8.487 17.443"},null,-1)]),4))]),s.value?(openBlock(),createElementBlock("div",_hoisted_5$5,[(openBlock(!0),createElementBlock(Fragment,null,renderList(E.value,B=>(openBlock(),createElementBlock(Fragment,null,[B.type==="checkbox"?(openBlock(),createBlock(f,{key:0,field:B.prop,label:B.label,style:normalizeStyle({width:B.width||"100%"})},createSlots({default:withCtx(()=>[createVNode(S,{modelValue:l.value[B.prop],"onUpdate:modelValue":$=>l.value[B.prop]=$},null,8,["modelValue","onUpdate:modelValue"])]),_:2},[B.tips?{name:"help",fn:withCtx(()=>[createBaseVNode("div",{innerHTML:B.tips},null,8,_hoisted_6$4)]),key:"0"}:void 0]),1032,["field","label","style"])):createCommentVNode("",!0),B.type==="memory-component"?(openBlock(),createBlock(_sfc_main$o,{key:1,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="document-scope"?(openBlock(),createBlock(_sfc_main$B,{key:2,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0),B.type==="card-form-tips"?(openBlock(),createElementBlock("div",_hoisted_7$4,[createVNode(O,{size:"16px",name:"tips"}),N[10]||(N[10]=createBaseVNode("div",{class:"skill-config-tips_content"},[createBaseVNode("div",{class:"skill-config-tips_title"},"置信度："),createBaseVNode("div",{class:"skill-config-tips_describe"}," 在文档和图片分析节点中使用视觉识别能力时，系统会自动生成置信度评分。置信度评分数值越高，表示系统对识别结果的确信程度越高。用户可以针对置信度较低的字段进行核对和修订，确认无误后再录入到系统。 ")],-1))])):createCommentVNode("",!0),B.type==="actions"?(openBlock(),createBlock(z,{key:4,"form-data":l.value},null,8,["form-data"])):createCommentVNode("",!0)],64))),256))])):createCommentVNode("",!0)])):createCommentVNode("",!0)]),_:1},8,["model"]))],64)}}}),_hoisted_1$b={class:"w-[100%] h-[100%]"},_hoisted_2$8={class:"h-[100%] w-[64px] border-r-[1px] border-s-[#EAEAEA] float-left overflow-y-auto"},_hoisted_3$6={class:"h-[100%] float-left layout-content_inner box-border"},_hoisted_4$5={class:"layout-content_flow float-left h-[100%]"},_hoisted_5$4={class:"layout-content_attribute float-left w-[45%] h-[100%] overflow-y-auto pr-[12px]"},_sfc_main$f=defineComponent({__name:"layout-content",setup(e){return(t,a)=>(openBlock(),createElementBlock("div",_hoisted_1$b,[createBaseVNode("div",_hoisted_2$8,[createVNode(_sfc_main$N)]),createBaseVNode("div",_hoisted_3$6,[createBaseVNode("div",_hoisted_4$5,[createVNode(_sfc_main$P)]),createBaseVNode("div",_hoisted_5$4,[createVNode(_sfc_main$g)])])]))}}),_sfc_main$e=defineComponent({__name:"layout-preview",setup(e){window._gpt||(window._gpt={}),window._gpt.visible=!1;const t=useFlowStore(),a=()=>{if(window._gpt?.open){window._gpt.debug=!0;const{id:o}=t.data||{};if(!o)return;window._gpt.open({skills:[o],defaultSkill:o})}};return(o,n)=>{const r=_sfc_main$U;return openBlock(),createElementBlock("div",{onClick:a,class:"absolute right-[0] top-[20px] flex cursor-pointer flex-col items-center justify-center rounded-bl-[8px] rounded-br-[0] rounded-tl-[8px] rounded-tr-[0] bg-[linear-gradient(90deg,_#5C8AFF_0%,_#786CFF_100%)] px-[4px] py-[6px] [box-shadow:-4px_0_6px_-6px_#0000000f] [transition:0.3s] hover:opacity-90"},[createVNode(r,{name:"preview",size:"16px"}),n[0]||(n[0]=createBaseVNode("span",{class:"mt-[4px] text-xs font-normal not-italic leading-[16px] tracking-[4px] text-[#ffffff] [writing-mode:vertical-rl]"},"预览",-1))])}}}),_sfc_main$d=defineComponent({__name:"designer",setup(e){return(t,a)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(_sfc_main$f),createVNode(_sfc_main$e)],64))}}),_sfc_main$c=defineComponent({__name:"prompt-form",props:{config:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}}},setup(e){return(t,a)=>{const o=InputNumber,n=DatePicker,r=Input,s=FormItem,l=Form;return openBlock(),createBlock(l,{"label-align":"left",class:"field-form prompt-form",model:e.data},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config,i=>(openBlock(),createBlock(s,{label:i.paramName,field:i.paramCode,rules:i.isRequired?[{required:!0,message:"该参数为必填"}]:[],"label-col-flex":"12 12",style:{width:"100%"}},{default:withCtx(()=>[i.fieldType==="number"?(openBlock(),createBlock(o,{key:0,modelValue:e.data[i.paramCode],"onUpdate:modelValue":u=>e.data[i.paramCode]=u},null,8,["modelValue","onUpdate:modelValue"])):i.fieldType==="date"?(openBlock(),createBlock(n,{key:1,modelValue:e.data[i.paramCode],"onUpdate:modelValue":u=>e.data[i.paramCode]=u,format:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])):(openBlock(),createBlock(r,{key:2,modelValue:e.data[i.paramCode],"onUpdate:modelValue":u=>e.data[i.paramCode]=u},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["label","field","rules"]))),256))]),_:1},8,["model"])}}}),getCardProps=(e=[])=>e.reduce((t,a)=>(t[a.name]=a.value,t),{}),seed=1518116415,decrypt=(e,t)=>{let a=[];for(let o=0;o<e.length;o+=2)a.push(parseInt(e.slice(o,o+2),16));for(let o=2;o>=0;o--){let n=a.slice();for(let r=0;r<n.length;r++){let s=n[r],l=(t>>>r%32^o)&255;s^=r&255,s=s-(l&127)&255,s=(s>>>3|s<<5)&255,s^=l,a[r]=s}}return String.fromCharCode(...a)},decrypted="2b66fd3f544fc6b94fac1c91fd2f2147a7bc7e1e0b392b5ab52d7ef8ef09a0e0404de0cd82bb99e0a8b1e931";decrypt(decrypted,seed);class NetworkError extends Error{}class NotSupportedError extends Error{}class StreamDataParseError extends Error{}var MessageType=(e=>(e[e.text=0]="text",e[e.process=1]="process",e[e.error=2]="error",e[e.data=3]="data",e[e.done=4]="done",e[e.replace=5]="replace",e[e.recovery=6]="recovery",e[e.stream=7]="stream",e[e.reasoning=8]="reasoning",e[e.heartbeat=9]="heartbeat",e))(MessageType||{});const parseText=e=>({text:e.replace(/\|n/g,`
`)}),parseReasoning=e=>({reasoning:e.replace(/\|n/g,`
`)}),parseHeartbeat=e=>({heartbeat:e}),parseProcess=e=>({process:JSON.parse(e)}),parseError=e=>{const t=JSON.parse(e||"{}");return{error:{error:t.UserMessage||"",code:t.ErrorCode||"",message:t.ErrorMessage||"",type:t.Type,link:t.Link||""}}},parseData=e=>{const t=JSON.parse(e)||[];return t.forEach(a=>{if(a.status=a.type==="plan"?"waiting":"done",a.type==="card"||a.type==="page"){a.data.props=getCardProps(a.data?.props);const{mount:o}=a.data.props;(o==="chat"||o==="page")&&(a.command="page")}a.type==="form-binding"&&(a.command="action")}),{data:t}},parseDone=e=>({done:{id:e}}),parseReplace=e=>({replace:JSON.parse(e)}),parseRecovery=e=>({recovery:e||"recovery"}),parseStream=e=>({stream:JSON.parse(e)}),parseResponse=e=>{if(!e)return{text:""};let t=e.indexOf(":");if(t===-1||t>2)return{text:e};const a=e.slice(0,t),o=e.slice(t+1);try{switch(parseInt(a,10)){case MessageType.text:return parseText(o);case MessageType.process:return parseProcess(o);case MessageType.error:return parseError(o);case MessageType.data:return parseData(o);case MessageType.done:return parseDone(o);case MessageType.replace:return parseReplace(o);case MessageType.recovery:return parseRecovery(o);case MessageType.stream:return parseStream(o);case MessageType.reasoning:return parseReasoning(o);case MessageType.heartbeat:return parseHeartbeat(o);default:return{}}}catch{throw new StreamDataParseError("编排过程数据转化异常:"+e)}};class StreamRectifier{constructor(t={}){this.disposed=!1,this.override=t.override??!1}dispose(){this.disposed=!0}}class StreamArrayRectifier extends StreamRectifier{constructor(){super(...arguments),this.rectifiers=[]}get running(){return this.rectifiers.some(t=>t.running)}push(t){this.disposed||(this.rectifiers[t.index]||(this.rectifiers[t.index]=new StreamObjectRectifier({override:this.override})),this.rectifiers[t.index].push(t.value))}get value(){return this.rectifiers.map(t=>t.value)}get(){return this.value}dispose(){for(const t of this.rectifiers)typeof t.dispose=="function"&&t.dispose();super.dispose()}}class StreamBooleanRectifier extends StreamRectifier{get running(){return!1}get value(){return this.cache}push(t){this.disposed||(this.cache=t)}}const tokenizeSplit=e=>{const t=/(#{1,6}\s|```|\b\w+\b|[\u4e00-\u9fa5]|\s+|[^\w\s])/g,a=e.match(t);if(!a)return[];const o=[];for(let n=0;n<a.length;n++)/\s+/.test(a[n])&&o.length>0?o[o.length-1]+=a[n]:o.push(a[n]);return o};async function*streamChars(e,t=20){for(;e.length;){const a=e.shift();if(typeof a<"u")yield a,await sleep(t);else break}}class StreamStringRectifier extends StreamRectifier{constructor(){super(...arguments),this.chars=[],this.cache=[],this.origin="",this.timer=null,this.idle=!0}get running(){return this.cache.length>0}get value(){return this.chars.join("").replace(/\|n/g,`
`)}push(t=""){if(!this.disposed){if(t||(t=""),this.override&&t){const a=this.origin,o=`${t}`;if(o.startsWith(a))t=o.substring(a.length);else throw new Error("text error")}t.length&&(this.origin+=t,this.cache.push(...tokenizeSplit(t)),this.run())}}run(){this.idle&&(this.idle=!1,this.timer=setTimeout(()=>{Promise.all([new Promise(async t=>{for await(const a of streamChars(this.cache))this.chars.push(a);this.idle=!0,t(),await sleep(500),this.cache.length||this.stop()})])},1))}stop(){this.idle=!0,clearTimeout(this.timer),this.timer=null}dispose(){this.stop(),super.dispose()}}class StreamNumberRectifier extends StreamStringRectifier{push(t=0){this.disposed||(t=String(t),super.push(t))}get value(){const t=Number(super.value);return isNaN(t)?"":t}}class StreamObjectRectifier extends StreamRectifier{constructor(){super(...arguments),this.rectifiers=reactive({})}get running(){return Object.values(this.rectifiers).some(t=>t.running)}get value(){const t={};for(const[a,o]of Object.entries(this.rectifiers))t[a]=o.value;return reactive(t)}get(t){return this.rectifiers[t]?.value??""}set(t,a){if(a===null)return;let o=this.override,n;if(typeof a=="object"?(n=StreamArrayRectifier,o=!0):typeof a=="string"?n=StreamStringRectifier:typeof a=="number"?n=StreamNumberRectifier:typeof a=="boolean"&&(n=StreamBooleanRectifier),!n)throw new Error("unsupported type");this.rectifiers[t]||(this.rectifiers[t]=new n({override:o})),this.rectifiers[t].push(a)}push(t){if(!this.disposed)for(const[a,o]of Object.entries(t))this.set(a,o)}dispose(){for(const[t,a]of Object.entries(this.rectifiers))typeof a.dispose=="function"&&a.dispose();super.dispose()}}class StreamPipeline extends StreamObjectRectifier{async*[Symbol.asyncIterator](){for(;this.running;)await sleep(10);yield"done"}}class StreamBuffer{constructor(){this.debounceTimer=null,this.pendingBuffer=[],this.DEBOUNCE_TIME=300,this.running=!1}push(t){let a=!1,o=!1;t.forEach(n=>{this.pendingBuffer.push(n),n.recovery&&(this.pendingBuffer=[n],a=!0),n.done&&(o=!0)}),o&&(this.running=!1,this.debounceTimer&&clearTimeout(this.debounceTimer)),a&&(this.running=!0,this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.running=!1},this.DEBOUNCE_TIME))}async*[Symbol.asyncIterator](){if(this.running)yield[];else{const t=this.pendingBuffer;this.pendingBuffer=[],yield t}}}const NEWLINE=10;function isNewline(e){return e===NEWLINE}function concatChunks(e,t){const a=new Uint8Array(t);let o=0;for(const n of e)a.set(n,o),o+=n.length;return e.length=0,a}async function*fetchAsStream(e,t,a=fetch){try{const o=await a(e,t);if(!o.ok)throw new NetworkError(`网络连接错误，状态码：${o.status}`);if(!o.body)throw new NotSupportedError("当前浏览器不支持EventStream");const n=o.body.getReader(),r=new TextDecoder,s=[];let l=0;const i=new StreamPipeline,u=new StreamBuffer;for(;;){const{value:g}=await n.read();if(g&&(s.push(g),l+=g.length,!isNewline(g[g.length-1])))continue;if(s.length===0)break;const _=concatChunks(s,l);l=0;const m=r.decode(_,{stream:!0}).split(`
`).filter(v=>v!=="").map(parseResponse);u.push(m);for await(const v of u)for(const x of v)if(x.pipeline=i,x.text)if(x.text.length>40)yield x;else{const D=tokenizeSplit(x.text),y=20;for(const b of D)yield{text:b},await sleep(y)}else if(x.reasoning){const D=tokenizeSplit(x.reasoning),y=20;for(const b of D)yield{reasoning:b},await sleep(y)}else if(x.heartbeat)yield x;else if(x.stream)i.push(x.stream),yield x;else if(x.done)for await(const D of i)yield x;else yield x}}catch(o){if(!(o&&o.name&&o.name==="AbortError"))throw console.log("获取流失败",o),o}}const getPromptTestScenes=e=>axios.request({url:`/api/42001201/prompt/getPromptTestScenes?promptGUID=${e}`,method:"POST"}),saveData=e=>axios.request({url:"/api/42001201/prompt/savePromptTestScenes",method:"POST",data:e}).then(t=>(Message.success("保存成功"),t)),runTest=(e,t,a)=>fetchAsStream(`${t}/Prompt/TestPromptScene?promptTestSceneGUID=${e}`,{method:"POST",headers:a}),getToken=async e=>{try{const t=await axios.request({url:"/api/42001301/token/getToken",method:"POST",data:e,headers:{"Content-Type":"application/json"}});if(t.status!==200)throw new Error(`数据请求异常: ${t.status}`);return(t.data?.data||{})?.accessToken||""}catch(t){console.error("数据请求异常：",t)}};class Task{id="";params=[];func=()=>new Promise(t=>{t(null)});constructor(t,...a){this.id=Guid(),this.func=t,this.params=a}async run(){try{return await this.func.apply(this,Object.values(this.params))}catch(t){throw console.error(`Task ${this.id} failed with error:`,t),t}}}class TaskQueue{queue=[];runningTasks=[];limit=5;status="ready";events={taskRun:[],taskDone:[]};next(){for(;this.status==="running"&&this.queue.length>0&&this.runningTasks.length<this.limit;){const t=this.queue.shift();t&&(this.runningTasks.push(t),this.emit("taskRun",t,this.runningTasks.length,this.queue.length),t.run().then(()=>{this.runningTasks=this.runningTasks.filter(a=>a.id!==t.id),this.emit("taskDone",t,this.runningTasks.length,this.queue.length),this.next()}))}}emit(t,a,o,n){this.events[t].forEach(r=>{r(a,o,n)})}constructor(t){this.limit=t.limit,this.status="running"}addTask(t,...a){this.queue.push(new Task(t,...a)),this.status==="running"&&this.next()}start(){if(this.status==="running"){console.warn("当前TaskQueue已经运行，请勿重复运行");return}this.status="running",this.next()}pause(){if(this.status==="pause"){console.warn("当前TaskQueue已经暂停，请勿重复暂停");return}this.status="pause"}isQueueFull(){return this.runningTasks.length>=this.limit}on(t,a){this.events[t].push(a)}off(t,a){this.events[t]=this.events[t].filter(o=>o!==a)}}const usePromptStore=defineStore("prompt",{state:()=>({enableParam:!1,promptData:[],promptTemplate:"",id:"",taskQueue:new TaskQueue({limit:1}),params:[],paramsMap:{},defaultData:{},messageContent:[],title:"",requestToken:""}),getters:{},actions:{async getData(){const e=getParams().oid,{data:t}=await getPromptTestScenes(e),{promptParamDtos:a=[],promptTestSceneDtos:o=[],promptTemplate:n,messageContent:r,promptName:s,promptCode:l}=t.data;this.params=a&&a.filter(u=>u&&!u.isSystemParam)||[];const i={};return this.params.forEach(u=>{this.paramsMap[u.paramName]=u,i[u.paramName]=u.defaultValue}),this.defaultData=i,this.promptData=o,this.promptData.forEach(u=>{u.promptParams={...i,...JSON.parse(u.promptParams||{})}}),this.promptTemplate=n,this.messageContent=r||[],this.title=`${s}（${l}）`,this.id=e,t},saveData(){const e=JSON.parse(JSON.stringify(this.promptData));e.forEach(a=>{a.promptParams=a.promptParams?JSON.stringify(a.promptParams):JSON.stringify({})});const t=[];return this.messageContent.forEach((a,o)=>{t.push({...a,index:o+1})}),saveData({PromptGUID:this.id,promptTemplate:this.promptTemplate,promptTestSceneDtos:e,messageContent:t})},updateTemplate(e){this.promptTemplate=e},updateMessageContent(e,t){this.messageContent[e].content=t},addMessage(e){const t=this.messageContent.length;if(t>=10)return Message.warning("样本数据最多支持10条！");this.messageContent.push({content:"",index:t+1,role:e})},removeMessage(e){this.messageContent.splice(e,1)},addTest(){if(this.promptData.length>=5){Message.warning("测试场景最多支持5条数据");return}this.promptData.push({promptTestSceneGUID:Guid(),promptGUID:this.id,promptContent:"",promptParams:JSON.parse(JSON.stringify(this.defaultData)),outputContent:"",estimateContent:"",estimateRecord:0})},onDel(e){this.promptData.splice(e,1)},async run(e,t,a){if(e.status==="running")return;e.outputContent="",e.estimateContent="",e.estimateRecord=0;const o={};a.forEach(n=>{o[n.key]=n.value}),e.status="waiting",this.taskQueue.addTask(async n=>{e.status="running";try{this.requestToken||(this.requestToken=await getToken({})),this.requestToken&&(o["access-token"]=this.requestToken);const r=await runTest(n,t,o);for await(const s of r)s.text?e.outputContent+=s.text:s.data&&s.data.forEach(l=>{l.type==="score"&&(e.estimateRecord=l.data.value,e.estimateRecordMax=l.data.max||5,e.estimateContent=l.data.text)})}catch{console.log("执行测试失败")}e.status="idle"},e.promptTestSceneGUID)},async runItem(e){const t=this.promptData.find(r=>r.promptTestSceneGUID===e);if(t.status==="running")return;const{data:a}=await this.saveData(),o=a.data.gptEngineUrl,n=a.data.headers;this.run(t,o,n)},async runAll(){const{data:e}=await this.saveData(),t=e.data.gptEngineUrl,a=e.data.headers;for(let o=0;o<this.promptData.length;o++){const n=this.promptData[o];this.run(n,t,a)}}}}),batch=()=>({name:"batch",contains:[{className:"keyword",begin:/\b(echo|set|if|for|goto|pause|rem|exit|call|cls|start|title|attrib|xcopy|del|copy|mkdir|rmdir|dir|cd|pushd|popd|type)\b/,relevance:10},{className:"control-flow",begin:/\b(if|for|goto|exit)\b/,relevance:8},{className:"comment",variants:[{begin:/::/,end:/$/},{begin:/rem/,end:/$/}],relevance:10},{className:"string",begin:/"[^"]*"/,end:/"/,relevance:5},{className:"variable",begin:/%\w+%/,relevance:5},{className:"path",begin:/[A-Za-z]:[\/\\][^\n]*/,relevance:2},{className:"number",begin:/\b\d+\b/,relevance:2}]}),cshtmlRazor=e=>{const t="built_in",a={},o={begin:"}",className:t,endsParent:!0},n={begin:"{",end:"}",contains:[e.QUOTE_STRING_MODE,"self"]},r={begin:"{",end:"}",contains:["self"],skip:!0},s=e.COMMENT("@\\*","\\*@",{relevance:10}),l={begin:"@[A-Za-z0-9\\._:-]+",returnBegin:!0,end:`(\\r|\\n|<|\\s|"|')`,subLanguage:"csharp",contains:[{begin:"@",className:t},{begin:"\\[",end:"\\]",skip:!0},{begin:"\\(",end:"\\)",skip:!0}],returnEnd:!0},i={begin:"[@]{0,1}<text>",returnBegin:!0,end:"</text>",returnEnd:!0,subLanguage:"cshtml-razor",contains:[{begin:"[@]{0,1}<text>",className:t},{begin:"</text>",className:t,endsParent:!0}]},u={variants:[{begin:"@@"},{begin:"[a-zA-Z]+@"}],skip:!0},g={begin:"@\\(",end:"\\)",returnBegin:!0,returnEnd:!0,subLanguage:"csharp",contains:[{begin:"@\\(",className:t},{begin:"\\(",end:"\\)",subLanguage:"csharp",contains:[e.QUOTE_STRING_MODE,"self",i]},i,{begin:"\\)",className:t,endsParent:!0}]},_=getXmlBlocks(e,[l,g]),m="^\\s*@(page|model|using|inherits|inject|layout)",v={begin:m+"[^\\r\\n{\\(]*$",end:"$",returnBegin:!0,returnEnd:!0,contains:[{begin:m,className:t},{variants:[{begin:"\\r|\\n",endsParent:!0},{begin:"\\s[^\\r\\n]+",end:"$"},{begin:"$"}],className:"type",endsParent:!0}]},D={variants:[{begin:"@\\{",end:"}"},{begin:"@code\\s*\\{",end:"}"}],returnBegin:!0,returnEnd:!0,subLanguage:"csharp",contains:[{begin:"@(code\\s*)?\\{",className:t},a,r,o]},y={begin:"^\\s*@helper[\\s]*[^{]+[\\s]*{",returnBegin:!0,returnEnd:!0,end:"}",subLanguage:"cshtml-razor",contains:[{begin:"@helper",className:t},{begin:"{",className:t},o]},b=[{begin:"@for[\\s]*\\([^{]+[\\s]*{",end:"}"},{begin:"@if[\\s]*\\([^{]+[\\s]*{",end:"}"},{begin:"@switch[\\s]*\\([^{]+[\\s]*{",end:"}"},{begin:"@while[\\s]*\\([^{]+[\\s]*{",end:"}"},{begin:"@using[\\s]*\\([^{]+[\\s]*{",end:"}"},{begin:"@lock[\\s]*\\([^{]+[\\s]*{",end:"}"},{begin:"@foreach[\\s]*\\([^{]+[\\s]*{",end:"}"}],w={variants:b,returnBegin:!0,returnEnd:!0,subLanguage:"csharp",contains:[{variants:b.map(function(f){return{begin:f.begin}}),returnBegin:!0,contains:[{begin:"@",className:t},{variants:b.map(function(f){return{begin:f.begin.substr(1,f.begin.length-2)}}),subLanguage:"csharp"},{begin:"{",className:t}]},a,{variants:[{begin:"}[\\s]*else\\sif[\\s]*\\([^{]+[\\s]*{"},{begin:"}[\\s]*else[\\s]*{"}],returnBegin:!0,contains:[{begin:"}",className:t},{variants:[{begin:"[\\s]*else\\sif[\\s]*\\([^{]+[\\s]*{"},{begin:"[\\s]*else[\\s]*"}],subLanguage:"csharp"},{begin:"{",className:t}]},n,o]},E={begin:"@try[\\s]*{",end:"}",returnBegin:!0,returnEnd:!0,subLanguage:"csharp",contains:[{begin:"@",className:t},{begin:"try[\\s]*{",subLanguage:"csharp"},{variants:[{begin:"}[\\s]*catch[\\s]*\\([^\\)]+\\)[\\s]*{"},{begin:"}[\\s]*finally[\\s]*{"}],returnBegin:!0,contains:[{begin:"}",className:t},{variants:[{begin:"[\\s]*catch[\\s]*\\([^\\)]+\\)[\\s]*"},{begin:"[\\s]*finally[\\s]*"}],subLanguage:"csharp"},{begin:"{",className:t}]},a,n,o]},V="@section[\\s]+[a-zA-Z0-9]+[\\s]*{",C=[v,y,D,w,{begin:V,returnBegin:!0,returnEnd:!0,end:"}",subLanguage:"cshtml-razor",contains:[{begin:V,className:t},n,o]},{begin:"@await ",returnBegin:!0,subLanguage:"csharp",end:"(\\r|\\n|<|\\s)",contains:[{begin:"@await ",className:t},{begin:"[<\\r\\n]",endsParent:!0}]},E,u,i,s,g,{className:"meta",begin:"<!DOCTYPE",end:">",relevance:10,contains:[{begin:"\\[",end:"\\]"}]},{begin:"<\\!\\[CDATA\\[",end:"\\]\\]>",relevance:10}].concat(_);return[D,w,E].forEach(function(f){const d=C.filter(function(S){return S!==f}),k=[f.contains.indexOf(a),1].concat(d);f.contains.splice.apply(f.contains,k)}),{aliases:["cshtml","razor","razor-cshtml","cshtml-razor"],contains:C}};function getXmlBlocks(e,t){const a=e.COMMENT("<!--","-->",{relevance:10}),n={endsWithParent:!0,illegal:/</,relevance:0,contains:[{className:"attr",begin:"[A-Za-z0-9\\._:-]+",relevance:0},{begin:/=\s*/,relevance:0,contains:[{className:"string",variants:[{begin:/"/,end:/"/,contains:t},{begin:/'/,end:/'/,contains:t},{begin:/[^\s"'=<>`]+/}]}]}]};return[{className:"meta",begin:"<!DOCTYPE",end:">",relevance:10,contains:[{begin:"\\[",end:"\\]"}]},a,{begin:"<\\!\\[CDATA\\[",end:"\\]\\]>",relevance:10},{className:"meta",begin:/<\?xml/,end:/\?>/,relevance:10},{className:"tag",begin:"<style(?=\\s|>|$)",end:">",keywords:{name:"style"},contains:[n],starts:{end:"</style>",returnEnd:!0,subLanguage:["css","xml"]}},{className:"tag",begin:"<script(?=\\s|>|$)",end:">",keywords:{name:"script"},contains:[n],starts:{end:"<\/script>",returnEnd:!0,subLanguage:["actionscript","javascript","handlebars","xml"]}},{className:"tag",begin:"</?",end:"/?>",contains:[{className:"name",begin:/[^\/><\s]+/,relevance:0},n]}].concat(t)}const csv=()=>({name:"csv",contains:[{className:"string",begin:'"',end:'"',relevance:0},{className:"separator",begin:",",end:",",relevance:0},{className:"number",begin:"\\b\\d+\\b",relevance:0},{className:"literal",begin:"[a-zA-Z]+",relevance:0}]}),markup=()=>({name:"markup",contains:[{className:"tag",begin:/<\s*\/?([a-zA-Z0-9-]+)\s*[^>]*>/,end:/\/?>/,subLanguage:"xml"},{className:"attribute",begin:/\s+[a-zA-Z-]+="[^"]*"/,relevance:0},{className:"value",begin:/="[^"]*"/,relevance:0}]}),sanitizeOptions={ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","div","p","blockquote","b","br","em","i","kbd","mark","q","span","strong","sub","sup","s","hr","a","img","dd","dl","dt","ul","li","ol","pre","code","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr","video","font","u","del"],ALLOWED_ATTR:["href","src","target","srcset","alt","width","height","color","style"],ALLOWED_URI_REGEXP:/^(?:(?:https?|gpt):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i},onSanitizeHtml=e=>e?purify.sanitize(e,sanitizeOptions):"",registerLanguages=()=>{HighlightJS.registerLanguage("bash",bash),HighlightJS.registerLanguage("sh",shell),HighlightJS.registerLanguage("shell",shell),HighlightJS.registerLanguage("powershell",powershell),HighlightJS.registerLanguage("bat",batch),HighlightJS.registerLanguage("batch",batch),HighlightJS.registerLanguage("csharp",csharp),HighlightJS.registerLanguage("dotnet",csharp),HighlightJS.registerLanguage("aspnet",csharp),HighlightJS.registerLanguage("cs",csharp),HighlightJS.registerLanguage("razor",cshtmlRazor),HighlightJS.registerLanguage("cshtml",cshtmlRazor),HighlightJS.registerLanguage("c",c),HighlightJS.registerLanguage("cpp",cpp),HighlightJS.registerLanguage("less",less),HighlightJS.registerLanguage("css",css),HighlightJS.registerLanguage("json",json),HighlightJS.registerLanguage("csv",csv),HighlightJS.registerLanguage("yaml",yaml),HighlightJS.registerLanguage("yml",yaml),HighlightJS.registerLanguage("xml",xml),HighlightJS.registerLanguage("svg",markup),HighlightJS.registerLanguage("markup",markup),HighlightJS.registerLanguage("mathml",markup),HighlightJS.registerLanguage("ssml",markup),HighlightJS.registerLanguage("rss",markup),HighlightJS.registerLanguage("atom",markup),HighlightJS.registerLanguage("java",java),HighlightJS.registerLanguage("python",python),HighlightJS.registerLanguage("sql",sql),HighlightJS.registerLanguage("javascript",javascript),HighlightJS.registerLanguage("js",javascript),HighlightJS.registerLanguage("typescript",typescript),HighlightJS.registerLanguage("ts",typescript)},languages=["aspnet","batch","csv","java","json","jsx","less","powershell","python","sql","bash","sh","shell","csharp","dotnet","cs","cshtml","razor","typescript","ts","yaml","yml","c","cpp","javascript","js","css","markup","html","mathml","svg","xml","ssml","atom","rss"];["abap","actionscript-3","ada","adoc","angular-html","angular-ts","apache","apex","apl","applescript","ara","asciidoc","asm","astro","awk","ballerina","bash","bat","batch","be","beancount","berry","bibtex","bicep","blade","c","c#","c++","cadence","cdc","clarity","clj","clojure","closure-templates","cmake","cmd","cobol","codeowners","codeql","coffee","coffeescript","common-lisp","console","coq","cpp","cql","crystal","cs","csharp","css","csv","cue","cypher","d","dart","dax","desktop","diff","docker","dockerfile","dotenv","dream-maker","edge","elisp","elixir","elm","emacs-lisp","erb","erl","erlang","f","f#","f03","f08","f18","f77","f90","f95","fennel","fish","fluent","for","fortran-fixed-form","fortran-free-form","fs","fsharp","fsl","ftl","gdresource","gdscript","gdshader","genie","gherkin","git-commit","git-rebase","gjs","gleam","glimmer-js","glimmer-ts","glsl","gnuplot","go","gql","graphql","groovy","gts","hack","haml","handlebars","haskell","haxe","hbs","hcl","hjson","hlsl","hs","html","html-derivative","http","hxml","hy","imba","ini","jade","java","javascript","jinja","jison","jl","js","json","json5","jsonc","jsonl","jsonnet","jssm","jsx","julia","kotlin","kql","kt","kts","kusto","latex","lean","lean4","less","liquid","lisp","lit","log","logo","lua","luau","make","makefile","markdown","marko","matlab","md","mdc","mdx","mediawiki","mermaid","mojo","move","nar","narrat","nextflow","nf","nginx","nim","nix","nu","nushell","objc","objective-c","objective-cpp","ocaml","pascal","perl","perl6","php","plsql","po","postcss","pot","potx","powerquery","powershell","prisma","prolog","properties","proto","protobuf","ps","ps1","pug","puppet","purescript","py","python","ql","qml","qmldir","qss","r","racket","raku","razor","rb","reg","regex","regexp","rel","riscv","rs","rst","ruby","rust","sas","sass","scala","scheme","scss","sh","shader","shaderlab","shell","shellscript","shellsession","smalltalk","solidity","soy","sparql","spl","splunk","sql","ssh-config","stata","styl","stylus","svelte","swift","system-verilog","systemd","tasl","tcl","templ","terraform","tex","tf","tfvars","toml","ts","ts-tags","tsp","tsv","tsx","turtle","twig","typ","typescript","typespec","typst","v","vala","vb","verilog","vhdl","vim","viml","vimscript","vue","vue-html","vy","vyper","wasm","wenyan","wgsl","wiki","wikitext","wl","wolfram","xml","xsl","yaml","yml","zenscript","zig","zsh","文言"].reduce((e,t)=>(e[t]=!0,e),{});const md=MarkdownIt({html:!0,linkify:!0,breaks:!0});registerLanguages();md.use(container_plugin,"actions",{validate(e){return e.trim().match(/^actions$/)},render(e,t){return e[t].nesting===1?`<div class="gpt-card-actions">
`:`</div>
`}}).use(MarkdownItHighlight,{hljs:HighlightJS,inline:!0,langPrefix:"hljs language-"}).use(e=>{e.core.ruler.before("normalize","sanitize",function(a){const o=/```([\s\S]*?)```/g,n=/([^`]|^)`([^`\n]+)`([^`]|$)/g,r=[];let s=a.src,l=0;s=s.replace(o,(i,u)=>{const g=`__CODE_BLOCK_${l++}__`;return r.push({type:"block",content:i,placeholder:g}),g}),s=s.replace(n,(i,u,g,_)=>{const m=`__INLINE_CODE_${l++}__`;return r.push({type:"inline",content:i,placeholder:m}),u+m+_}),s=onSanitizeHtml(s),r.forEach(i=>{s=s.replace(i.placeholder,i.content)}),a.src=s})});const p=location.pathname;md.use(preWrapperPlugin);const use=async()=>{md.renderer.rules.link_open=function(e,t,a,o,n){const r=e[t];if(r){const s=r.attrGet("href");s&&(s.startsWith("http://")||s.startsWith("https://"))?r.attrPush(["target","_blank"]):s&&s.startsWith("gpt://")&&(r.attrPush(["gpt-action",s]),r.attrSet("href","javascript:void(0);"))}return n.renderToken(e,t,a)},md.renderer.rules.text=function(e,t,a,o,n){const r=e[t].content;return t<1?r:e[t-1]?.type==="link_open"?`<span data-type="message-btn" class="gpt-message-btn">${r}</span>`:r},md.renderer.rules.code_inline=function(e,t){return`<code>${e[t].content.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code>`},md.renderer.rules.code_block=function(e,t){return`<pre><code>${e[t].content.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`}};use();const disableHtmlMd=MarkdownIt({html:!1,linkify:!0,breaks:!0});disableHtmlMd.use(MarkdownItHighlight,{hljs:HighlightJS,inline:!0,langPrefix:"hljs language-"});disableHtmlMd.use(preWrapperPlugin);const renderMarkdown=(e,t,a)=>{let r=(t==="user"?disableHtmlMd:md).render((e||"").trim());return a?.transFn&&(r=a.transFn(r)),r},isCodeGeneration=p.startsWith("/coding/business-component")||p.startsWith("/modeling/designer")||location.hostname==="localhost",iconSVG='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="1" y="2" width="10" height="4.5" rx="0.6" stroke="currentColor" stroke-width="1.2"/><rect x="1" y="9.5" width="10" height="4.5" rx="0.6" stroke="currentColor" stroke-width="1.2"/><path d="M15.5 6L12.5 8L15.5 10" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/></svg>',copySVG='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="4.80005" y="4.79999" width="9.6" height="9.6" rx="0.6" stroke="currentColor" stroke-width="1.2"/><path d="M11.2001 2.59998V2.19998C11.2001 1.8686 10.9315 1.59998 10.6001 1.59998H2.2001C1.86873 1.59998 1.6001 1.8686 1.6001 2.19998V10.6C1.6001 10.9313 1.86873 11.2 2.2001 11.2H2.6001" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>',getCodeToolbar=e=>{let t=`<div class="gpt-code-block_toolbar"><div class="gpt-code-block_language">${e}</div><div class="gpt-code-block_actions">`;return isCodeGeneration&&(t+=`<button class="gpt-code-generation">${iconSVG}</button>`),t+=`<button class="gpt-code-generation" data-action="copy" title="复制">${copySVG}</button>`,t+"</div></div>"};function preWrapperPlugin(e){const t=e.renderer.rules.fence;e.renderer.rules.fence=(...o)=>{const[n,r]=o,s=n[r];s.info=s.info.replace(/\[.*\]/,"");const l=extractLang(s.info);l&&!languages.includes(l)&&(s.info="");let i="";try{i=t(...o)}catch{}const u=getCodeToolbar(l);return i.replace(/<pre[^>]*>/,`<pre class="hljs language-${l} gpt-code-block">${u}`)};const a=e.renderer.rules.table_open||function(o,n,r,s,l){return`<table>
`};e.renderer.rules.table_open=(o,n,r,s,l)=>`<div class="gpt-table-container">
      <button class="gpt-table-container_copy gpt-code-generation" data-action="copy-table" title="复制">
      ${copySVG}
      </button>`+a(o,n,r,s,l),e.renderer.rules.table_close=(o,n,r,s,l)=>`</table>
</div>`}const MD_CLASS=`
  prose prose-slate prose-sm max-w-none dark:prose-invert
  prose-headings:font-semibold prose-headings:mb-4 prose-headings:mt-2
  prose-h1:text-[18px] prose-h1:my-[16px]
  prose-h2:text-[16px] prose-h2:my-[16px]
  prose-h3:text-[15px] prose-h3:my-[12px]
  prose-h4:text-[15px] prose-h4:my-[6px] prose-h4:pl-[12px]
  prose-h5:text-[15px] prose-h5:my-[6px] prose-h5:pl-[24px]
  prose-h6:text-[15px] prose-h6:my-[6px] prose-h6:pl-[36px]
  prose-p:my-4 prose-p:mb-1 prose-p:mt-[4px] prose-p:mb-[4px] prose-p:text-[14px] prose-p:leading-[22px]
  prose-ol:list-decimal prose-ol:pl-5 prose-ol:my-1 prose-ol:ml-6
  prose-ul:list-disc prose-ul:pl-5 prose-ul:my-1 prose-ul:pl-0.5
  prose-li:my-1
  prose-pre:my-2 prose-pre:w-full overflow-hidden break-words
  prose-table:min-w-full prose-table:border-collapse prose-table:border prose-table:border-[#EAEAEA] prose-table:bg-[#FFFFFF]
  prose-th:border prose-th:px-4 prose-th:py-2 prose-th:bg-[#F7F8FA] prose-th:!text-[12px]
  prose-tr:bg-white
  prose-td:border prose-td:px-4 prose-td:py-2 prose-td:!text-[12px]
  prose-img:rounded-lg prose-img:my-4
  prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:hover:underline
`,extractLang=e=>e.trim().replace(/:(no-)?line-numbers({| |$).*/,"").toLowerCase(),_hoisted_1$a={class:"prompt-designer h-[100%] w-[100%]"},_hoisted_2$7={class:"float-left box-border h-[100%] w-[400px] overflow-y-auto [border-right:1px_solid_#EAEAEA]"},_hoisted_3$5={class:"px-[20px] py-[13px] text-sm font-semibold not-italic leading-[22px] text-[#333333]"},_hoisted_4$4={class:"handle cursor-all-scroll"},_hoisted_5$3={key:0,class:"ml-[20px] cursor-pointer pb-[20px]"},_hoisted_6$3={class:"float-left h-[100%] w-[calc(100%_-_400px)] bg-[#f3f4f9]"},_hoisted_7$3={class:"h-[48px] bg-[#FFF] px-[20px] py-[8px]"},_hoisted_8$1={class:"float-right flex flex-row items-center"},_hoisted_9={class:"flex flex-row items-center"},_hoisted_10={class:"box-border flex h-[calc(100%_-_48px)] w-full flex-col overflow-x-auto overflow-y-auto p-[20px]"},_hoisted_11={class:"prompt-grid"},_hoisted_12={class:"float-left text-sm font-semibold not-italic leading-[22px] text-[#333333]"},_hoisted_13={class:"float-right text-[#266EFF]"},_hoisted_14={key:0,class:"prompt-grid"},_hoisted_15={class:"prompt-item_form"},_hoisted_16={class:"prompt-grid"},_hoisted_17={class:"prompt-item_content no-padding"},_hoisted_18={class:"prompt-grid"},_hoisted_19=["innerHTML"],_hoisted_20={class:"prompt-grid"},_hoisted_21={class:"absolute right-[20px] top-[0] float-right mt-[24px] inline-flex w-1/2 flex-row items-center justify-items-center text-[13px] font-normal not-italic leading-[22px] text-[#666666]"},_hoisted_22=["innerHTML"],_sfc_main$b=defineComponent({__name:"prompt",setup(e){const t=usePromptStore();t.getData();const a=ref(!1),o=ref(0),n=computed(()=>t.promptData),r=computed(()=>t.promptTemplate),s=computed(()=>t.params),l=computed(()=>{const C=[];return s.value.forEach(f=>{C.push({code:f.paramCode,mapValue:`{{$${f.paramCode}}}`,name:f.paramName,value:f.paramCode,title:f.paramName,field:f.paramCode,label:`${f.paramName}(${f.paramCode})`})}),C}),i=computed(()=>l.value),u=computed(()=>t.messageContent?.length>0),g=C=>{t.updateTemplate(C)},_=()=>{t.addTest()};let m=ref(-1);const v=ref(""),x=C=>{v.value="example",m.value=C,a.value=!0},D=()=>{switch(v.value){case"example":t.onDel(m.value);break;case"message":t.removeMessage(m.value),o.value=new Date().getTime();break}},y=(C,f)=>{let d="",h=0,k=0;return t.messageContent.some(function(S,A){return S.role==="user"&&(h+=1),A+1===f?(k=h,!0):!1}),C==="user"&&(d="用户提问_"+k),C==="assistant"&&(d=k<1?"AI回复":"AI回复_"+k),d+" #"+C},b=C=>{v.value="message",m.value=C,a.value=!0},w=computed(()=>{switch(v.value){case"example":return`请确认是否删除#场景${m.value+1}`;case"message":return"请确认是否删除当前样本数据"}return""}),E=computed(()=>t.messageContent.length>1),V=ref(null),N=ref(!1),{option:T}=useSortable(V,t.messageContent,{handle:".handle",onUpdate:C=>{const f=C.oldIndex,d=C.newIndex,h=JSON.parse(JSON.stringify(t.messageContent)),k=h[f];h.splice(f,1),h.splice(d,0,k),t.messageContent=h,o.value+=1},onMove:C=>!C.related.className.endsWith("disabled"),onStart:()=>{N.value=!0},onEnd:()=>{N.value=!1}});return T("animation",200),(C,f)=>{const d=_sfc_main$U,h=Popover,k=Switch,S=Button,A=ButtonGroup,O=Textarea,z=Progress;return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$a,[createBaseVNode("div",_hoisted_2$7,[createBaseVNode("div",_hoisted_3$5,toDisplayString(unref(t).title),1),createBaseVNode("div",{class:normalizeClass(["prompt-editor box-border h-[calc(100%_-_48px)] max-h-[calc(100%_-_48px)] p-[20px]",{"message-content":u.value}])},[(openBlock(),createBlock(_sfc_main$K,{key:unref(t).id,value:r.value,inputs:l.value,isCustom:!0,customParams:i.value,"max-height":u.value?"400px":"100%",title:u.value?"系统提示词 #system":"",noLevel:!0,stepName:"参数",onInput:g},null,8,["value","inputs","customParams","max-height","title"]))],2),createBaseVNode("div",{ref_key:"refSelector",ref:V,class:"display: inline-block;"},[u.value?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(unref(t).messageContent,(M,B)=>(openBlock(),createElementBlock("div",{class:normalizeClass(["prompt-editor_message pl-[20px] pr-[20px]",{dragging:N.value}]),key:o.value+"message_"+B},[createVNode(_sfc_main$K,{value:M.content,inputs:l.value,isCustom:!0,customParams:i.value,title:y(M.role,B+1),allowDel:E.value,minHeight:"80px","max-height":"200px",noLevel:!0,stepName:"参数",onInput:$=>unref(t).updateMessageContent(B,$),onDel:$=>b(B)},null,8,["value","inputs","customParams","title","allowDel","onInput","onDel"]),createBaseVNode("div",_hoisted_4$4,[createVNode(d,{name:"drop",size:"16px"})])],2))),128)):createCommentVNode("",!0)],512),createVNode(h,{position:"bottom","arrow-style":{display:"none"},"content-style":{padding:"2px 12px",marginTop:"-20px"},"popup-container":".designer-app"},{content:withCtx(()=>[createBaseVNode("div",{class:"sample-item",onClick:f[0]||(f[0]=M=>unref(t).addMessage("user"))}," 用户提问 "),createBaseVNode("div",{class:"sample-item",onClick:f[1]||(f[1]=M=>unref(t).addMessage("assistant"))}," AI回复 ")]),default:withCtx(()=>[u.value?(openBlock(),createElementBlock("span",_hoisted_5$3,[createVNode(d,{name:"add",size:"16px",style:{"margin-right":"4px"}}),f[5]||(f[5]=createTextVNode("添加对话 "))])):createCommentVNode("",!0)]),_:1})]),createBaseVNode("div",_hoisted_6$3,[createBaseVNode("div",_hoisted_7$3,[f[9]||(f[9]=createBaseVNode("div",{class:"float-left text-sm font-semibold not-italic leading-[32px] text-[#333333]"}," 测试场景 ",-1)),createBaseVNode("div",_hoisted_8$1,[createBaseVNode("div",_hoisted_9,[createVNode(k,{size:"small",modelValue:unref(t).enableParam,"onUpdate:modelValue":f[2]||(f[2]=M=>unref(t).enableParam=M)},null,8,["modelValue"]),f[6]||(f[6]=createBaseVNode("span",{class:"ml-[8px] text-[13px] text-[#333333]"},"输入参数",-1))]),createVNode(S,{class:"ml-[24px]",onClick:_},{default:withCtx(()=>f[7]||(f[7]=[createTextVNode(" 添加测试场景 ")])),_:1}),createVNode(S,{type:"primary",class:"ml-[12px]",onClick:f[3]||(f[3]=()=>unref(t).runAll()),loading:unref(t).promptData.some(M=>M.loading)},{default:withCtx(()=>f[8]||(f[8]=[createTextVNode(" 执行测试 ")])),_:1},8,["loading"])])]),createBaseVNode("div",_hoisted_10,[createBaseVNode("div",_hoisted_11,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(M,B)=>(openBlock(),createElementBlock("div",{class:"prompt-item_tool",key:"test_"+B},[createBaseVNode("div",_hoisted_12," #场景"+toDisplayString(B+1),1),createBaseVNode("div",_hoisted_13,[createVNode(A,null,{default:withCtx(()=>[createVNode(S,{type:"text",size:"small",class:"text-button",loading:M.status==="running"||M.status==="waiting",onClick:()=>unref(t).runItem(M.promptTestSceneGUID)},{default:withCtx(()=>[M.status==="running"||M.status==="waiting"?createCommentVNode("",!0):(openBlock(),createBlock(d,{key:0,name:"implement",size:"16px"}))]),_:2},1032,["loading","onClick"]),M.loading?createCommentVNode("",!0):(openBlock(),createBlock(S,{key:0,type:"text",size:"small",class:"text-button",loading:M.loading,onClick:$=>x(B)},{default:withCtx(()=>[createVNode(d,{name:"trash",color:"#266EFF",size:"16px"})]),_:2},1032,["loading","onClick"]))]),_:2},1024)])]))),128))]),unref(t).enableParam?(openBlock(),createElementBlock("div",_hoisted_14,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(M,B)=>(openBlock(),createElementBlock("div",{class:"prompt-item_result",style:{"min-height":"auto"},key:"form_"+B},[f[10]||(f[10]=createBaseVNode("div",{class:"prompt-item_title"},"输入参数",-1)),createBaseVNode("div",_hoisted_15,[(openBlock(),createBlock(_sfc_main$c,{key:M.promptTestSceneGUID,data:M.promptParams,config:s.value},null,8,["data","config"]))])]))),128))])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_16,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(M,B)=>(openBlock(),createElementBlock("div",{class:"prompt-item_result",style:{"min-height":"auto"},key:"res_"+B},[f[11]||(f[11]=createBaseVNode("div",{class:"prompt-item_title field-form"},[createBaseVNode("strong",{class:"arco-form-item-label-required-symbol"},[createBaseVNode("svg",{fill:"currentColor",viewBox:"0 0 1024 1024",width:"1em",height:"1em"},[createBaseVNode("path",{d:"M583.338667 17.066667c18.773333 0 34.133333 15.36 34.133333 34.133333v349.013333l313.344-101.888a34.133333 34.133333 0 0 1 43.008 22.016l42.154667 129.706667a34.133333 34.133333 0 0 1-21.845334 43.178667l-315.733333 102.4 208.896 287.744a34.133333 34.133333 0 0 1-7.509333 47.786666l-110.421334 80.213334a34.133333 34.133333 0 0 1-47.786666-7.509334L505.685333 706.218667 288.426667 1005.226667a34.133333 34.133333 0 0 1-47.786667 7.509333l-110.421333-80.213333a34.133333 34.133333 0 0 1-7.509334-47.786667l214.186667-295.253333L29.013333 489.813333a34.133333 34.133333 0 0 1-22.016-43.008l42.154667-129.877333a34.133333 34.133333 0 0 1 43.008-22.016l320.512 104.106667L412.672 51.2c0-18.773333 15.36-34.133333 34.133333-34.133333h136.533334z"})])]),createTextVNode(" 预期结果 ")],-1)),createBaseVNode("div",_hoisted_17,[createVNode(O,{placeholder:"请输入预期结果",modelValue:M.expectContent,"onUpdate:modelValue":$=>M.expectContent=$,"auto-size":""},null,8,["modelValue","onUpdate:modelValue"])])]))),128))]),createBaseVNode("div",_hoisted_18,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(M,B)=>(openBlock(),createElementBlock("div",{class:"prompt-item_result",style:{"min-height":"180px"},key:"output_"+B},[f[12]||(f[12]=createBaseVNode("div",{class:"prompt-item_title"},"输出结果",-1)),createBaseVNode("div",{class:normalizeClass(["prompt-item_content",unref(MD_CLASS)]),innerHTML:unref(renderMarkdown)(M.outputContent)},null,10,_hoisted_19)]))),128))]),createBaseVNode("div",_hoisted_20,[(openBlock(!0),createElementBlock(Fragment,null,renderList(n.value,(M,B)=>(openBlock(),createElementBlock("div",{class:"prompt-item_result relative",style:{"min-height":"180px"},key:"result_"+B},[f[14]||(f[14]=createBaseVNode("div",{class:"prompt-item_title"},"评估结果",-1)),createBaseVNode("div",_hoisted_21,[f[13]||(f[13]=createBaseVNode("span",{class:"absolute -top-[6px] right-[128px]"},"分值",-1)),createVNode(z,{class:"absolute right-[0] top-[0]",percent:M.estimateRecord/(M.estimateRecordMax||5)},{text:withCtx(()=>[createTextVNode(toDisplayString(M.estimateRecord),1)]),_:2},1032,["percent"])]),createBaseVNode("div",{class:normalizeClass(["prompt-item_content",unref(MD_CLASS)]),innerHTML:unref(renderMarkdown)(M.estimateContent)},null,10,_hoisted_22)]))),128))])])])]),createVNode(_sfc_main$l,{show:a.value,content:w.value,onOnOk:D,onInput:f[4]||(f[4]=M=>a.value=M)},null,8,["show","content"])],64)}}}),_hoisted_1$9={class:"ml-[4px] text-xs"},_hoisted_2$6={key:0,class:"ml-[4px]"},_sfc_main$a=defineComponent({__name:"tips-icon",props:{message:{},type:{},time:{}},setup(e){return(t,a)=>{const o=_sfc_main$U;return openBlock(),createElementBlock("div",{class:normalizeClass([`save-status_${t.type}`,"ml-[16px] flex h-[24px] flex-row items-center gap-[4px] rounded-[12px] px-[8px] py-[2px] font-normal not-italic leading-[20px]"])},[t.type==="success"?(openBlock(),createBlock(o,{key:0,name:"success",color:"#1cc78d",size:"14px"})):createCommentVNode("",!0),t.type==="error"?(openBlock(),createBlock(o,{key:1,name:"warning",color:"#ff4c4c",size:"14px"})):createCommentVNode("",!0),t.type==="warning"?(openBlock(),createBlock(o,{key:2,name:"warning",color:"#FF9902",size:"14px"})):createCommentVNode("",!0),t.type==="primary"?(openBlock(),createBlock(o,{key:3,name:"warning",color:"#266EFF",size:"14px"})):createCommentVNode("",!0),createBaseVNode("span",_hoisted_1$9,[createTextVNode(toDisplayString(t.message),1),t.time?(openBlock(),createElementBlock("span",_hoisted_2$6,toDisplayString(t.time),1)):createCommentVNode("",!0)])],2)}}}),_hoisted_1$8={class:"designer-layout-header inline-block h-full w-full px-[20px] py-[14px]"},_hoisted_2$5={class:"float-left flex max-w-[calc(100%_-_320px)] flex-row items-center justify-center text-base font-normal not-italic leading-[32px] text-[#333]"},_hoisted_3$4=["title"],_hoisted_4$3={key:0,class:"designer-layout-header__beta min-w-[42px]"},_hoisted_5$2={class:"float-right flex flex-row items-center"},_hoisted_6$2={class:"ml-[16px] flex flex-row items-center text-[13px] font-normal not-italic leading-[22px] text-[#ffffff]"},_hoisted_7$2={class:"mr-[16px] flex flex-row items-center text-xs font-normal not-italic leading-[20px] text-[#999999]"},_sfc_main$9=defineComponent({__name:"layout-header",setup(e){const t=useFlowStore(),a=usePromptStore(),o=ref(!1),n=computed(()=>t.flowData.mode==="flow"),r=()=>{if(o.value=!0,t.mode===MODE_TYPE.DESIGNER&&t.saveData(!0).finally(()=>{o.value=!1}),t.mode===MODE_TYPE.PROMPT){const m=a.messageContent.length;if(m>0&&a.messageContent[m-1].role!=="user"){Message.warning("启用少样本模式后，最后一条对话必须是用户提问！"),o.value=!1;return}a.saveData().finally(()=>{o.value=!1})}},s=m=>{if(t.mode===MODE_TYPE.VIEW)return;(navigator.platform.match("Mac")?m.metaKey:m.ctrlKey)&&m.keyCode===83&&(m.preventDefault(),r())};onMounted(()=>{document.addEventListener("keydown",s)}),onUnmounted(()=>{window.removeEventListener("keydown",s)});const l=computed(()=>t.saveStatus),i=computed(()=>t.mode===MODE_TYPE.DESIGNER),u=computed(()=>t.mode===MODE_TYPE.PROMPT),g=()=>{const m=getParams(),x=!!window.frameElement||window.parent!==window?"&embedpage=1":"";let D="";i.value&&(D=`/std/42000301/08dc89df-f23b-4061-85de-f2f20054f617?mode=2&autoTitle=true&_mp=crumbs&oid=${m.oid}&spaceGUID=${m.space}&_title=技能${x}`),u.value&&(D=`/std/42001201/08dc8b7c-8383-4e0e-8739-c28f29f61e9f?mode=2&autoTitle=true&_mp=crumbs&oid=${m.oid}&spaceGUID=${m.space}&_title=提示词${x}`),m._aiFromList&&m._aiFromList==="1"&&(D="/std/42000301/08dc70c5-2f8b-492e-8281-727749d94945"),D&&window.open(D,"_blank")},_=computed(()=>{if(i.value)return t.flowData.name||"技能编排";if(u.value)return"提示词测试"});return(m,v)=>{const x=_sfc_main$U,D=Button;return openBlock(),createElementBlock("div",_hoisted_1$8,[createBaseVNode("div",_hoisted_2$5,[createBaseVNode("span",{class:"mr-[12px] min-w-[16px] cursor-pointer leading-[0] opacity-50 hover:opacity-100",onClick:g},[createVNode(x,{name:"back",size:"16px"})]),createBaseVNode("span",{title:_.value,class:"inline-block overflow-hidden overflow-ellipsis whitespace-nowrap"},toDisplayString(_.value),9,_hoisted_3$4),createVNode(x,{name:"edit",size:"16px",class:"ml-[8px] min-w-[16px] cursor-pointer",onClick:g}),n.value?(openBlock(),createElementBlock("span",_hoisted_4$3,[createVNode(x,{name:"beta",height:"21px",width:"42px"})])):createCommentVNode("",!0),l.value.status?(openBlock(),createBlock(_sfc_main$a,{key:1,message:l.value.message,time:l.value.time,type:"success"},null,8,["message","time"])):createCommentVNode("",!0),!l.value.status&&l.value.errorMessage?(openBlock(),createBlock(_sfc_main$a,{key:2,message:l.value.errorMessage,time:"",type:"error"},null,8,["message"])):createCommentVNode("",!0),!l.value.status&&l.value.time?(openBlock(),createBlock(_sfc_main$a,{key:3,message:"上次保存",time:l.value.time,type:"info"},null,8,["time"])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_5$2,[createBaseVNode("div",_hoisted_6$2,[createBaseVNode("div",_hoisted_7$2,[createVNode(x,{name:"keyboard",size:"16px",class:"mr-[4px]"}),v[0]||(v[0]=createTextVNode(" 快捷保存: Ctrl+S "))]),createVNode(D,{loading:o.value,type:"text",onClick:r,class:"rounded-[20px] bg-[#266EFF] text-white"},{icon:withCtx(()=>[o.value?createCommentVNode("",!0):(openBlock(),createBlock(x,{key:0,name:"save",size:"14px",color:"white"}))]),default:withCtx(()=>[v[1]||(v[1]=createBaseVNode("span",{class:"text-[13px] text-white"},"保存",-1))]),_:1},8,["loading"])])])])}}}),docFileInfoCache={},CACHE_DURATION=5*60*1e3,getDocumentFileInfo=async e=>{let t={};const a=Date.now(),o=docFileInfoCache[e];o&&a-o.timestamp<CACHE_DURATION?t=o.data:t=await axios.request({url:"/api/42000101/assistant/getDocumentInfo",method:"POST",headers:{"Content-Type":"application/json"}});const{data:n}=t.data||{},{url:r,token:s}=n,l=new NewDocServiceV2({url:r,token:s});return{previewUrl:l.getViewUrl({documentGuid:e,ratio:1.5}),downloadUrl:l.getDownloadUrl({documentGuid:e}),id:e}},_hoisted_1$7={class:"float-left flex h-[40px] w-[40px] items-center justify-center overflow-hidden rounded-[6px] border-[1px] border-solid border-[#EAEAEA] bg-[#FFF]"},_hoisted_2$4=["src"],_hoisted_3$3={class:"float-left ml-[8px] w-[calc(100%_-_56px)] flex-1 not-italic"},_hoisted_4$2={class:"float-left text-ellipsis text-[13px] font-semibold leading-[22px] text-[#333333]"},_hoisted_5$1={class:"text-ellipsis text-xs text-[#999999]"},_hoisted_6$1=["onClick"],_hoisted_7$1={key:1,class:"mb-[12px] flex items-center justify-center rounded-[8px] bg-[#F3F4F9] px-[4px] py-[8px]"},_hoisted_8={class:"text-center text-xs font-normal not-italic leading-[20px] text-[#999999]"},_sfc_main$8=defineComponent({__name:"tool-group",props:{iconName:{type:String},title:{type:String},data:{type:Object},titleField:{type:String,default:"name"},descriptionField:{type:String,default:"description"},iconField:String,renderTitle:Function,renderDescription:Function},emits:["click","del","add"],setup(e,{emit:t}){const a=t,o=()=>{a("click")},n=i=>{a("del",Number(i))},r=()=>{a("add")},s=ref({}),l=async(i,u)=>{const g=e.iconField&&i[e.iconField]&&i[e.iconField]!==""?JSON.parse(i[e.iconField]):null,_=g&&g[0]?g[0]:{};if(_.documentGuid){const m=await getDocumentFileInfo(_.documentGuid);s.value[u]=m.downloadUrl||""}};return watch(()=>e.data,i=>{e.iconField&&i&&Array.isArray(i)&&i.forEach((u,g)=>{l(u,g)})},{immediate:!0}),(i,u)=>{const g=_sfc_main$U;return openBlock(),createBlock(_sfc_main$x,{title:e.title,onAdd:r},createSlots({content:withCtx(()=>[e.data?.length>0?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.data,(_,m)=>(openBlock(),createElementBlock("div",{class:"agent-group_item relative inline-block w-full cursor-pointer rounded-[8px] py-[4px] pl-[4px] pr-[8px]",onClick:o,key:m},[createBaseVNode("div",_hoisted_1$7,[!e.iconField||!s.value[m]?(openBlock(),createBlock(g,{key:0,name:e.iconName,size:"24px"},null,8,["name"])):createCommentVNode("",!0),e.iconField&&s.value[m]?(openBlock(),createElementBlock("img",{key:1,src:s.value[m]},null,8,_hoisted_2$4)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_3$3,[createBaseVNode("div",_hoisted_4$2,[createTextVNode(toDisplayString(e.renderTitle?e.renderTitle(_):_[e.titleField])+" ",1),renderSlot(i.$slots,"tag",{item:_})]),createBaseVNode("span",_hoisted_5$1,toDisplayString(e.renderDescription?e.renderDescription(_):_[e.descriptionField]||"暂无描述信息"),1)]),createBaseVNode("div",{class:"delete-btn invisible absolute bottom-[0] right-[4px] top-[0] float-left flex cursor-pointer items-center",onClick:v=>n(m)},[createVNode(g,{name:"minus",color:"#8992A2",size:"16px"})],8,_hoisted_6$1)]))),128)):(openBlock(),createElementBlock("div",_hoisted_7$1,[createBaseVNode("span",_hoisted_8,"暂无"+toDisplayString(e.title),1)]))]),_:2},[i.$slots.btn?{name:"btn",fn:withCtx(()=>[renderSlot(i.$slots,"btn")]),key:"0"}:void 0]),1032,["title"])}}}),_sfc_main$7=defineComponent({__name:"input-params",props:{title:{type:String}},setup(e){const t=useFlowStore(),a=useTemplateRef("fieldForm"),o=()=>{a.value?.add()},n=computed(()=>[{label:"参数名称",prop:"name",placeholder:"请输入名称",width:"32%",type:"input",default:""},{label:"参数编码",prop:"code",placeholder:"请输入编码",width:"30%",type:"input",default:""},{label:"是否必填",prop:"required",placeholder:"请选择",width:"12%",type:"checkbox",default:!0},{label:"字段类型",prop:"type",placeholder:"请选择",width:"28%",type:"select",options:FIELD_OPTIONS,default:"string"}]);return(r,s)=>(openBlock(),createBlock(_sfc_main$x,{title:e.title,onAdd:o},{content:withCtx(()=>[createVNode(_sfc_main$I,{ref:"fieldForm",value:unref(t).agentData.inputs,onInput:s[0]||(s[0]=l=>unref(t).agentData.inputs=l),config:n.value,"enable-sort":!0,"allow-add":!1,"show-label":!0},null,8,["value","config"])]),_:1},8,["title"]))}}),createOpenPluginEvent=()=>"skyline:designer:plugin:open",createPluginCallbackEvent=()=>"skyline:designer:plugin:callback",createOpenMcpServiceEvent=()=>"skyline:designer:MCP:open",createMcpServiceCallbackEvent=()=>"skyline:designer:MCP:callback",createOpenKnowledgeEvent=()=>"skyline:designer:knowledge:open",createKnowledgeCallbackEvent=()=>"skyline:designer:knowledge:callback",createMountedEvent=()=>"skyline:designer:mounted",emitEvent=(e,t={})=>{const a=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});document.dispatchEvent(a)},useDesignerSdk=defineStore("designerSdk",{actions:{openPlugin(e){emitEvent(createOpenPluginEvent(),e)},openKnowledge(e){emitEvent(createOpenKnowledgeEvent(),e)},openMcp(e){emitEvent(createOpenMcpServiceEvent(),e)},onMounted(){emitEvent(createMountedEvent(),{})}}}),diversityOptions=[{label:"精确模式",value:"precise"},{label:"平衡模式",value:"balance"},{label:"创意模式",value:"creative"},{label:"自定义",value:"custom"}],thinkingOptions=[{label:"否",value:!1},{label:"是",value:!0}],_hoisted_1$6=["innerHTML"],_sfc_main$6=defineComponent({__name:"setting-item",props:{label:{},tooltip:{}},setup(e){return(t,a)=>{const o=Popover,n=FormItem;return openBlock(),createBlock(n,null,{label:withCtx(()=>[createBaseVNode("span",null,toDisplayString(t.label),1),t.tooltip?(openBlock(),createBlock(o,{key:0,trigger:"hover",placement:"bottom",style:{width:"300px"}},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:t.tooltip},null,8,_hoisted_1$6)]),default:withCtx(()=>[createVNode(unref(IconQuestionCircle),{class:"ml-2 text-[#a3a3a3]"})]),_:1})):createCommentVNode("",!0)]),default:withCtx(()=>[renderSlot(t.$slots,"default")]),_:3})}}}),getModels=async()=>(await axios.request({url:"/api/42000501/ModelInstance/reasoningList",method:"POST"})).data.data,_hoisted_1$5={class:"agent-tool-setting"},_sfc_main$5=defineComponent({__name:"setting",props:{modelCode:{},modelCodeModifiers:{},maxLoops:{},maxLoopsModifiers:{},generationDiversity:{},generationDiversityModifiers:{},executionSetting:{},executionSettingModifiers:{}},emits:["update:modelCode","update:maxLoops","update:generationDiversity","update:executionSetting"],setup(e){const t=useModel(e,"modelCode"),a=useModel(e,"maxLoops"),o=useModel(e,"generationDiversity"),n=useModel(e,"executionSetting"),r=ref([]);watch(t,()=>{o.value="precise",n.value=null}),onMounted(async()=>{const V=await getModels();r.value=V.map(N=>{let T=null;if(N.executionSetting)try{T=JSON.parse(N.executionSetting)}catch{}return{label:N.modelInstanceName,value:N.modelInstanceCode,reasoning:N.supportDeepThink===1,executionSetting:T}})});const s=computed(()=>r.value.find(V=>V.value===t.value)),l=computed(()=>s.value?.reasoning),i=computed(()=>s.value?.executionSetting),u=computed(()=>i.value?.config??null),g=computed(()=>i.value?.generationDiversity??null);watch(g,V=>{if(!o.value||!V)return;console.log(s);const N=V[o.value];N&&(n.value={...n.value,temperature:N.temperature??0,top_p:N.top_p??0,max_tokens:v.value?.defaultValue??0})});const _=computed(()=>u.value?.temperature??null),m=computed(()=>u.value?.top_p??null),v=computed(()=>u.value?.max_tokens??null),x=computed({get:()=>n.value?.enable_thinking??!1,set:V=>{if(V)n.value={...n.value,enable_thinking:V};else{const N=n.value??{};delete N.enable_thinking,delete N.thinking_budget,n.value=N}}}),D=computed({get:()=>n.value?.thinking_budget??0,set:V=>{n.value={...n.value??{},thinking_budget:V},o.value="custom"}}),y=computed({get:()=>n.value?.temperature??0,set:V=>{n.value={...n.value??{},temperature:V},o.value="custom"}}),b=computed({get:()=>n.value?.top_p??0,set:V=>{n.value={...n.value??{},top_p:V},o.value="custom"}}),w=computed({get:()=>n.value?.max_tokens??0,set:V=>{n.value={...n.value??{},max_tokens:V}}});watch(o,V=>{if(!g.value||!V)return;const N=g.value[V];N&&(n.value={...n.value??{},temperature:N.temperature??0,top_p:N.top_p??0})});const E=V=>Math.pow(10,-V);return(V,N)=>{const T=Option,C=Select,f=Radio,d=RadioGroup,h=Slider;return openBlock(),createElementBlock("div",_hoisted_1$5,[createVNode(_sfc_main$6,{label:"模型设置"},{default:withCtx(()=>[createVNode(C,{modelValue:t.value,"onUpdate:modelValue":N[0]||(N[0]=k=>t.value=k),placeholder:"请选择","allow-clear":""},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.value,k=>(openBlock(),createBlock(T,{key:k.value,value:k.value},{default:withCtx(()=>[createTextVNode(toDisplayString(k.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s.value?(openBlock(),createElementBlock(Fragment,{key:0},[l.value?(openBlock(),createElementBlock(Fragment,{key:0},[createVNode(_sfc_main$6,{label:"深度思考"},{default:withCtx(()=>[createVNode(d,{modelValue:x.value,"onUpdate:modelValue":N[1]||(N[1]=k=>x.value=k)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(thinkingOptions),(k,S)=>(openBlock(),createBlock(f,{value:k.value,key:S},{default:withCtx(()=>[createTextVNode(toDisplayString(k.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),x.value?(openBlock(),createBlock(_sfc_main$6,{key:0,label:"思考长度"},{default:withCtx(()=>[createVNode(h,{modelValue:D.value,"onUpdate:modelValue":N[2]||(N[2]=k=>D.value=k),"show-input":"","default-value":0,min:0,max:38912,step:1,marks:{0:"0",38912:"38912"}},null,8,["modelValue"])]),_:1})):createCommentVNode("",!0)],64)):createCommentVNode("",!0),u.value?(openBlock(),createElementBlock(Fragment,{key:1},[createVNode(_sfc_main$6,{label:"生成多样性"},{default:withCtx(()=>[createVNode(d,{modelValue:o.value,"onUpdate:modelValue":N[3]||(N[3]=k=>o.value=k)},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(diversityOptions),k=>(openBlock(),createBlock(f,{value:k.value,key:k.value},{default:withCtx(()=>[createTextVNode(toDisplayString(k.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_.value?(openBlock(),createBlock(_sfc_main$6,{key:0,label:_.value.name,tooltip:_.value.tips},{default:withCtx(()=>[createVNode(h,{modelValue:y.value,"onUpdate:modelValue":N[4]||(N[4]=k=>y.value=k),"show-input":"","default-value":_.value.defaultValue,min:_.value.minValue,max:_.value.maxValue,step:E(_.value.rounding),marks:{0:"0",1:"1",[_.value.maxValue]:_.value.maxValue+""}},null,8,["modelValue","default-value","min","max","step","marks"])]),_:1},8,["label","tooltip"])):createCommentVNode("",!0),m.value?(openBlock(),createBlock(_sfc_main$6,{key:1,label:m.value.name,tooltip:m.value.tips},{default:withCtx(()=>[createVNode(h,{modelValue:b.value,"onUpdate:modelValue":N[5]||(N[5]=k=>b.value=k),"show-input":"","default-value":m.value.defaultValue,min:m.value.minValue,max:m.value.maxValue,step:E(m.value.rounding),marks:{0:"0",[m.value.maxValue]:m.value.maxValue+""}},null,8,["modelValue","default-value","min","max","step","marks"])]),_:1},8,["label","tooltip"])):createCommentVNode("",!0),v.value?(openBlock(),createBlock(_sfc_main$6,{key:2,label:v.value.name,tooltip:v.value.tips},{default:withCtx(()=>[createVNode(h,{modelValue:w.value,"onUpdate:modelValue":N[6]||(N[6]=k=>w.value=k),"show-input":"","default-value":v.value.defaultValue,min:v.value.minValue,max:v.value.maxValue,step:E(v.value.rounding),marks:{0:"0",[v.value.maxValue]:v.value.maxValue+""}},null,8,["modelValue","default-value","min","max","step","marks"])]),_:1},8,["label","tooltip"])):createCommentVNode("",!0)],64)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),createVNode(_sfc_main$6,{label:"携带上下文轮数"},{default:withCtx(()=>[createVNode(h,{modelValue:a.value,"onUpdate:modelValue":N[7]||(N[7]=k=>a.value=k),"default-value":30,"show-input":"",min:1,max:60,step:1,marks:{1:"1",30:"默认",60:"60"}},null,8,["modelValue"])]),_:1})])}}}),_hoisted_1$4={class:"agent-tool p-[20px]"},_hoisted_2$3={key:0,class:"rounded-[8px] bg-[rgba(0,_0,_0,_.08)] px-[4px] py-[0] text-xs font-normal text-[#999]"},_sfc_main$4=defineComponent({__name:"tool",setup(e){const t=ref({}),a=useDesignerSdk(),o=useFlowStore(),n=computed(()=>o.agentData.tools?.map(w=>({text:w.name,value:w.path,origin:w}))||[]),r=()=>{a.openPlugin(n.value)},s=computed(()=>o.agentData.knowledgs?.map(w=>({text:w.name,value:w.id,origin:w}))||[]),l=ref(),i=w=>{const E=+w;l.value=E;let V="选择知识库";E===1?V="选择文档知识库":E===3&&(V="选择数据知识库");const N=s.value.filter(T=>T.origin.type===E);a.openKnowledge({data:N,title:V,type:E})},u=w=>{o.agentData.tools=w.detail},g=w=>{const E=w.detail;l.value&&(o.agentData.knowledgs=o.agentData.knowledgs.filter(V=>V.type!==l.value)),o.agentData.knowledgs=[...o.agentData.knowledgs,...E]},_=w=>{const E=w.detail;let V=[...o.agentData.mcps||[]];E.forEach(N=>{V.some(C=>C.serviceGUID===N.serviceGUID&&C.toolGUID===N.toolGUID)||V.push(N)}),o.agentData.mcps=[...V]};onMounted(()=>{document.addEventListener(createPluginCallbackEvent(),u),document.addEventListener(createKnowledgeCallbackEvent(),g),document.addEventListener(createMcpServiceCallbackEvent(),_)});const m=w=>{o.agentData.tools.splice(w,1)},v=w=>{o.agentData.knowledgs.splice(w,1)},x=()=>{a.openMcp()},D=w=>{o.agentData.mcps.splice(w,1)},y=w=>w.toolName?`${w.serviceName} / ${w.toolName}`:w.serviceName,b=w=>w.toolGUID?w.toolDescription:w.serviceDescription;return(w,E)=>{const V=_sfc_main$U,N=Doption,T=Dropdown,C=Form;return openBlock(),createBlock(C,{model:t.value,"label-align":"left","label-col-props":{span:6,offset:0},"wrapper-col-props":{span:18,offset:0}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$4,[E[12]||(E[12]=createBaseVNode("div",{class:"agent-tool-title"},"工具",-1)),createVNode(_sfc_main$8,{title:"插件","icon-name":"plugin",data:unref(o).agentData.tools,onAdd:r,onDel:m,onClick:E[0]||(E[0]=()=>{})},null,8,["data"]),createVNode(_sfc_main$8,{title:"MCP","icon-name":"document",iconField:"serviceIcon",data:unref(o).agentData.mcps,renderTitle:y,renderDescription:b,onAdd:x,onDel:D,onClick:E[1]||(E[1]=()=>{})},{tag:withCtx(({item:f})=>[f.serviceName&&!f.toolGUID?(openBlock(),createElementBlock("span",_hoisted_2$3,"auto")):createCommentVNode("",!0)]),_:1},8,["data"]),E[13]||(E[13]=createBaseVNode("div",{class:"agent-tool-title mt-[20px]"},"知识库",-1)),createVNode(_sfc_main$8,{title:"知识库","icon-name":"knowledge",data:unref(o).agentData.knowledgs,onDel:v,onClick:E[3]||(E[3]=()=>{})},{btn:withCtx(()=>[createVNode(T,{onSelect:i,position:"br"},{content:withCtx(()=>[createVNode(N,{value:"1"},{default:withCtx(()=>E[9]||(E[9]=[createTextVNode("选择文档知识库")])),_:1}),createVNode(N,{value:"3"},{default:withCtx(()=>E[10]||(E[10]=[createTextVNode("选择数据知识库")])),_:1})]),default:withCtx(()=>[createBaseVNode("span",{onClick:E[2]||(E[2]=withModifiers(()=>{},["stop"]))},[createVNode(V,{name:"add-bg",size:"20px"})])]),_:1})]),_:1},8,["data"]),E[14]||(E[14]=createBaseVNode("div",{class:"agent-tool-title mt-[24px]"},"变量",-1)),createVNode(_sfc_main$7,{title:"输入参数"}),createVNode(_sfc_main$w,{title:"文件上传",data:unref(o).agentData,"show-tips":!1,"support-files":["doc,docx","pdf","xls,xlsx","ppt,pptx","txt"]},null,8,["data"]),createVNode(_sfc_main$x,{title:"设置",onAdd:E[8]||(E[8]=()=>{})},{btn:withCtx(()=>E[11]||(E[11]=[])),content:withCtx(()=>[createVNode(unref(_sfc_main$5),{"model-code":unref(o).agentData.modelInstanceCode,"onUpdate:modelCode":E[4]||(E[4]=f=>unref(o).agentData.modelInstanceCode=f),"max-loops":unref(o).agentData.maxContextTurnsNumber,"onUpdate:maxLoops":E[5]||(E[5]=f=>unref(o).agentData.maxContextTurnsNumber=f),"execution-setting":unref(o).agentData.executionSetting,"onUpdate:executionSetting":E[6]||(E[6]=f=>unref(o).agentData.executionSetting=f),"generation-diversity":unref(o).agentData.generationDiversity,"onUpdate:generationDiversity":E[7]||(E[7]=f=>unref(o).agentData.generationDiversity=f)},null,8,["model-code","max-loops","execution-setting","generation-diversity"])]),_:1})])]),_:1},8,["model"])}}}),_hoisted_1$3={class:"designer-prompt h-full"},_hoisted_2$2={class:"prompt-header flex items-center justify-between pb-[6px] pl-[20px] pr-[20px] pt-[18px]"},_hoisted_3$2={class:"inline-flex cursor-pointer items-center gap-[4px] rounded-[20px] bg-[#EBF2FF] px-[8px] py-[4px]"},_hoisted_4$1={class:"prompt-content h-[calc(100%_-_52px)] overflow-y-auto",ref:"refEditor"},_sfc_main$3=defineComponent({__name:"prompt",props:{placeholder:{}},setup(e){const t=useFlowStore(),a=ref([]),o=computed(()=>JSON.parse(JSON.stringify(t.agentData.inputs??[]))),n=C=>{t.agentData.prompt.template=C},r=/{{\$([^{}]+)}}/g,s=C=>{const f=i.value,d=C.replace(/[\n\r\t\f\v\u2028\u2029]/g,""),h=[];let k;for(;(k=r.exec(d))!==null;){const[,S]=k,A=f[S]||{};A.field?h.push({code:S,value:{type:"ref",content:A.field}}):nextTick(()=>{V(S)})}a.value=[...h]},l=computed(()=>{const C=o.value,f=[];return C.forEach(d=>{f.push({...d,label:d.name,value:d.code,field:d.code,title:d.name})}),[{name:"系统变量",value:"system",code:"system",children:b.value},...f]}),i=computed(()=>{const C=a.value??[],f={};return C.forEach(d=>{if(d.value&&d.value.type==="ref"){const h=u.value[d.value.content];h&&(f[d.code]=h)}}),{...u.value,...f}}),u=computed(()=>{const C=o.value;b.value?.forEach(d=>{C.push(...d.children||[])});const f={};return C.forEach(d=>{d.value||(d.value=d.code),d.field=d.value,d.title=d.name,d.label=d.name,f[d.value]=d}),f}),g=computed(()=>Object.keys(u.value).map(C=>u.value[C].code));onMounted(()=>{const{inputs:C}=t.agentData.prompt;a.value=C||[],s(m.value)});const{template:_}=t.agentData.prompt,m=ref(_),v=computed(()=>{const C={};return Object.keys(i.value).forEach(f=>{const d=i.value[f];C[`$${f}`]={...d,type:PlaceholderType.VARIABLE}}),C}),{setContent:x,addFieldToCurrent:D,refreshPlaceholders:y}=useMarkdownEditor({content:m,data:v,elementId:"refEditor",minHeight:"100%",maxHeight:"100%",update:C=>{m.value=C}}),b=computed(()=>t.getSystemParamData(!0)),w=C=>{let f=0;return a.value.forEach(d=>{if(d.code.startsWith(C)){const h=Number(d.code.replace(C,""));typeof h=="number"&&(f=h+1)}}),C+f},E=C=>{const f=w(C.code);a.value.push({code:f,value:{type:"ref",content:C.value}}),D(f)},V=C=>{if(g.value.includes(C)){const f=w(C),d=Object.keys(u.value).find(k=>u.value[k].code===C),h=u.value[d||""]||{};h&&(a.value.push({code:f,value:{type:"ref",content:h.value}}),n(m.value.replace(`{{$${C}}}`,`{{$${f}}}`)),x(m.value.replace(`{{$${C}}}`,`{{$${f}}}`)))}},T=debounce({delay:500},()=>{s(m.value),y(),nextTick(()=>{x(m.value)})});return watch(a,C=>{t.agentData.prompt.inputs=C}),watch(o,()=>{T()}),watch(m,C=>{n(C),s(C)}),(C,f)=>{const d=_sfc_main$U;return openBlock(),createElementBlock("div",_hoisted_1$3,[createBaseVNode("div",_hoisted_2$2,[f[1]||(f[1]=createBaseVNode("span",{class:"text-sm font-semibold not-italic leading-[22px] text-[#333333]"},"指令提示词",-1)),(openBlock(),createBlock(_sfc_main$L,{paramsData:l.value,selected:[],onSelect:E,filterSystemCode:!1,noLevel:!0,stepName:"输入参数",key:l.value.length},{default:withCtx(()=>[createBaseVNode("div",_hoisted_3$2,[createVNode(d,{name:"add-bg",size:"18px"}),f[0]||(f[0]=createBaseVNode("span",{class:"text-xs font-normal not-italic leading-[20px] text-[#266eff]"},"插入变量",-1))])]),_:1},8,["paramsData"]))]),createBaseVNode("div",_hoisted_4$1,null,512)])}}}),_hoisted_1$2={class:"agent-content flex h-full flex-row overflow-hidden bg-[#FCFCFF]"},_hoisted_2$1={class:"flex h-full w-2/3 flex-col"},_hoisted_3$1={class:"flex h-[calc(100%_-_53px)]"},_hoisted_4={class:"w-1/2 [border-right:1px_solid_#EAEAEA]"},_hoisted_5={class:"h-full w-1/2 overflow-y-auto"},_hoisted_6={class:"w-1/3 [border-left:1px_solid_#EAEAEA]"},_hoisted_7={class:"height: 52px; flex justify-between bg-[#fff] px-[20px] py-[14px] [border-bottom:1px_solid_#EAEAEA]"},_sfc_main$2=defineComponent({__name:"agent",setup(e){const t=useFlowStore(),a=ref(!1);return onMounted(()=>{t.$subscribe(()=>{a.value=!0})}),watch(()=>skipConfig.value,o=>{o&&(a.value=!1,skipConfig.value=!1)}),(o,n)=>(openBlock(),createElementBlock("div",_hoisted_1$2,[createBaseVNode("div",_hoisted_2$1,[n[0]||(n[0]=createBaseVNode("div",{class:"height: 52px; px-[20px] py-[14px] [border-bottom:1px_solid_#EAEAEA]"},[createBaseVNode("span",{class:"text-base font-semibold not-italic leading-[24px] text-[#333333]"},"编排")],-1)),createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",_hoisted_4,[createVNode(_sfc_main$3,{placeholder:"请输入提示词",inputs:[]})]),createBaseVNode("div",_hoisted_5,[createVNode(_sfc_main$4)])])]),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",_hoisted_7,[n[1]||(n[1]=createBaseVNode("span",{class:"text-base font-semibold not-italic leading-[24px] text-[#333333]"},"预览与调试",-1)),a.value?(openBlock(),createBlock(_sfc_main$a,{key:0,message:"技能已修改，请先保存再预览",type:"primary"})):createCommentVNode("",!0)]),n[2]||(n[2]=createBaseVNode("div",{class:"relative z-0 h-[calc(100%_-_53px)] overflow-hidden",id:"agentPreview"},null,-1))])]))}}),_hoisted_1$1={key:1,class:"skill_layout h-[100%] w-[100%]"},_hoisted_2={class:"layout-header h-[60px] bg-[#F7F8FC] [border-bottom:1px_solid_#EAEAEA]"},_hoisted_3={class:"layout-content relative h-[calc(100%_-_60px)]"},_sfc_main$1=defineComponent({__name:"index",setup(e){const t=useFlowStore(),a=useVerifiesStore(),o=useDesignerSdk(),n=computed(()=>[MODE_TYPE.DESIGNER,MODE_TYPE.PROMPT].includes(t.mode)),r=computed(()=>t.mode===MODE_TYPE.VIEW),s=computed(()=>t.showError),l=computed(()=>t.flowData);return onMounted(()=>{t.mode===MODE_TYPE.DESIGNER&&t.getData().then(i=>{o.onMounted(),i?.length&&a.verifyAll(i),t.initSetupConfig()})}),(i,u)=>(openBlock(),createElementBlock(Fragment,null,[s.value?(openBlock(),createBlock(ErrorView,{key:0})):n.value?(openBlock(),createElementBlock("div",_hoisted_1$1,[createBaseVNode("div",_hoisted_2,[createVNode(_sfc_main$9)]),createBaseVNode("div",_hoisted_3,[unref(t).mode===unref(MODE_TYPE).PROMPT?(openBlock(),createBlock(_sfc_main$b,{key:0})):createCommentVNode("",!0),unref(t).mode===unref(MODE_TYPE).DESIGNER?(openBlock(),createElementBlock(Fragment,{key:1},[l.value.mode==="flow"?(openBlock(),createBlock(_sfc_main$d,{key:0})):createCommentVNode("",!0),l.value.mode==="agent"?(openBlock(),createBlock(_sfc_main$2,{key:1})):createCommentVNode("",!0)],64)):createCommentVNode("",!0)])])):createCommentVNode("",!0),r.value?(openBlock(),createBlock(_sfc_main$P,{key:2})):createCommentVNode("",!0)],64))}}),_hoisted_1={class:"designer-app"},_sfc_main=defineComponent({__name:"App",setup(e){return(t,a)=>(openBlock(),createElementBlock("div",_hoisted_1,[createVNode(_sfc_main$1)]))}}),onInit=e=>{const t=document.getElementById(e);if(!t)return;t.innerHTML="";const a=t.getAttribute("data-mode")||"",o=createPinia(),n=createApp(_sfc_main);n.component("svg-icon",_sfc_main$U),n.use(ArcoVue),n.use(o),useFlowStore().setFlowMode(a),n.mount(`#${e}`)};window._designerInit=onInit;onInit("skillDesigner");export{_sfc_main$U as _};
